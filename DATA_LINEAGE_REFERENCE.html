<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RP2 Audit-Ready Data Lineage Report</title>
    <style>
        :root {
            --primary: #1e40af;
            --secondary: #3b82f6;
            --success: #059669;
            --warning: #d97706;
            --danger: #dc2626;
            --bg: #f8fafc;
            --card: #ffffff;
            --text: #1e293b;
            --muted: #64748b;
            --border: #e2e8f0;
            --code-bg: #1e293b;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
        }
        .container { max-width: 1600px; margin: 0 auto; padding: 20px; }

        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 40px;
            border-radius: 16px;
            margin-bottom: 30px;
        }
        header h1 { font-size: 2.5rem; margin-bottom: 10px; }
        header .subtitle { font-size: 1.2rem; opacity: 0.9; }
        header .meta { margin-top: 15px; font-size: 0.9rem; opacity: 0.8; }

        .alert {
            background: #fef3c7;
            border-left: 4px solid var(--warning);
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 25px;
        }
        .alert h3 { color: var(--warning); margin-bottom: 5px; }

        .stats-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        .stat-box {
            background: var(--card);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .stat-value { font-size: 2rem; font-weight: bold; color: var(--primary); }
        .stat-label { color: var(--muted); font-size: 0.85rem; }

        .toc {
            background: var(--card);
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .toc h2 { color: var(--primary); margin-bottom: 15px; }
        .toc-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 10px;
        }
        .toc-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            background: var(--bg);
            border-radius: 8px;
            text-decoration: none;
            color: var(--text);
            transition: all 0.2s;
        }
        .toc-item:hover { background: var(--primary); color: white; }
        .toc-badge {
            background: var(--primary);
            color: white;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.8rem;
        }
        .toc-item:hover .toc-badge { background: white; color: var(--primary); }

        .study-section {
            background: var(--card);
            border-radius: 16px;
            margin-bottom: 40px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .study-header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 30px;
        }
        .study-header h2 { font-size: 1.8rem; margin-bottom: 8px; }
        .study-header .study-name { font-size: 1.1rem; opacity: 0.9; }

        .study-content { padding: 30px; }

        .info-section {
            margin-bottom: 30px;
            padding: 20px;
            background: var(--bg);
            border-radius: 12px;
        }
        .info-section h3 {
            color: var(--primary);
            font-size: 1.2rem;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border);
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        .info-item { background: var(--card); padding: 15px; border-radius: 8px; }
        .info-label { font-size: 0.75rem; color: var(--muted); text-transform: uppercase; letter-spacing: 0.5px; }
        .info-value { font-weight: 600; margin-top: 3px; }

        .source-files-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        .source-files-table th {
            background: var(--primary);
            color: white;
            padding: 12px 15px;
            text-align: left;
            font-size: 0.85rem;
        }
        .source-files-table td {
            padding: 12px 15px;
            border-bottom: 1px solid var(--border);
            font-size: 0.9rem;
        }
        .source-files-table tr:hover { background: #f1f5f9; }

        .notes-list {
            list-style: none;
            padding: 0;
        }
        .notes-list li {
            padding: 8px 0 8px 25px;
            position: relative;
            border-bottom: 1px solid var(--border);
        }
        .notes-list li:before {
            content: "⚠";
            position: absolute;
            left: 0;
            color: var(--warning);
        }
        .notes-list li:last-child { border-bottom: none; }

        .lineage-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
        }
        .lineage-table thead {
            background: var(--code-bg);
            color: white;
            position: sticky;
            top: 0;
        }
        .lineage-table th {
            padding: 15px 12px;
            text-align: left;
            font-weight: 600;
        }
        .lineage-table td {
            padding: 12px;
            border-bottom: 1px solid var(--border);
            vertical-align: top;
        }
        .lineage-table tr:hover { background: #f8fafc; }

        .var-name {
            font-weight: 700;
            color: var(--primary);
            font-size: 0.95rem;
        }
        .source-file {
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.8rem;
            background: #dbeafe;
            color: var(--primary);
            padding: 3px 8px;
            border-radius: 4px;
            display: inline-block;
        }
        .source-cols {
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.8rem;
            background: #fef3c7;
            color: #92400e;
            padding: 3px 8px;
            border-radius: 4px;
        }
        .unit-badge {
            background: #d1fae5;
            color: #065f46;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        .formula-box {
            background: #fef3c7;
            border-left: 3px solid var(--warning);
            padding: 8px 12px;
            font-family: 'Monaco', monospace;
            font-size: 0.85rem;
            border-radius: 0 4px 4px 0;
            margin: 5px 0;
        }
        .code-block {
            background: var(--code-bg);
            color: #a5f3fc;
            padding: 12px;
            border-radius: 8px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.8rem;
            white-space: pre-wrap;
            overflow-x: auto;
            margin: 8px 0;
        }
        .transform-desc {
            font-size: 0.85rem;
            color: var(--muted);
            margin-top: 5px;
        }
        .notes-cell {
            font-size: 0.8rem;
            color: var(--muted);
            font-style: italic;
        }

        .comparison-box {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 10px;
        }
        .comparison-item {
            background: var(--card);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        .comparison-item.before { border-top: 3px solid var(--danger); }
        .comparison-item.after { border-top: 3px solid var(--success); }
        .comparison-item.improvement { border-top: 3px solid var(--primary); }
        .comparison-value { font-size: 1.5rem; font-weight: bold; }
        .comparison-label { font-size: 0.8rem; color: var(--muted); }

        .back-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--primary);
            color: white;
            padding: 15px 25px;
            border-radius: 30px;
            text-decoration: none;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            transition: all 0.2s;
        }
        .back-top:hover { transform: translateY(-3px); }

        footer {
            text-align: center;
            padding: 40px;
            color: var(--muted);
        }

        @media (max-width: 768px) {
            header h1 { font-size: 1.8rem; }
            .lineage-table { display: block; overflow-x: auto; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header id="top">
            <h1>RP2 Audit-Ready Data Lineage Report</h1>
            <div class="subtitle">Complete ALCOA+ Compliant Traceability Documentation</div>
            <div class="meta">
                Generated: 2025-12-03 18:15:52 |
                Studies: 13 |
                Variables Documented: 380
            </div>
        </header>

        <div class="alert">
            <h3>Audit Documentation Notice</h3>
            <p>This report provides <strong>100% transparency</strong> into every data transformation including: exact formulas for calculated variables, complete transformation code, all source columns (including multi-column inputs), and critical study context notes.</p>
        </div>

        <div class="stats-row">
            <div class="stat-box">
                <div class="stat-value">13</div>
                <div class="stat-label">Studies Documented</div>
            </div>
            <div class="stat-box">
                <div class="stat-value">73,125</div>
                <div class="stat-label">Total Records</div>
            </div>
            <div class="stat-box">
                <div class="stat-value">12,804</div>
                <div class="stat-label">Unique Patients</div>
            </div>
            <div class="stat-box">
                <div class="stat-value">380</div>
                <div class="stat-label">Variables with Full Lineage</div>
            </div>
        </div>

        <div class="toc">
            <h2>Table of Contents</h2>
            <div class="toc-list">

                <a href="#JHB_WRHI_001" class="toc-item">
                    <span>JHB_WRHI_001</span>
                    <span class="toc-badge">21,015 records | 37 vars</span>
                </a>

                <a href="#JHB_WRHI_003" class="toc-item">
                    <span>JHB_WRHI_003</span>
                    <span class="toc-badge">2,235 records | 46 vars</span>
                </a>

                <a href="#JHB_ACTG_015" class="toc-item">
                    <span>JHB_ACTG_015</span>
                    <span class="toc-badge">2,364 records | 14 vars</span>
                </a>

                <a href="#JHB_ACTG_016" class="toc-item">
                    <span>JHB_ACTG_016</span>
                    <span class="toc-badge">766 records | 17 vars</span>
                </a>

                <a href="#JHB_ACTG_019" class="toc-item">
                    <span>JHB_ACTG_019</span>
                    <span class="toc-badge">2,594 records | 17 vars</span>
                </a>

                <a href="#JHB_Aurum_009" class="toc-item">
                    <span>JHB_Aurum_009</span>
                    <span class="toc-badge">12,575 records | 36 vars</span>
                </a>

                <a href="#JHB_VIDA_007" class="toc-item">
                    <span>JHB_VIDA_007</span>
                    <span class="toc-badge">15,581 records | 28 vars</span>
                </a>

                <a href="#JHB_Ezin_002" class="toc-item">
                    <span>JHB_Ezin_002</span>
                    <span class="toc-badge">11,059 records | 41 vars</span>
                </a>

                <a href="#JHB_DPHRU_053" class="toc-item">
                    <span>JHB_DPHRU_053</span>
                    <span class="toc-badge">1,013 records | 49 vars</span>
                </a>

                <a href="#JHB_DPHRU_013" class="toc-item">
                    <span>JHB_DPHRU_013</span>
                    <span class="toc-badge">784 records | 33 vars</span>
                </a>

                <a href="#JHB_EZIN_025" class="toc-item">
                    <span>JHB_EZIN_025</span>
                    <span class="toc-badge">489 records | 17 vars</span>
                </a>

                <a href="#JHB_SCHARP_004" class="toc-item">
                    <span>JHB_SCHARP_004</span>
                    <span class="toc-badge">403 records | 23 vars</span>
                </a>

                <a href="#JHB_SCHARP_006" class="toc-item">
                    <span>JHB_SCHARP_006</span>
                    <span class="toc-badge">1,359 records | 22 vars</span>
                </a>

            </div>
        </div>

        <div class="study-section" id="JHB_WRHI_001">
            <div class="study-header">
                <h2>JHB_WRHI_001</h2>
                <div class="study-name">A5175/PEARLS - Stavudine vs Tenofovir ART Trial</div>
            </div>
            <div class="study-content">

                <div class="info-section">
                    <h3>Study Information</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">Study Type</div>
                            <div class="info-value">Randomized Controlled Trial</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Data Format</div>
                            <div class="info-value">ADaM (CDISC)</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Site</div>
                            <div class="info-value">Johannesburg, South Africa</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Population</div>
                            <div class="info-value">HIV-positive adults initiating ART</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Total Records</div>
                            <div class="info-value">21,015</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Unique Patients</div>
                            <div class="info-value">1,072</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Source Path</div>
                            <div class="info-value" style="font-size: 0.75rem; word-break: break-all;">/home/cparker/incoming/RP2/JHB_WRHI_001/csv</div>
                        </div>
                    </div>
                </div>

                <div class="info-section">
                    <h3>Harmonization Methodology</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">Version</div>
                            <div class="info-value">2.0_LONGITUDINAL</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Script</div>
                            <div class="info-value" style="font-family: monospace; font-size: 0.85rem;">JHB_WRHI_001_LONGITUDINAL_HARMONIZER.py</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Date</div>
                            <div class="info-value">2025-12-02</div>
                        </div>
                    </div>
                </div>

                <div class="info-section">
                    <h3>Critical Study Context Notes</h3>
                    <ul class="notes-list">
                        <li>All participants are HIV-positive adults</li>
                        <li>Randomized to Stavudine-based vs Tenofovir-based ART</li>
                        <li>ADaM format follows CDISC standards</li>
                        <li>Laboratory data in wide format with LBORRESN__* columns</li>

                    </ul>
                </div>

                <div class="info-section">
                    <h3>Source Files</h3>
                    <table class="source-files-table">
                        <thead>
                            <tr>
                                <th>File Name</th>
                                <th>Description</th>
                                <th>Records</th>
                                <th>Key Columns</th>
                            </tr>
                        </thead>
                        <tbody>

                            <tr>
                                <td style="font-family: monospace; font-size: 0.85rem;">ADSL.csv</td>
                                <td>Subject-level demographics (baseline characteristics)</td>
                                <td>1072</td>
                                <td style="font-family: monospace; font-size: 0.8rem;">PT, PTAGE, SEX, RACE, TRT01A</td>
                            </tr>

                            <tr>
                                <td style="font-family: monospace; font-size: 0.85rem;">ADHIV.csv</td>
                                <td>HIV viral load measurements (longitudinal)</td>
                                <td>9093</td>
                                <td style="font-family: monospace; font-size: 0.8rem;">PT, AVISIT, AVISITN, LBDTN, LBORRESN</td>
                            </tr>

                            <tr>
                                <td style="font-family: monospace; font-size: 0.85rem;">ADLB.csv</td>
                                <td>Laboratory results - CD4, CBC, chemistry (longitudinal)</td>
                                <td>11319</td>
                                <td style="font-family: monospace; font-size: 0.8rem;">PT, AVISIT, AVISITN, LBDTN, LBORRESN__*</td>
                            </tr>

                            <tr>
                                <td style="font-family: monospace; font-size: 0.85rem;">ADVS.csv</td>
                                <td>Vital signs measurements (longitudinal)</td>
                                <td>8613</td>
                                <td style="font-family: monospace; font-size: 0.8rem;">PT, AVISIT, AVISITN, VSDTN, SYSBP, DIABP, PULSE</td>
                            </tr>

                        </tbody>
                    </table>
                </div>

                <div class="info-section">
                    <h3>Complete Variable Lineage & Transformation Details</h3>
                    <table class="lineage-table">
                        <thead>
                            <tr>
                                <th style="width: 12%;">Variable</th>
                                <th style="width: 15%;">Source File</th>
                                <th style="width: 15%;">Source Column(s)</th>
                                <th style="width: 8%;">Units</th>
                                <th style="width: 25%;">Transformation Code</th>
                                <th style="width: 25%;">Notes</th>
                            </tr>
                        </thead>
                        <tbody>

                            <tr>
                                <td><span class="var-name">patient_id</span></td>
                                <td><span class="source-file">ADSL.csv</span></td>
                                <td><span class="source-cols">PT</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['patient_id'] = df['PT']</div><div class="transform-desc">Direct mapping, no transformation</div></td>
                                <td class="notes-cell">Unique patient identifier across all ADaM datasets</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">age_years</span></td>
                                <td><span class="source-file">ADSL.csv</span></td>
                                <td><span class="source-cols">PTAGE</span></td>
                                <td><span class="unit-badge">years</span></td>
                                <td><div class="code-block">df['age_years'] = df['PTAGE']</div><div class="transform-desc">Direct mapping, no transformation</div></td>
                                <td class="notes-cell">Age at study enrollment</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">sex</span></td>
                                <td><span class="source-file">ADSL.csv</span></td>
                                <td><span class="source-cols">SEX</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['sex'] = df['SEX'].map({'F': 'Female', 'M': 'Male', 'FEMALE': 'Female', 'MALE': 'Male'})</div><div class="transform-desc">Standardize sex codes to full words</div></td>
                                <td class="notes-cell">F/M/FEMALE/MALE → Female/Male</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">race</span></td>
                                <td><span class="source-file">ADSL.csv</span></td>
                                <td><span class="source-cols">RACE</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['race'] = df['RACE']</div><div class="transform-desc">Direct mapping, no transformation</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">treatment_arm</span></td>
                                <td><span class="source-file">ADSL.csv</span></td>
                                <td><span class="source-cols">TRT01A</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['treatment_arm'] = df['TRT01A']</div><div class="transform-desc">Direct mapping, actual treatment assigned</div></td>
                                <td class="notes-cell">TRT01A = Actual Treatment for Period 01</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">visit</span></td>
                                <td><span class="source-file">ADHIV.csv</span></td>
                                <td><span class="source-cols">AVISIT</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['visit'] = df['AVISIT']</div><div class="transform-desc">Direct mapping of analysis visit name</div></td>
                                <td class="notes-cell">ADaM standard visit naming</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">visit_num</span></td>
                                <td><span class="source-file">ADHIV.csv</span></td>
                                <td><span class="source-cols">AVISITN</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['visit_num'] = pd.to_numeric(df['AVISITN'], errors='coerce')</div><div class="transform-desc">Convert to numeric for sorting</div></td>
                                <td class="notes-cell">ADaM standard visit number</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">visit_date</span></td>
                                <td><span class="source-file">ADHIV.csv</span></td>
                                <td><span class="source-cols">LBDTN</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['visit_date'] = pd.to_datetime(df['LBDTN'], format='%Y%m%d', errors='coerce')</div><div class="transform-desc">Convert YYYYMMDD integer to datetime</div></td>
                                <td class="notes-cell">Lab date in numeric format</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">viral_load</span></td>
                                <td><span class="source-file">ADHIV.csv</span></td>
                                <td><span class="source-cols">LBORRESN</span></td>
                                <td><span class="unit-badge">copies/mL</span></td>
                                <td><div class="code-block">df['viral_load'] = pd.to_numeric(df['LBORRESN'], errors='coerce')</div><div class="transform-desc">Extract numeric result value</div></td>
                                <td class="notes-cell">HIV-1 RNA viral load, numeric result</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">viral_load_undetectable</span></td>
                                <td><span class="source-file">DERIVED</span></td>
                                <td><span class="source-cols">viral_load</span></td>
                                <td><span class="unit-badge">boolean (0/1)</span></td>
                                <td><div class="formula-box"><strong>Formula:</strong> viral_load < 50</div><div class="code-block">df['viral_load_undetectable'] = (df['viral_load'] &lt; 50).astype(int)</div><div class="transform-desc">Flag for undetectable viral load using 50 copies/mL threshold</div></td>
                                <td class="notes-cell">Standard undetectable threshold; 1 = undetectable, 0 = detectable</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">log10_viral_load</span></td>
                                <td><span class="source-file">DERIVED</span></td>
                                <td><span class="source-cols">viral_load</span></td>
                                <td><span class="unit-badge">log10(copies/mL)</span></td>
                                <td><div class="formula-box"><strong>Formula:</strong> log10(viral_load) where viral_load > 0</div><div class="code-block">df['log10_viral_load'] = np.where(df['viral_load'] &gt; 0, np.log10(df['viral_load']), np.nan)</div><div class="transform-desc">Log10 transformation for analysis; NaN for zero/negative values</div></td>
                                <td class="notes-cell">Used for statistical analysis of viral load</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">cd4_count</span></td>
                                <td><span class="source-file">ADLB.csv</span></td>
                                <td><span class="source-cols">LBORRESN__HEMATOLOGY-CD4CELL</span></td>
                                <td><span class="unit-badge">cells/µL</span></td>
                                <td><div class="code-block">df['cd4_count'] = pd.to_numeric(df['LBORRESN__HEMATOLOGY-CD4CELL'], errors='coerce')</div><div class="transform-desc">Extract CD4 count from wide-format lab results</div></td>
                                <td class="notes-cell">CD4+ T-cell absolute count</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">hemoglobin</span></td>
                                <td><span class="source-file">ADLB.csv</span></td>
                                <td><span class="source-cols">LBORRESN__HEMATOLOGY-HGB</span></td>
                                <td><span class="unit-badge">g/dL</span></td>
                                <td><div class="code-block">df['hemoglobin'] = pd.to_numeric(df['LBORRESN__HEMATOLOGY-HGB'], errors='coerce')</div><div class="transform-desc">Extract hemoglobin from wide-format lab results</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">hematocrit</span></td>
                                <td><span class="source-file">ADLB.csv</span></td>
                                <td><span class="source-cols">LBORRESN__HEMATOLOGY-HCT</span></td>
                                <td><span class="unit-badge">%</span></td>
                                <td><div class="code-block">df['hematocrit'] = pd.to_numeric(df['LBORRESN__HEMATOLOGY-HCT'], errors='coerce')</div><div class="transform-desc">Extract hematocrit from wide-format lab results</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">wbc</span></td>
                                <td><span class="source-file">ADLB.csv</span></td>
                                <td><span class="source-cols">LBORRESN__HEMATOLOGY-WBC</span></td>
                                <td><span class="unit-badge">10^9/L</span></td>
                                <td><div class="code-block">df['wbc'] = pd.to_numeric(df['LBORRESN__HEMATOLOGY-WBC'], errors='coerce')</div><div class="transform-desc">Extract WBC from wide-format lab results</div></td>
                                <td class="notes-cell">White blood cell count</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">platelets</span></td>
                                <td><span class="source-file">ADLB.csv</span></td>
                                <td><span class="source-cols">LBORRESN__HEMATOLOGY-PLATELET</span></td>
                                <td><span class="unit-badge">10^9/L</span></td>
                                <td><div class="code-block">df['platelets'] = pd.to_numeric(df['LBORRESN__HEMATOLOGY-PLATELET'], errors='coerce')</div><div class="transform-desc">Extract platelet count from wide-format lab results</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">ast</span></td>
                                <td><span class="source-file">ADLB.csv</span></td>
                                <td><span class="source-cols">LBORRESN__CHEMISTRY-AST</span></td>
                                <td><span class="unit-badge">U/L</span></td>
                                <td><div class="code-block">df['ast'] = pd.to_numeric(df['LBORRESN__CHEMISTRY-AST'], errors='coerce')</div><div class="transform-desc">Extract AST from wide-format lab results</div></td>
                                <td class="notes-cell">Aspartate aminotransferase (liver enzyme)</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">alt</span></td>
                                <td><span class="source-file">ADLB.csv</span></td>
                                <td><span class="source-cols">LBORRESN__CHEMISTRY-ALT</span></td>
                                <td><span class="unit-badge">U/L</span></td>
                                <td><div class="code-block">df['alt'] = pd.to_numeric(df['LBORRESN__CHEMISTRY-ALT'], errors='coerce')</div><div class="transform-desc">Extract ALT from wide-format lab results</div></td>
                                <td class="notes-cell">Alanine aminotransferase (liver enzyme)</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">creatinine</span></td>
                                <td><span class="source-file">ADLB.csv</span></td>
                                <td><span class="source-cols">LBORRESN__CHEMISTRY-CREAT</span></td>
                                <td><span class="unit-badge">mg/dL</span></td>
                                <td><div class="code-block">df['creatinine'] = pd.to_numeric(df['LBORRESN__CHEMISTRY-CREAT'], errors='coerce')</div><div class="transform-desc">Extract creatinine from wide-format lab results</div></td>
                                <td class="notes-cell">Kidney function marker</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">fasting_glucose</span></td>
                                <td><span class="source-file">ADLB.csv</span></td>
                                <td><span class="source-cols">LBORRESN__CHEMISTRY-GLUCOSE</span></td>
                                <td><span class="unit-badge">mg/dL</span></td>
                                <td><div class="code-block">df['fasting_glucose'] = pd.to_numeric(df['LBORRESN__CHEMISTRY-GLUCOSE'], errors='coerce')</div><div class="transform-desc">Extract glucose from wide-format lab results</div></td>
                                <td class="notes-cell">Fasting blood glucose</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">total_cholesterol</span></td>
                                <td><span class="source-file">ADLB.csv</span></td>
                                <td><span class="source-cols">LBORRESN__CHEMISTRY-TCHOL</span></td>
                                <td><span class="unit-badge">mg/dL</span></td>
                                <td><div class="code-block">df['total_cholesterol'] = pd.to_numeric(df['LBORRESN__CHEMISTRY-TCHOL'], errors='coerce')</div><div class="transform-desc">Extract total cholesterol from wide-format lab results</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">hdl_cholesterol</span></td>
                                <td><span class="source-file">ADLB.csv</span></td>
                                <td><span class="source-cols">LBORRESN__CHEMISTRY-HDL</span></td>
                                <td><span class="unit-badge">mg/dL</span></td>
                                <td><div class="code-block">df['hdl_cholesterol'] = pd.to_numeric(df['LBORRESN__CHEMISTRY-HDL'], errors='coerce')</div><div class="transform-desc">Extract HDL cholesterol from wide-format lab results</div></td>
                                <td class="notes-cell">High-density lipoprotein</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">ldl_cholesterol</span></td>
                                <td><span class="source-file">ADLB.csv</span></td>
                                <td><span class="source-cols">LBORRESN__CHEMISTRY-LDL</span></td>
                                <td><span class="unit-badge">mg/dL</span></td>
                                <td><div class="code-block">df['ldl_cholesterol'] = pd.to_numeric(df['LBORRESN__CHEMISTRY-LDL'], errors='coerce')</div><div class="transform-desc">Extract LDL cholesterol from wide-format lab results</div></td>
                                <td class="notes-cell">Low-density lipoprotein</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">triglycerides</span></td>
                                <td><span class="source-file">ADLB.csv</span></td>
                                <td><span class="source-cols">LBORRESN__CHEMISTRY-TRIGLY</span></td>
                                <td><span class="unit-badge">mg/dL</span></td>
                                <td><div class="code-block">df['triglycerides'] = pd.to_numeric(df['LBORRESN__CHEMISTRY-TRIGLY'], errors='coerce')</div><div class="transform-desc">Extract triglycerides from wide-format lab results</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">total_bilirubin</span></td>
                                <td><span class="source-file">ADLB.csv</span></td>
                                <td><span class="source-cols">LBORRESN__CHEMISTRY-TLBILI</span></td>
                                <td><span class="unit-badge">mg/dL</span></td>
                                <td><div class="code-block">df['total_bilirubin'] = pd.to_numeric(df['LBORRESN__CHEMISTRY-TLBILI'], errors='coerce')</div><div class="transform-desc">Extract total bilirubin from wide-format lab results</div></td>
                                <td class="notes-cell">Liver function marker</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">albumin</span></td>
                                <td><span class="source-file">ADLB.csv</span></td>
                                <td><span class="source-cols">LBORRESN__CHEMISTRY-ALBUMIN</span></td>
                                <td><span class="unit-badge">g/dL</span></td>
                                <td><div class="code-block">df['albumin'] = pd.to_numeric(df['LBORRESN__CHEMISTRY-ALBUMIN'], errors='coerce')</div><div class="transform-desc">Extract albumin from wide-format lab results</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">sodium</span></td>
                                <td><span class="source-file">ADLB.csv</span></td>
                                <td><span class="source-cols">LBORRESN__CHEMISTRY-SODIUM</span></td>
                                <td><span class="unit-badge">mEq/L</span></td>
                                <td><div class="code-block">df['sodium'] = pd.to_numeric(df['LBORRESN__CHEMISTRY-SODIUM'], errors='coerce')</div><div class="transform-desc">Extract sodium from wide-format lab results</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">potassium</span></td>
                                <td><span class="source-file">ADLB.csv</span></td>
                                <td><span class="source-cols">LBORRESN__CHEMISTRY-K</span></td>
                                <td><span class="unit-badge">mEq/L</span></td>
                                <td><div class="code-block">df['potassium'] = pd.to_numeric(df['LBORRESN__CHEMISTRY-K'], errors='coerce')</div><div class="transform-desc">Extract potassium from wide-format lab results</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">systolic_bp</span></td>
                                <td><span class="source-file">ADVS.csv</span></td>
                                <td><span class="source-cols">SYSBP</span></td>
                                <td><span class="unit-badge">mmHg</span></td>
                                <td><div class="code-block">df['systolic_bp'] = pd.to_numeric(df['SYSBP'], errors='coerce')</div><div class="transform-desc">Extract systolic blood pressure</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">diastolic_bp</span></td>
                                <td><span class="source-file">ADVS.csv</span></td>
                                <td><span class="source-cols">DIABP</span></td>
                                <td><span class="unit-badge">mmHg</span></td>
                                <td><div class="code-block">df['diastolic_bp'] = pd.to_numeric(df['DIABP'], errors='coerce')</div><div class="transform-desc">Extract diastolic blood pressure</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">heart_rate</span></td>
                                <td><span class="source-file">ADVS.csv</span></td>
                                <td><span class="source-cols">PULSE</span></td>
                                <td><span class="unit-badge">bpm</span></td>
                                <td><div class="code-block">df['heart_rate'] = pd.to_numeric(df['PULSE'], errors='coerce')</div><div class="transform-desc">Extract heart rate/pulse</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">height_cm</span></td>
                                <td><span class="source-file">ADVS.csv</span></td>
                                <td><span class="source-cols">HEIGHT</span></td>
                                <td><span class="unit-badge">cm</span></td>
                                <td><div class="code-block">df['height_cm'] = pd.to_numeric(df['HEIGHT'], errors='coerce')</div><div class="transform-desc">Extract height in centimeters</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">weight_kg</span></td>
                                <td><span class="source-file">ADVS.csv</span></td>
                                <td><span class="source-cols">WEIGHT</span></td>
                                <td><span class="unit-badge">kg</span></td>
                                <td><div class="code-block">df['weight_kg'] = pd.to_numeric(df['WEIGHT'], errors='coerce')</div><div class="transform-desc">Extract weight in kilograms</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">bmi</span></td>
                                <td><span class="source-file">DERIVED</span></td>
                                <td><span class="source-cols">HEIGHT, WEIGHT</span></td>
                                <td><span class="unit-badge">kg/m²</span></td>
                                <td><div class="formula-box"><strong>Formula:</strong> weight_kg / (height_cm / 100)²</div><div class="code-block">height_m = df['height_cm'] / 100
df['bmi'] = df['weight_kg'] / (height_m ** 2)</div><div class="transform-desc">Calculate BMI from height and weight using standard formula</div></td>
                                <td class="notes-cell">BMI = weight(kg) / height(m)²; height converted from cm to m</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">hiv_status</span></td>
                                <td><span class="source-file">STUDY_DESIGN</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['hiv_status'] = 'Positive'</div><div class="transform-desc">All participants HIV-positive by study design (inclusion criteria)</div></td>
                                <td class="notes-cell">Study inclusion criterion: HIV-positive adults</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">hiv_positive</span></td>
                                <td><span class="source-file">STUDY_DESIGN</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td><span class="unit-badge">boolean (0/1)</span></td>
                                <td><div class="code-block">df['hiv_positive'] = 1</div><div class="transform-desc">All participants HIV-positive by study design</div></td>
                                <td class="notes-cell">1 = HIV-positive; study inclusion criterion</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">on_art</span></td>
                                <td><span class="source-file">STUDY_DESIGN</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td><span class="unit-badge">boolean (0/1)</span></td>
                                <td><div class="code-block">df['on_art'] = 1</div><div class="transform-desc">All participants on ART by study design (ART trial)</div></td>
                                <td class="notes-cell">1 = on ART; this is an antiretroviral therapy trial</td>
                            </tr>

                        </tbody>
                    </table>
                </div>

            </div>
        </div>

        <div class="study-section" id="JHB_WRHI_003">
            <div class="study-header">
                <h2>JHB_WRHI_003</h2>
                <div class="study-name">WRHI003 Low-dose Ritonavir-boosted Darunavir HIV Trial</div>
            </div>
            <div class="study-content">

                <div class="info-section">
                    <h3>Study Information</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">Study Type</div>
                            <div class="info-value">Randomized Controlled Trial</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Data Format</div>
                            <div class="info-value">Listings Format (Clinical trial listings)</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Site</div>
                            <div class="info-value">Charlotte Maxeke Johannesburg Academic Hospital</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Population</div>
                            <div class="info-value">HIV-positive adults on ART</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Total Records</div>
                            <div class="info-value">2,235</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Unique Patients</div>
                            <div class="info-value">300</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Source Path</div>
                            <div class="info-value" style="font-size: 0.75rem; word-break: break-all;">/home/cparker/incoming/RP2/JHB_WRHI_003/csv</div>
                        </div>
                    </div>
                </div>

                <div class="info-section">
                    <h3>Harmonization Methodology</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">Version</div>
                            <div class="info-value">2.0_LONGITUDINAL</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Script</div>
                            <div class="info-value" style="font-family: monospace; font-size: 0.85rem;">JHB_WRHI_003_LONGITUDINAL_HARMONIZER.py</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Date</div>
                            <div class="info-value">2025-12-02</div>
                        </div>
                    </div>
                </div>

                <div class="info-section">
                    <h3>Critical Study Context Notes</h3>
                    <ul class="notes-list">
                        <li>All participants are HIV-positive adults on ART</li>
                        <li>Randomized to low-dose ritonavir-boosted darunavir regimens</li>
                        <li>Data in 'Listings' format - each lab domain in separate file</li>
                        <li>Viral load stored as text ('Not detected', '< 50', numeric values)</li>

                    </ul>
                </div>

                <div class="info-section">
                    <h3>Source Files</h3>
                    <table class="source-files-table">
                        <thead>
                            <tr>
                                <th>File Name</th>
                                <th>Description</th>
                                <th>Records</th>
                                <th>Key Columns</th>
                            </tr>
                        </thead>
                        <tbody>

                            <tr>
                                <td style="font-family: monospace; font-size: 0.85rem;">Listing 03 - Demographics All Randomised Set.csv</td>
                                <td>Baseline demographics for all randomized patients</td>
                                <td>300</td>
                                <td style="font-family: monospace; font-size: 0.8rem;">ptd, randdate, txgroup, age, sex, race, height, weight</td>
                            </tr>

                            <tr>
                                <td style="font-family: monospace; font-size: 0.85rem;">Listing 09 - HIV-1 RNA All Randomised Set.csv</td>
                                <td>HIV viral load measurements (longitudinal)</td>
                                <td>1510</td>
                                <td style="font-family: monospace; font-size: 0.8rem;">ptd, visit, colldate, txgroup, result</td>
                            </tr>

                            <tr>
                                <td style="font-family: monospace; font-size: 0.85rem;">Listing 11 - Haematology All Randomised Set.csv</td>
                                <td>Hematology panel including CD4 (longitudinal)</td>
                                <td>1487</td>
                                <td style="font-family: monospace; font-size: 0.8rem;">ptd, visit, colldate, result__*</td>
                            </tr>

                            <tr>
                                <td style="font-family: monospace; font-size: 0.85rem;">Listing 12 - Chemistry All Randomised Set.csv</td>
                                <td>Chemistry panel (longitudinal)</td>
                                <td>1517</td>
                                <td style="font-family: monospace; font-size: 0.8rem;">ptd, visit, colldate, result__*</td>
                            </tr>

                            <tr>
                                <td style="font-family: monospace; font-size: 0.85rem;">Listing 14 - Vitals Signs All Randomised Set.csv</td>
                                <td>Vital signs measurements (longitudinal)</td>
                                <td>2127</td>
                                <td style="font-family: monospace; font-size: 0.8rem;">ptd, visit, visit_date, systolic_BP, diastolic_BP, heart_rate</td>
                            </tr>

                        </tbody>
                    </table>
                </div>

                <div class="info-section">
                    <h3>Complete Variable Lineage & Transformation Details</h3>
                    <table class="lineage-table">
                        <thead>
                            <tr>
                                <th style="width: 12%;">Variable</th>
                                <th style="width: 15%;">Source File</th>
                                <th style="width: 15%;">Source Column(s)</th>
                                <th style="width: 8%;">Units</th>
                                <th style="width: 25%;">Transformation Code</th>
                                <th style="width: 25%;">Notes</th>
                            </tr>
                        </thead>
                        <tbody>

                            <tr>
                                <td><span class="var-name">patient_id</span></td>
                                <td><span class="source-file">Listing 03 - Demographics All Randomised Set.csv</span></td>
                                <td><span class="source-cols">ptd</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['patient_id'] = df['ptd']</div><div class="transform-desc">Direct mapping of participant ID</div></td>
                                <td class="notes-cell">Unique patient identifier</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">randomization_date</span></td>
                                <td><span class="source-file">Listing 03 - Demographics All Randomised Set.csv</span></td>
                                <td><span class="source-cols">randdate</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['randomization_date'] = pd.to_datetime(df['randdate'])</div><div class="transform-desc">Convert to datetime format</div></td>
                                <td class="notes-cell">Date of randomization to treatment arm</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">treatment_arm</span></td>
                                <td><span class="source-file">Listing 03 - Demographics All Randomised Set.csv</span></td>
                                <td><span class="source-cols">txgroup</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['treatment_arm'] = df['txgroup']</div><div class="transform-desc">Direct mapping of treatment group</div></td>
                                <td class="notes-cell">Assigned treatment arm</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">age_years</span></td>
                                <td><span class="source-file">Listing 03 - Demographics All Randomised Set.csv</span></td>
                                <td><span class="source-cols">age</span></td>
                                <td><span class="unit-badge">years</span></td>
                                <td><div class="code-block">df['age_years'] = pd.to_numeric(df['age'], errors='coerce')</div><div class="transform-desc">Convert to numeric</div></td>
                                <td class="notes-cell">Age at enrollment</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">sex</span></td>
                                <td><span class="source-file">Listing 03 - Demographics All Randomised Set.csv</span></td>
                                <td><span class="source-cols">sex</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['sex'] = df['sex'].str.capitalize()</div><div class="transform-desc">Capitalize first letter for consistency</div></td>
                                <td class="notes-cell">Standardized to 'Male'/'Female'</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">race</span></td>
                                <td><span class="source-file">Listing 03 - Demographics All Randomised Set.csv</span></td>
                                <td><span class="source-cols">race</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['race'] = df['race']</div><div class="transform-desc">Direct mapping</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">height_cm</span></td>
                                <td><span class="source-file">Listing 03 - Demographics All Randomised Set.csv</span></td>
                                <td><span class="source-cols">height</span></td>
                                <td><span class="unit-badge">cm</span></td>
                                <td><div class="code-block">df['height_cm'] = pd.to_numeric(df['height'], errors='coerce')</div><div class="transform-desc">Convert to numeric</div></td>
                                <td class="notes-cell">Height at baseline</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">weight_kg</span></td>
                                <td><span class="source-file">Listing 03 - Demographics All Randomised Set.csv</span></td>
                                <td><span class="source-cols">weight</span></td>
                                <td><span class="unit-badge">kg</span></td>
                                <td><div class="code-block">df['weight_kg'] = pd.to_numeric(df['weight'], errors='coerce')</div><div class="transform-desc">Convert to numeric</div></td>
                                <td class="notes-cell">Weight at baseline</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">bmi</span></td>
                                <td><span class="source-file">DERIVED</span></td>
                                <td><span class="source-cols">height, weight</span></td>
                                <td><span class="unit-badge">kg/m²</span></td>
                                <td><div class="formula-box"><strong>Formula:</strong> weight_kg / (height_cm / 100)²</div><div class="code-block">df['height_m'] = df['height_cm'] / 100
df['bmi'] = df['weight_kg'] / (df['height_m'] ** 2)</div><div class="transform-desc">Calculate BMI from height (converted to meters) and weight</div></td>
                                <td class="notes-cell">Standard BMI formula: weight(kg) / height(m)²</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">visit</span></td>
                                <td><span class="source-file">Multiple files</span></td>
                                <td><span class="source-cols">visit</span></td>
                                <td>-</td>
                                <td><div class="code-block">def standardize_visit(visit):
    if pd.isna(visit):
        return None
    visit = str(visit).lower().strip()
    if 'screening' in visit:
        return 'screening'
    elif 'enrolment' in visit:
        return 'enrolment'
    elif 'week 04' in visit or 'week04' in visit:
        return 'week_04'
    elif 'week 12' in visit or 'week12' in visit:
        return 'week_12'
    elif 'week 24' in visit or 'week24' in visit:
        return 'week_24'
    elif 'week 36' in visit or 'week36' in visit:
        return 'week_36'
    elif 'week 48' in visit or 'week48' in visit:
        return 'week_48'
    elif 'early' in visit or 'term' in visit:
        return 'early_termination'
    elif 'unschedule' in visit:
        return 'unscheduled'
    else:
        return 'other'
df['visit'] = df['visit'].apply(standardize_visit)</div><div class="transform-desc">Standardize visit names to consistent format</div></td>
                                <td class="notes-cell">Original visit names vary; standardized to: screening, enrolment, week_04, week_12, week_24, week_36, week_48, early_termination, unscheduled</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">visit_date</span></td>
                                <td><span class="source-file">Listing 09 - HIV-1 RNA All Randomised Set.csv</span></td>
                                <td><span class="source-cols">colldate</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['visit_date'] = pd.to_datetime(df['colldate'], format='%Y%m%d', errors='coerce')</div><div class="transform-desc">Convert YYYYMMDD integer to datetime</div></td>
                                <td class="notes-cell">Collection date in numeric YYYYMMDD format</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">viral_load</span></td>
                                <td><span class="source-file">Listing 09 - HIV-1 RNA All Randomised Set.csv</span></td>
                                <td><span class="source-cols">result</span></td>
                                <td><span class="unit-badge">copies/mL</span></td>
                                <td><div class="code-block">def parse_viral_load(val):
    if pd.isna(val):
        return np.nan
    val_str = str(val).strip().lower()
    if val_str in ['not detected', 'not detect']:
        return 0  # Undetectable
    elif val_str.startswith('&lt; '):
        try:
            return float(val_str.replace('&lt; ', ''))
        except:
            return np.nan
    else:
        try:
            return float(val_str)
        except:
            return np.nan
df['viral_load'] = df['result'].apply(parse_viral_load)</div><div class="transform-desc">Parse text viral load values: 'Not detected'→0, '< X'→X, numeric→numeric</div></td>
                                <td class="notes-cell">IMPORTANT: This is an ART trial - patients are on treatment. Low/undetectable viral loads are EXPECTED and CORRECT. 0 means undetectable, not missing.</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">viral_load_raw</span></td>
                                <td><span class="source-file">Listing 09 - HIV-1 RNA All Randomised Set.csv</span></td>
                                <td><span class="source-cols">result</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['viral_load_raw'] = df['result']</div><div class="transform-desc">Preserve original text value for audit</div></td>
                                <td class="notes-cell">Original text preserved: 'Not detected', '< 50', numeric values</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">viral_load_undetectable</span></td>
                                <td><span class="source-file">DERIVED</span></td>
                                <td><span class="source-cols">viral_load</span></td>
                                <td><span class="unit-badge">boolean (0/1)</span></td>
                                <td><div class="formula-box"><strong>Formula:</strong> viral_load == 0</div><div class="code-block">df['viral_load_undetectable'] = (df['viral_load'] == 0).astype(int)</div><div class="transform-desc">Flag for undetectable viral load</div></td>
                                <td class="notes-cell">1 = undetectable (viral_load == 0), 0 = detectable</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">log10_viral_load</span></td>
                                <td><span class="source-file">DERIVED</span></td>
                                <td><span class="source-cols">viral_load</span></td>
                                <td><span class="unit-badge">log10(copies/mL)</span></td>
                                <td><div class="formula-box"><strong>Formula:</strong> log10(viral_load) where viral_load > 0</div><div class="code-block">df['log10_viral_load'] = np.where(df['viral_load'] &gt; 0, np.log10(df['viral_load']), np.nan)</div><div class="transform-desc">Log10 transformation; NaN for undetectable (0) values</div></td>
                                <td class="notes-cell">Used for statistical analysis; undetectable values become NaN</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">cd4_count</span></td>
                                <td><span class="source-file">Listing 11 - Haematology All Randomised Set.csv</span></td>
                                <td><span class="source-cols">result__CD4 cell count</span></td>
                                <td><span class="unit-badge">cells/µL</span></td>
                                <td><div class="code-block">df['cd4_count'] = pd.to_numeric(df['result__CD4 cell count'], errors='coerce')</div><div class="transform-desc">Extract CD4 count from pivot-formatted hematology data</div></td>
                                <td class="notes-cell">CD4+ T-lymphocyte absolute count</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">hemoglobin</span></td>
                                <td><span class="source-file">Listing 11 - Haematology All Randomised Set.csv</span></td>
                                <td><span class="source-cols">result__hemoglobin</span></td>
                                <td><span class="unit-badge">g/dL</span></td>
                                <td><div class="code-block">df['hemoglobin'] = pd.to_numeric(df['result__hemoglobin'], errors='coerce')</div><div class="transform-desc">Extract hemoglobin from pivot-formatted hematology data</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">wbc</span></td>
                                <td><span class="source-file">Listing 11 - Haematology All Randomised Set.csv</span></td>
                                <td><span class="source-cols">result__WBC</span></td>
                                <td><span class="unit-badge">10^9/L</span></td>
                                <td><div class="code-block">df['wbc'] = pd.to_numeric(df['result__WBC'], errors='coerce')</div><div class="transform-desc">Extract WBC from pivot-formatted hematology data</div></td>
                                <td class="notes-cell">White blood cell count</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">rbc</span></td>
                                <td><span class="source-file">Listing 11 - Haematology All Randomised Set.csv</span></td>
                                <td><span class="source-cols">result__RBC</span></td>
                                <td><span class="unit-badge">10^12/L</span></td>
                                <td><div class="code-block">df['rbc'] = pd.to_numeric(df['result__RBC'], errors='coerce')</div><div class="transform-desc">Extract RBC from pivot-formatted hematology data</div></td>
                                <td class="notes-cell">Red blood cell count</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">platelets</span></td>
                                <td><span class="source-file">Listing 11 - Haematology All Randomised Set.csv</span></td>
                                <td><span class="source-cols">result__platelets</span></td>
                                <td><span class="unit-badge">10^9/L</span></td>
                                <td><div class="code-block">df['platelets'] = pd.to_numeric(df['result__platelets'], errors='coerce')</div><div class="transform-desc">Extract platelets from pivot-formatted hematology data</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">neutrophils</span></td>
                                <td><span class="source-file">Listing 11 - Haematology All Randomised Set.csv</span></td>
                                <td><span class="source-cols">result__neutrophils</span></td>
                                <td><span class="unit-badge">10^9/L</span></td>
                                <td><div class="code-block">df['neutrophils'] = pd.to_numeric(df['result__neutrophils'], errors='coerce')</div><div class="transform-desc">Extract neutrophils from pivot-formatted hematology data</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">lymphocytes</span></td>
                                <td><span class="source-file">Listing 11 - Haematology All Randomised Set.csv</span></td>
                                <td><span class="source-cols">result__lymphocytes</span></td>
                                <td><span class="unit-badge">10^9/L</span></td>
                                <td><div class="code-block">df['lymphocytes'] = pd.to_numeric(df['result__lymphocytes'], errors='coerce')</div><div class="transform-desc">Extract lymphocytes from pivot-formatted hematology data</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">monocytes</span></td>
                                <td><span class="source-file">Listing 11 - Haematology All Randomised Set.csv</span></td>
                                <td><span class="source-cols">result__monocytes</span></td>
                                <td><span class="unit-badge">10^9/L</span></td>
                                <td><div class="code-block">df['monocytes'] = pd.to_numeric(df['result__monocytes'], errors='coerce')</div><div class="transform-desc">Extract monocytes from pivot-formatted hematology data</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">eosinophils</span></td>
                                <td><span class="source-file">Listing 11 - Haematology All Randomised Set.csv</span></td>
                                <td><span class="source-cols">result__eosinophils</span></td>
                                <td><span class="unit-badge">10^9/L</span></td>
                                <td><div class="code-block">df['eosinophils'] = pd.to_numeric(df['result__eosinophils'], errors='coerce')</div><div class="transform-desc">Extract eosinophils from pivot-formatted hematology data</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">basophils</span></td>
                                <td><span class="source-file">Listing 11 - Haematology All Randomised Set.csv</span></td>
                                <td><span class="source-cols">result__Basophils</span></td>
                                <td><span class="unit-badge">10^9/L</span></td>
                                <td><div class="code-block">df['basophils'] = pd.to_numeric(df['result__Basophils'], errors='coerce')</div><div class="transform-desc">Extract basophils from pivot-formatted hematology data</div></td>
                                <td class="notes-cell">Note: source column uses capital B</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">mcv</span></td>
                                <td><span class="source-file">Listing 11 - Haematology All Randomised Set.csv</span></td>
                                <td><span class="source-cols">result__MCV</span></td>
                                <td><span class="unit-badge">fL</span></td>
                                <td><div class="code-block">df['mcv'] = pd.to_numeric(df['result__MCV'], errors='coerce')</div><div class="transform-desc">Extract MCV from pivot-formatted hematology data</div></td>
                                <td class="notes-cell">Mean corpuscular volume</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">mch</span></td>
                                <td><span class="source-file">Listing 11 - Haematology All Randomised Set.csv</span></td>
                                <td><span class="source-cols">result__Mean Corpsular Hemoglobin</span></td>
                                <td><span class="unit-badge">pg</span></td>
                                <td><div class="code-block">df['mch'] = pd.to_numeric(df['result__Mean Corpsular Hemoglobin'], errors='coerce')</div><div class="transform-desc">Extract MCH from pivot-formatted hematology data</div></td>
                                <td class="notes-cell">Mean corpuscular hemoglobin; note source has typo 'Corpsular'</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">mchc</span></td>
                                <td><span class="source-file">Listing 11 - Haematology All Randomised Set.csv</span></td>
                                <td><span class="source-cols">result__MCHC</span></td>
                                <td><span class="unit-badge">g/dL</span></td>
                                <td><div class="code-block">df['mchc'] = pd.to_numeric(df['result__MCHC'], errors='coerce')</div><div class="transform-desc">Extract MCHC from pivot-formatted hematology data</div></td>
                                <td class="notes-cell">Mean corpuscular hemoglobin concentration</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">rdw</span></td>
                                <td><span class="source-file">Listing 11 - Haematology All Randomised Set.csv</span></td>
                                <td><span class="source-cols">result__RDW</span></td>
                                <td><span class="unit-badge">%</span></td>
                                <td><div class="code-block">df['rdw'] = pd.to_numeric(df['result__RDW'], errors='coerce')</div><div class="transform-desc">Extract RDW from pivot-formatted hematology data</div></td>
                                <td class="notes-cell">Red cell distribution width</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">ast</span></td>
                                <td><span class="source-file">Listing 12 - Chemistry All Randomised Set.csv</span></td>
                                <td><span class="source-cols">result__AST</span></td>
                                <td><span class="unit-badge">U/L</span></td>
                                <td><div class="code-block">df['ast'] = pd.to_numeric(df['result__AST'], errors='coerce')</div><div class="transform-desc">Extract AST from pivot-formatted chemistry data</div></td>
                                <td class="notes-cell">Aspartate aminotransferase (liver enzyme)</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">alt</span></td>
                                <td><span class="source-file">Listing 12 - Chemistry All Randomised Set.csv</span></td>
                                <td><span class="source-cols">result__ALT</span></td>
                                <td><span class="unit-badge">U/L</span></td>
                                <td><div class="code-block">df['alt'] = pd.to_numeric(df['result__ALT'], errors='coerce')</div><div class="transform-desc">Extract ALT from pivot-formatted chemistry data</div></td>
                                <td class="notes-cell">Alanine aminotransferase (liver enzyme)</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">creatinine</span></td>
                                <td><span class="source-file">Listing 12 - Chemistry All Randomised Set.csv</span></td>
                                <td><span class="source-cols">result__creatinine, serum</span></td>
                                <td><span class="unit-badge">µmol/L</span></td>
                                <td><div class="code-block">df['creatinine'] = pd.to_numeric(df['result__creatinine, serum'], errors='coerce')</div><div class="transform-desc">Extract serum creatinine from pivot-formatted chemistry data</div></td>
                                <td class="notes-cell">Units are µmol/L (not mg/dL); kidney function marker</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">creatinine_clearance</span></td>
                                <td><span class="source-file">Listing 12 - Chemistry All Randomised Set.csv</span></td>
                                <td><span class="source-cols">result__creatinine clearance</span></td>
                                <td><span class="unit-badge">mL/min</span></td>
                                <td><div class="code-block">df['creatinine_clearance'] = pd.to_numeric(df['result__creatinine clearance'], errors='coerce')</div><div class="transform-desc">Extract creatinine clearance from pivot-formatted chemistry data</div></td>
                                <td class="notes-cell">Estimated kidney function</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">total_cholesterol</span></td>
                                <td><span class="source-file">Listing 12 - Chemistry All Randomised Set.csv</span></td>
                                <td><span class="source-cols">result__cholesterol</span></td>
                                <td><span class="unit-badge">mmol/L</span></td>
                                <td><div class="code-block">df['total_cholesterol'] = pd.to_numeric(df['result__cholesterol'], errors='coerce')</div><div class="transform-desc">Extract total cholesterol from pivot-formatted chemistry data</div></td>
                                <td class="notes-cell">Units are mmol/L (not mg/dL)</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">hdl_cholesterol</span></td>
                                <td><span class="source-file">Listing 12 - Chemistry All Randomised Set.csv</span></td>
                                <td><span class="source-cols">result__HDL</span></td>
                                <td><span class="unit-badge">mmol/L</span></td>
                                <td><div class="code-block">df['hdl_cholesterol'] = pd.to_numeric(df['result__HDL'], errors='coerce')</div><div class="transform-desc">Extract HDL cholesterol from pivot-formatted chemistry data</div></td>
                                <td class="notes-cell">High-density lipoprotein; units are mmol/L</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">ldl_cholesterol</span></td>
                                <td><span class="source-file">Listing 12 - Chemistry All Randomised Set.csv</span></td>
                                <td><span class="source-cols">result__LDL</span></td>
                                <td><span class="unit-badge">mmol/L</span></td>
                                <td><div class="code-block">df['ldl_cholesterol'] = pd.to_numeric(df['result__LDL'], errors='coerce')</div><div class="transform-desc">Extract LDL cholesterol from pivot-formatted chemistry data</div></td>
                                <td class="notes-cell">Low-density lipoprotein; units are mmol/L</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">fasting_glucose</span></td>
                                <td><span class="source-file">Listing 12 - Chemistry All Randomised Set.csv</span></td>
                                <td><span class="source-cols">result__fasting glucose</span></td>
                                <td><span class="unit-badge">mmol/L</span></td>
                                <td><div class="code-block">df['fasting_glucose'] = pd.to_numeric(df['result__fasting glucose'], errors='coerce')</div><div class="transform-desc">Extract fasting glucose from pivot-formatted chemistry data</div></td>
                                <td class="notes-cell">Units are mmol/L (not mg/dL)</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">cholesterol_hdl_ratio</span></td>
                                <td><span class="source-file">Listing 12 - Chemistry All Randomised Set.csv</span></td>
                                <td><span class="source-cols">result__cholestero/HDL ratio</span></td>
                                <td><span class="unit-badge">ratio</span></td>
                                <td><div class="code-block">df['cholesterol_hdl_ratio'] = pd.to_numeric(df['result__cholestero/HDL ratio'], errors='coerce')</div><div class="transform-desc">Extract cholesterol/HDL ratio from pivot-formatted chemistry data</div></td>
                                <td class="notes-cell">Cardiovascular risk ratio; note source has typo 'cholestero'</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">systolic_bp</span></td>
                                <td><span class="source-file">Listing 14 - Vitals Signs All Randomised Set.csv</span></td>
                                <td><span class="source-cols">systolic_BP</span></td>
                                <td><span class="unit-badge">mmHg</span></td>
                                <td><div class="code-block">df['systolic_bp'] = pd.to_numeric(df['systolic_BP'], errors='coerce')</div><div class="transform-desc">Extract systolic blood pressure</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">diastolic_bp</span></td>
                                <td><span class="source-file">Listing 14 - Vitals Signs All Randomised Set.csv</span></td>
                                <td><span class="source-cols">diastolic_BP</span></td>
                                <td><span class="unit-badge">mmHg</span></td>
                                <td><div class="code-block">df['diastolic_bp'] = pd.to_numeric(df['diastolic_BP'], errors='coerce')</div><div class="transform-desc">Extract diastolic blood pressure</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">heart_rate</span></td>
                                <td><span class="source-file">Listing 14 - Vitals Signs All Randomised Set.csv</span></td>
                                <td><span class="source-cols">heart_rate</span></td>
                                <td><span class="unit-badge">bpm</span></td>
                                <td><div class="code-block">df['heart_rate'] = pd.to_numeric(df['heart_rate'], errors='coerce')</div><div class="transform-desc">Extract heart rate</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">respiratory_rate</span></td>
                                <td><span class="source-file">Listing 14 - Vitals Signs All Randomised Set.csv</span></td>
                                <td><span class="source-cols">respiratory_rate</span></td>
                                <td><span class="unit-badge">breaths/min</span></td>
                                <td><div class="code-block">df['respiratory_rate'] = pd.to_numeric(df['respiratory_rate'], errors='coerce')</div><div class="transform-desc">Extract respiratory rate</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">temperature_c</span></td>
                                <td><span class="source-file">Listing 14 - Vitals Signs All Randomised Set.csv</span></td>
                                <td><span class="source-cols">oral_temperature</span></td>
                                <td><span class="unit-badge">°C</span></td>
                                <td><div class="code-block">df['temperature_c'] = pd.to_numeric(df['oral_temperature'], errors='coerce')
df.loc[df['temperature_c'] &gt; 45, 'temperature_c'] = np.nan
df.loc[df['temperature_c'] &lt; 30, 'temperature_c'] = np.nan</div><div class="transform-desc">Extract oral temperature; remove outliers (>45°C or <30°C set to NaN)</div></td>
                                <td class="notes-cell">Outlier removal: physiologically impossible values (>45°C or <30°C) set to NaN</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">hiv_status</span></td>
                                <td><span class="source-file">STUDY_DESIGN</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['hiv_status'] = 'Positive'</div><div class="transform-desc">All participants HIV-positive by study design</div></td>
                                <td class="notes-cell">Study inclusion criterion</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">hiv_positive</span></td>
                                <td><span class="source-file">STUDY_DESIGN</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td><span class="unit-badge">boolean (0/1)</span></td>
                                <td><div class="code-block">df['hiv_positive'] = 1</div><div class="transform-desc">All participants HIV-positive by study design</div></td>
                                <td class="notes-cell">1 = HIV-positive</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">on_art</span></td>
                                <td><span class="source-file">STUDY_DESIGN</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td><span class="unit-badge">boolean (0/1)</span></td>
                                <td><div class="code-block">df['on_art'] = 1</div><div class="transform-desc">All participants on ART by study design</div></td>
                                <td class="notes-cell">This is an ART trial</td>
                            </tr>

                        </tbody>
                    </table>
                </div>

            </div>
        </div>

        <div class="study-section" id="JHB_ACTG_015">
            <div class="study-header">
                <h2>JHB_ACTG_015</h2>
                <div class="study-name">ACTG 5208 - Nevirapine HIV Trial</div>
            </div>
            <div class="study-content">

                <div class="info-section">
                    <h3>Study Information</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">Study Type</div>
                            <div class="info-value">Randomized Controlled Trial</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Data Format</div>
                            <div class="info-value">ACTG Standard (coded column names requiring metadata lookup)</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Site</div>
                            <div class="info-value">Johannesburg, South Africa</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Population</div>
                            <div class="info-value">HIV-positive African women</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Total Records</div>
                            <div class="info-value">2,364</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Unique Patients</div>
                            <div class="info-value">153</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Source Path</div>
                            <div class="info-value" style="font-size: 0.75rem; word-break: break-all;">/home/cparker/incoming/RP2/JHB_ACTG_015/csv</div>
                        </div>
                    </div>
                </div>

                <div class="info-section">
                    <h3>Harmonization Methodology</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">Version</div>
                            <div class="info-value">2.0_ENHANCED</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Script</div>
                            <div class="info-value" style="font-family: monospace; font-size: 0.85rem;">JHB_ACTG_015_ENHANCED_HARMONIZER.py</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Date</div>
                            <div class="info-value">2025-12-02</div>
                        </div>
                    </div>
                </div>

                <div class="info-section">
                    <h3>Critical Study Context Notes</h3>
                    <ul class="notes-list">
                        <li>All participants are HIV-positive African women</li>
                        <li>ACTG data uses coded column names (e.g., tf515, cp110) requiring metadata lookup</li>
                        <li>ACTG missing codes: -1 = Missing, -2 = Not applicable, -4 = Other missing</li>
                        <li>Dates stored as separate year/month/day components, NOT Modified Julian Date</li>
                        <li>Column name format: {code}__{source_file} (e.g., copies__L_RNAFIN)</li>

                    </ul>
                </div>

                <div class="info-section">
                    <h3>Source Files</h3>
                    <table class="source-files-table">
                        <thead>
                            <tr>
                                <th>File Name</th>
                                <th>Description</th>
                                <th>Records</th>
                                <th>Key Columns</th>
                            </tr>
                        </thead>
                        <tbody>

                            <tr>
                                <td style="font-family: monospace; font-size: 0.85rem;">L_RNAFIN.csv</td>
                                <td>HIV-1 RNA viral load measurements</td>
                                <td>~2,300</td>
                                <td style="font-family: monospace; font-size: 0.8rem;">patid__L_RNAFIN, copies__L_RNAFIN, drawdy__L_RNAFIN, drawdm__L_RNAFIN, drawdd__L_RNAFIN</td>
                            </tr>

                            <tr>
                                <td style="font-family: monospace; font-size: 0.85rem;">LBW0054.csv</td>
                                <td>CD4 counts and immunology panel</td>
                                <td>~1,250</td>
                                <td style="font-family: monospace; font-size: 0.8rem;">patid__LBW0054, tf515__LBW0054 (CD4 count), tf513__LBW0054 (CD4 percent)</td>
                            </tr>

                            <tr>
                                <td style="font-family: monospace; font-size: 0.85rem;">LBW0057A.csv</td>
                                <td>Complete Blood Count / Hematology panel</td>
                                <td>~340</td>
                                <td style="font-family: monospace; font-size: 0.8rem;">patid__LBW0057A, cp110__LBW0057A (hemoglobin), cp114__LBW0057A (hematocrit), cp158__LBW0057A (platelets)</td>
                            </tr>

                            <tr>
                                <td style="font-family: monospace; font-size: 0.85rem;">LBW0057B.csv</td>
                                <td>Chemistry panel</td>
                                <td>~340</td>
                                <td style="font-family: monospace; font-size: 0.8rem;">patid__LBW0057B, cp253__LBW0057B (AST), cp258__LBW0057B (ALT), cp216__LBW0057B (creatinine)</td>
                            </tr>

                        </tbody>
                    </table>
                </div>

                <div class="info-section">
                    <h3>Complete Variable Lineage & Transformation Details</h3>
                    <table class="lineage-table">
                        <thead>
                            <tr>
                                <th style="width: 12%;">Variable</th>
                                <th style="width: 15%;">Source File</th>
                                <th style="width: 15%;">Source Column(s)</th>
                                <th style="width: 8%;">Units</th>
                                <th style="width: 25%;">Transformation Code</th>
                                <th style="width: 25%;">Notes</th>
                            </tr>
                        </thead>
                        <tbody>

                            <tr>
                                <td><span class="var-name">patient_id</span></td>
                                <td><span class="source-file">L_RNAFIN.csv</span></td>
                                <td><span class="source-cols">patid__L_RNAFIN</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['patient_id'] = df['patid__L_RNAFIN']</div><div class="transform-desc">Direct mapping of ACTG patient ID</div></td>
                                <td class="notes-cell">ACTG column naming: {variable}__{source_file}</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">visit_date</span></td>
                                <td><span class="source-file">L_RNAFIN.csv</span></td>
                                <td><span class="source-cols">drawdy__L_RNAFIN, drawdm__L_RNAFIN, drawdd__L_RNAFIN</span></td>
                                <td>-</td>
                                <td><div class="formula-box"><strong>Formula:</strong> date(year=drawdy, month=drawdm, day=drawdd)</div><div class="code-block"># Construct date from separate year/month/day columns
df['visit_date'] = pd.to_datetime(
    df['drawdy__L_RNAFIN'].astype(str) + '-' +
    df['drawdm__L_RNAFIN'].astype(str).str.zfill(2) + '-' +
    df['drawdd__L_RNAFIN'].astype(str).str.zfill(2),
    format='%Y-%m-%d',
    errors='coerce'
)</div><div class="transform-desc">Construct date from 3 separate columns: drawdy (year), drawdm (month), drawdd (day)</div></td>
                                <td class="notes-cell">ACTG stores dates as separate components, NOT as Modified Julian Date. Earlier attempts using MJD produced incorrect dates (year 8548).</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">viral_load</span></td>
                                <td><span class="source-file">L_RNAFIN.csv</span></td>
                                <td><span class="source-cols">copies__L_RNAFIN</span></td>
                                <td><span class="unit-badge">copies/mL</span></td>
                                <td><div class="code-block">df['viral_load'] = pd.to_numeric(df['copies__L_RNAFIN'], errors='coerce')
# Handle ACTG missing codes
df.loc[df['viral_load'].isin([-1, -2, -4]), 'viral_load'] = np.nan</div><div class="transform-desc">Extract viral load; convert ACTG missing codes (-1, -2, -4) to NaN</div></td>
                                <td class="notes-cell">ACTG uses negative values for missing data: -1=Missing, -2=Not applicable, -4=Other missing</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">cd4_count</span></td>
                                <td><span class="source-file">LBW0054.csv</span></td>
                                <td><span class="source-cols">tf515__LBW0054</span></td>
                                <td><span class="unit-badge">cells/µL</span></td>
                                <td><div class="code-block">df['cd4_count'] = pd.to_numeric(df['tf515__LBW0054'], errors='coerce')
# Handle ACTG missing codes
df.loc[df['cd4_count'].isin([-1, -2, -4]), 'cd4_count'] = np.nan</div><div class="transform-desc">Extract CD4 absolute count; convert ACTG missing codes to NaN</div></td>
                                <td class="notes-cell">tf515 = CD3+4+ absolute count per ACTG codebook</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">cd4_percent</span></td>
                                <td><span class="source-file">LBW0054.csv</span></td>
                                <td><span class="source-cols">tf513__LBW0054</span></td>
                                <td><span class="unit-badge">%</span></td>
                                <td><div class="code-block">df['cd4_percent'] = pd.to_numeric(df['tf513__LBW0054'], errors='coerce')
df.loc[df['cd4_percent'].isin([-1, -2, -4]), 'cd4_percent'] = np.nan</div><div class="transform-desc">Extract CD4 percent; convert ACTG missing codes to NaN</div></td>
                                <td class="notes-cell">tf513 = CD3+4+ percent per ACTG codebook</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">hemoglobin</span></td>
                                <td><span class="source-file">LBW0057A.csv</span></td>
                                <td><span class="source-cols">cp110__LBW0057A</span></td>
                                <td><span class="unit-badge">g/dL</span></td>
                                <td><div class="code-block">df['hemoglobin'] = pd.to_numeric(df['cp110__LBW0057A'], errors='coerce')
df.loc[df['hemoglobin'].isin([-1, -2, -4]), 'hemoglobin'] = np.nan</div><div class="transform-desc">Extract hemoglobin; convert ACTG missing codes to NaN</div></td>
                                <td class="notes-cell">cp110 = hemoglobin per ACTG codebook</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">hematocrit</span></td>
                                <td><span class="source-file">LBW0057A.csv</span></td>
                                <td><span class="source-cols">cp114__LBW0057A</span></td>
                                <td><span class="unit-badge">%</span></td>
                                <td><div class="code-block">df['hematocrit'] = pd.to_numeric(df['cp114__LBW0057A'], errors='coerce')
df.loc[df['hematocrit'].isin([-1, -2, -4]), 'hematocrit'] = np.nan</div><div class="transform-desc">Extract hematocrit; convert ACTG missing codes to NaN</div></td>
                                <td class="notes-cell">cp114 = hematocrit per ACTG codebook</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">platelets</span></td>
                                <td><span class="source-file">LBW0057A.csv</span></td>
                                <td><span class="source-cols">cp158__LBW0057A</span></td>
                                <td><span class="unit-badge">10^9/L</span></td>
                                <td><div class="code-block">df['platelets'] = pd.to_numeric(df['cp158__LBW0057A'], errors='coerce')
df.loc[df['platelets'].isin([-1, -2, -4]), 'platelets'] = np.nan</div><div class="transform-desc">Extract platelet count; convert ACTG missing codes to NaN</div></td>
                                <td class="notes-cell">cp158 = platelets per ACTG codebook</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">ast</span></td>
                                <td><span class="source-file">LBW0057B.csv</span></td>
                                <td><span class="source-cols">cp253__LBW0057B</span></td>
                                <td><span class="unit-badge">U/L</span></td>
                                <td><div class="code-block">df['ast'] = pd.to_numeric(df['cp253__LBW0057B'], errors='coerce')
df.loc[df['ast'].isin([-1, -2, -4]), 'ast'] = np.nan</div><div class="transform-desc">Extract AST; convert ACTG missing codes to NaN</div></td>
                                <td class="notes-cell">cp253 = AST per ACTG codebook</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">alt</span></td>
                                <td><span class="source-file">LBW0057B.csv</span></td>
                                <td><span class="source-cols">cp258__LBW0057B</span></td>
                                <td><span class="unit-badge">U/L</span></td>
                                <td><div class="code-block">df['alt'] = pd.to_numeric(df['cp258__LBW0057B'], errors='coerce')
df.loc[df['alt'].isin([-1, -2, -4]), 'alt'] = np.nan</div><div class="transform-desc">Extract ALT; convert ACTG missing codes to NaN</div></td>
                                <td class="notes-cell">cp258 = ALT per ACTG codebook</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">creatinine</span></td>
                                <td><span class="source-file">LBW0057B.csv</span></td>
                                <td><span class="source-cols">cp216__LBW0057B</span></td>
                                <td><span class="unit-badge">mg/dL</span></td>
                                <td><div class="code-block">df['creatinine'] = pd.to_numeric(df['cp216__LBW0057B'], errors='coerce')
df.loc[df['creatinine'].isin([-1, -2, -4]), 'creatinine'] = np.nan</div><div class="transform-desc">Extract creatinine; convert ACTG missing codes to NaN</div></td>
                                <td class="notes-cell">cp216 = creatinine per ACTG codebook</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">sodium</span></td>
                                <td><span class="source-file">LBW0057B.csv</span></td>
                                <td><span class="source-cols">cp194__LBW0057B</span></td>
                                <td><span class="unit-badge">mEq/L</span></td>
                                <td><div class="code-block">df['sodium'] = pd.to_numeric(df['cp194__LBW0057B'], errors='coerce')
df.loc[df['sodium'].isin([-1, -2, -4]), 'sodium'] = np.nan</div><div class="transform-desc">Extract sodium; convert ACTG missing codes to NaN</div></td>
                                <td class="notes-cell">cp194 = sodium per ACTG codebook</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">albumin</span></td>
                                <td><span class="source-file">LBW0057B.csv</span></td>
                                <td><span class="source-cols">cp225__LBW0057B</span></td>
                                <td><span class="unit-badge">g/dL</span></td>
                                <td><div class="code-block">df['albumin'] = pd.to_numeric(df['cp225__LBW0057B'], errors='coerce')
df.loc[df['albumin'].isin([-1, -2, -4]), 'albumin'] = np.nan</div><div class="transform-desc">Extract albumin; convert ACTG missing codes to NaN</div></td>
                                <td class="notes-cell">cp225 = albumin per ACTG codebook</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">total_bilirubin</span></td>
                                <td><span class="source-file">LBW0057B.csv</span></td>
                                <td><span class="source-cols">cp268__LBW0057B</span></td>
                                <td><span class="unit-badge">mg/dL</span></td>
                                <td><div class="code-block">df['total_bilirubin'] = pd.to_numeric(df['cp268__LBW0057B'], errors='coerce')
df.loc[df['total_bilirubin'].isin([-1, -2, -4]), 'total_bilirubin'] = np.nan</div><div class="transform-desc">Extract total bilirubin; convert ACTG missing codes to NaN</div></td>
                                <td class="notes-cell">cp268 = total bilirubin per ACTG codebook</td>
                            </tr>

                        </tbody>
                    </table>
                </div>

            </div>
        </div>

        <div class="study-section" id="JHB_ACTG_016">
            <div class="study-header">
                <h2>JHB_ACTG_016</h2>
                <div class="study-name">ACTG 5221 - HIV-TB Co-infection Trial</div>
            </div>
            <div class="study-content">

                <div class="info-section">
                    <h3>Study Information</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">Study Type</div>
                            <div class="info-value">Randomized Controlled Trial</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Data Format</div>
                            <div class="info-value">ACTG Standard (coded column names requiring ACTG Codebook lookup)</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Site</div>
                            <div class="info-value">Johannesburg, South Africa</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Population</div>
                            <div class="info-value">HIV-TB co-infected adults</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Total Records</div>
                            <div class="info-value">766</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Unique Patients</div>
                            <div class="info-value">108</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Source Path</div>
                            <div class="info-value" style="font-size: 0.75rem; word-break: break-all;">/home/cparker/incoming/RP2/JHB_ACTG_016/csv</div>
                        </div>
                    </div>
                </div>

                <div class="info-section">
                    <h3>Harmonization Methodology</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">Version</div>
                            <div class="info-value">2.0_ENHANCED</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Script</div>
                            <div class="info-value" style="font-family: monospace; font-size: 0.85rem;">JHB_ACTG_016_ENHANCED_HARMONIZER.py</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Date</div>
                            <div class="info-value">2025-12-02</div>
                        </div>
                    </div>
                </div>

                <div class="info-section">
                    <h3>Critical Study Context Notes</h3>
                    <ul class="notes-list">
                        <li>HIV-TB co-infection trial (ACTG A5221)</li>
                        <li>ACTG coded column format: columns named cp110, tf515, etc. require ACTG Codebook for interpretation</li>
                        <li>ACTG missing codes: -1 (not done), -2 (not applicable), -4 (not available) → converted to NaN</li>
                        <li>Demographics (age, sex, race) not included in ACTG export files</li>
                        <li>All participants HIV-positive by study design</li>

                    </ul>
                </div>

                <div class="info-section">
                    <h3>Source Files</h3>
                    <table class="source-files-table">
                        <thead>
                            <tr>
                                <th>File Name</th>
                                <th>Description</th>
                                <th>Records</th>
                                <th>Key Columns</th>
                            </tr>
                        </thead>
                        <tbody>

                            <tr>
                                <td style="font-family: monospace; font-size: 0.85rem;">JHB_ACTG_016_ADM0010.csv</td>
                                <td>Administrative visit records</td>
                                <td>varies</td>
                                <td style="font-family: monospace; font-size: 0.8rem;">patid__ADM0010, visitm__ADM0010, visitd__ADM0010, visity__ADM0010, week__ADM0010</td>
                            </tr>

                            <tr>
                                <td style="font-family: monospace; font-size: 0.85rem;">JHB_ACTG_016_LBW0057A.csv</td>
                                <td>CBC/Hematology panel (ACTG Form LBW0057A)</td>
                                <td>~76</td>
                                <td style="font-family: monospace; font-size: 0.8rem;">patid__LBW0057A, cp110__LBW0057A (hemoglobin), cp114__LBW0057A (hematocrit), cp128__LBW0057A (WBC)</td>
                            </tr>

                            <tr>
                                <td style="font-family: monospace; font-size: 0.85rem;">JHB_ACTG_016_LBW0054.csv</td>
                                <td>CD4/Immunology panel (ACTG Form LBW0054)</td>
                                <td>~510</td>
                                <td style="font-family: monospace; font-size: 0.8rem;">patid__LBW0054, tf509__LBW0054 (WBC), tf515__LBW0054 (CD4%)</td>
                            </tr>

                        </tbody>
                    </table>
                </div>

                <div class="info-section">
                    <h3>Complete Variable Lineage & Transformation Details</h3>
                    <table class="lineage-table">
                        <thead>
                            <tr>
                                <th style="width: 12%;">Variable</th>
                                <th style="width: 15%;">Source File</th>
                                <th style="width: 15%;">Source Column(s)</th>
                                <th style="width: 8%;">Units</th>
                                <th style="width: 25%;">Transformation Code</th>
                                <th style="width: 25%;">Notes</th>
                            </tr>
                        </thead>
                        <tbody>

                            <tr>
                                <td><span class="var-name">patient_id</span></td>
                                <td><span class="source-file">JHB_ACTG_016_LBW0057A.csv</span></td>
                                <td><span class="source-cols">patid__LBW0057A</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['patient_id'] = df['patid__LBW0057A']</div><div class="transform-desc">Direct mapping of ACTG patient ID</div></td>
                                <td class="notes-cell">7-digit ACTG participant identifier</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">visit_month</span></td>
                                <td><span class="source-file">JHB_ACTG_016_LBW0057A.csv</span></td>
                                <td><span class="source-cols">visitm__LBW0057A</span></td>
                                <td><span class="unit-badge">month (1-12)</span></td>
                                <td><div class="code-block">df['visit_month'] = pd.to_numeric(df['visitm__LBW0057A'], errors='coerce')</div><div class="transform-desc">Month component of visit date</div></td>
                                <td class="notes-cell">Part of ACTG date construction</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">visit_day</span></td>
                                <td><span class="source-file">JHB_ACTG_016_LBW0057A.csv</span></td>
                                <td><span class="source-cols">visitd__LBW0057A</span></td>
                                <td><span class="unit-badge">day (1-31)</span></td>
                                <td><div class="code-block">df['visit_day'] = pd.to_numeric(df['visitd__LBW0057A'], errors='coerce')</div><div class="transform-desc">Day component of visit date</div></td>
                                <td class="notes-cell">Part of ACTG date construction</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">visit_year</span></td>
                                <td><span class="source-file">JHB_ACTG_016_LBW0057A.csv</span></td>
                                <td><span class="source-cols">visity__LBW0057A</span></td>
                                <td><span class="unit-badge">year (YYYY)</span></td>
                                <td><div class="code-block">df['visit_year'] = pd.to_numeric(df['visity__LBW0057A'], errors='coerce')</div><div class="transform-desc">Year component of visit date</div></td>
                                <td class="notes-cell">Part of ACTG date construction</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">study_week</span></td>
                                <td><span class="source-file">JHB_ACTG_016_LBW0057A.csv</span></td>
                                <td><span class="source-cols">week__LBW0057A</span></td>
                                <td><span class="unit-badge">weeks from enrollment</span></td>
                                <td><div class="code-block">df['study_week'] = pd.to_numeric(df['week__LBW0057A'], errors='coerce')</div><div class="transform-desc">Protocol-defined study week</div></td>
                                <td class="notes-cell">Week 0 = enrollment/screening</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">visit_date</span></td>
                                <td><span class="source-file">DERIVED</span></td>
                                <td><span class="source-cols">visity__LBW0057A, visitm__LBW0057A, visitd__LBW0057A</span></td>
                                <td><span class="unit-badge">date</span></td>
                                <td><div class="formula-box"><strong>Formula:</strong> pd.to_datetime(year-month-day)</div><div class="code-block">df['visit_date'] = pd.to_datetime(
    df['visit_year'].astype(str) + '-' + 
    df['visit_month'].astype(str).str.zfill(2) + '-' + 
    df['visit_day'].astype(str).str.zfill(2), 
    errors='coerce'
)</div><div class="transform-desc">Construct full date from year/month/day components</div></td>
                                <td class="notes-cell">ACTG stores dates as separate components</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">HGB</span></td>
                                <td><span class="source-file">JHB_ACTG_016_LBW0057A.csv</span></td>
                                <td><span class="source-cols">cp110__LBW0057A</span></td>
                                <td><span class="unit-badge">g/dL</span></td>
                                <td><div class="code-block">df['HGB'] = pd.to_numeric(df['cp110__LBW0057A'], errors='coerce')
df.loc[df['HGB'] &lt; 0, 'HGB'] = np.nan  # ACTG missing codes</div><div class="transform-desc">Hemoglobin from ACTG hematology form</div></td>
                                <td class="notes-cell">cp110 = hemoglobin per ACTG Codebook; negative values are ACTG missing codes</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">HCT</span></td>
                                <td><span class="source-file">JHB_ACTG_016_LBW0057A.csv</span></td>
                                <td><span class="source-cols">cp114__LBW0057A</span></td>
                                <td><span class="unit-badge">%</span></td>
                                <td><div class="code-block">df['HCT'] = pd.to_numeric(df['cp114__LBW0057A'], errors='coerce')
df.loc[df['HCT'] &lt; 0, 'HCT'] = np.nan  # ACTG missing codes</div><div class="transform-desc">Hematocrit from ACTG hematology form</div></td>
                                <td class="notes-cell">cp114 = hematocrit per ACTG Codebook; negative values are ACTG missing codes</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">WBC</span></td>
                                <td><span class="source-file">JHB_ACTG_016_LBW0057A.csv</span></td>
                                <td><span class="source-cols">cp128__LBW0057A</span></td>
                                <td><span class="unit-badge">10^9/L</span></td>
                                <td><div class="code-block">df['WBC'] = pd.to_numeric(df['cp128__LBW0057A'], errors='coerce')
df.loc[df['WBC'] &lt; 0, 'WBC'] = np.nan  # ACTG missing codes</div><div class="transform-desc">White blood cell count from ACTG hematology form</div></td>
                                <td class="notes-cell">cp128 = WBC per ACTG Codebook; negative values are ACTG missing codes</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">study_id</span></td>
                                <td><span class="source-file">METADATA</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['study_id'] = 'JHB_ACTG_016'</div><div class="transform-desc">Study identifier constant</div></td>
                                <td class="notes-cell">Harmonization metadata</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">study_name</span></td>
                                <td><span class="source-file">METADATA</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['study_name'] = 'A5221'</div><div class="transform-desc">ACTG protocol number</div></td>
                                <td class="notes-cell">A5221 = ACTG 5221 HIV-TB co-infection trial</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">study_type</span></td>
                                <td><span class="source-file">METADATA</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['study_type'] = 'HIV_treatment_trial'</div><div class="transform-desc">Study design type</div></td>
                                <td class="notes-cell">Harmonization metadata</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">site</span></td>
                                <td><span class="source-file">METADATA</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['site'] = 'Johannesburg'</div><div class="transform-desc">Study site location</div></td>
                                <td class="notes-cell">ACTG site in Johannesburg, South Africa</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">country</span></td>
                                <td><span class="source-file">METADATA</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['country'] = 'South Africa'</div><div class="transform-desc">Country constant</div></td>
                                <td class="notes-cell">Harmonization metadata</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">latitude</span></td>
                                <td><span class="source-file">GEOCODED</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td><span class="unit-badge">degrees</span></td>
                                <td><div class="code-block">df['latitude'] = -26.2041  # Johannesburg ACTG site</div><div class="transform-desc">Fixed coordinates for ACTG Johannesburg site</div></td>
                                <td class="notes-cell">Clinical Trials Unit, Johannesburg</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">longitude</span></td>
                                <td><span class="source-file">GEOCODED</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td><span class="unit-badge">degrees</span></td>
                                <td><div class="code-block">df['longitude'] = 28.0473  # Johannesburg ACTG site</div><div class="transform-desc">Fixed coordinates for ACTG Johannesburg site</div></td>
                                <td class="notes-cell">All participants enrolled at single site</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">demographics_note</span></td>
                                <td><span class="source-file">METADATA</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['demographics_note'] = 'Age/race/sex not available in ACTG export files'</div><div class="transform-desc">Note about missing demographics</div></td>
                                <td class="notes-cell">ACTG data sharing agreement excludes detailed demographics</td>
                            </tr>

                        </tbody>
                    </table>
                </div>

            </div>
        </div>

        <div class="study-section" id="JHB_ACTG_019">
            <div class="study-header">
                <h2>JHB_ACTG_019</h2>
                <div class="study-name">ACTG 5175 - Global ART Comparison Trial</div>
            </div>
            <div class="study-content">

                <div class="info-section">
                    <h3>Study Information</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">Study Type</div>
                            <div class="info-value">Randomized Controlled Trial</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Data Format</div>
                            <div class="info-value">ACTG Standard (coded column names requiring ACTG Codebook lookup)</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Site</div>
                            <div class="info-value">Johannesburg, South Africa</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Population</div>
                            <div class="info-value">HIV-positive adults in resource-limited settings</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Total Records</div>
                            <div class="info-value">2,594</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Unique Patients</div>
                            <div class="info-value">100</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Source Path</div>
                            <div class="info-value" style="font-size: 0.75rem; word-break: break-all;">/home/cparker/incoming/RP2/JHB_ACTG_019/csv</div>
                        </div>
                    </div>
                </div>

                <div class="info-section">
                    <h3>Harmonization Methodology</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">Version</div>
                            <div class="info-value">2.0_ENHANCED</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Script</div>
                            <div class="info-value" style="font-family: monospace; font-size: 0.85rem;">JHB_ACTG_019_ENHANCED_HARMONIZER.py</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Date</div>
                            <div class="info-value">2025-12-02</div>
                        </div>
                    </div>
                </div>

                <div class="info-section">
                    <h3>Critical Study Context Notes</h3>
                    <ul class="notes-list">
                        <li>Global comparison of antiretroviral regimens (ACTG A5175)</li>
                        <li>ACTG coded column format: columns named cp110, tf515, etc. require ACTG Codebook for interpretation</li>
                        <li>ACTG missing codes: -1 (not done), -2 (not applicable), -4 (not available) → converted to NaN</li>
                        <li>Demographics (age, sex, race) not included in ACTG export files</li>
                        <li>All participants HIV-positive by study design</li>
                        <li>Rich longitudinal viral load and CD4 data</li>

                    </ul>
                </div>

                <div class="info-section">
                    <h3>Source Files</h3>
                    <table class="source-files-table">
                        <thead>
                            <tr>
                                <th>File Name</th>
                                <th>Description</th>
                                <th>Records</th>
                                <th>Key Columns</th>
                            </tr>
                        </thead>
                        <tbody>

                            <tr>
                                <td style="font-family: monospace; font-size: 0.85rem;">JHB_ACTG_019_ADM0010.csv</td>
                                <td>Administrative visit records</td>
                                <td>varies</td>
                                <td style="font-family: monospace; font-size: 0.8rem;">patid__ADM0010, visitm__ADM0010, visitd__ADM0010, visity__ADM0010, week__ADM0010</td>
                            </tr>

                            <tr>
                                <td style="font-family: monospace; font-size: 0.85rem;">JHB_ACTG_019_LBW0057A.csv</td>
                                <td>CBC/Hematology panel (ACTG Form LBW0057A)</td>
                                <td>~167</td>
                                <td style="font-family: monospace; font-size: 0.8rem;">patid__LBW0057A, cp110__LBW0057A (hemoglobin), cp114__LBW0057A (hematocrit), cp128__LBW0057A (WBC)</td>
                            </tr>

                            <tr>
                                <td style="font-family: monospace; font-size: 0.85rem;">JHB_ACTG_019_LBW0054.csv</td>
                                <td>CD4/Immunology panel (ACTG Form LBW0054)</td>
                                <td>~2,564</td>
                                <td style="font-family: monospace; font-size: 0.8rem;">patid__LBW0054, tf509__LBW0054 (WBC), tf515__LBW0054 (CD4%)</td>
                            </tr>

                            <tr>
                                <td style="font-family: monospace; font-size: 0.85rem;">JHB_ACTG_019_L_RNAFIN.csv</td>
                                <td>HIV-1 RNA viral load (final dataset)</td>
                                <td>~2,584</td>
                                <td style="font-family: monospace; font-size: 0.8rem;">patid__L_RNAFIN, copies__L_RNAFIN</td>
                            </tr>

                        </tbody>
                    </table>
                </div>

                <div class="info-section">
                    <h3>Complete Variable Lineage & Transformation Details</h3>
                    <table class="lineage-table">
                        <thead>
                            <tr>
                                <th style="width: 12%;">Variable</th>
                                <th style="width: 15%;">Source File</th>
                                <th style="width: 15%;">Source Column(s)</th>
                                <th style="width: 8%;">Units</th>
                                <th style="width: 25%;">Transformation Code</th>
                                <th style="width: 25%;">Notes</th>
                            </tr>
                        </thead>
                        <tbody>

                            <tr>
                                <td><span class="var-name">patient_id</span></td>
                                <td><span class="source-file">JHB_ACTG_019_LBW0057A.csv</span></td>
                                <td><span class="source-cols">patid__LBW0057A</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['patient_id'] = df['patid__LBW0057A']</div><div class="transform-desc">Direct mapping of ACTG patient ID</div></td>
                                <td class="notes-cell">7-digit ACTG participant identifier</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">visit_month</span></td>
                                <td><span class="source-file">JHB_ACTG_019_LBW0057A.csv</span></td>
                                <td><span class="source-cols">visitm__LBW0057A</span></td>
                                <td><span class="unit-badge">month (1-12)</span></td>
                                <td><div class="code-block">df['visit_month'] = pd.to_numeric(df['visitm__LBW0057A'], errors='coerce')</div><div class="transform-desc">Month component of visit date</div></td>
                                <td class="notes-cell">Part of ACTG date construction</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">visit_day</span></td>
                                <td><span class="source-file">JHB_ACTG_019_LBW0057A.csv</span></td>
                                <td><span class="source-cols">visitd__LBW0057A</span></td>
                                <td><span class="unit-badge">day (1-31)</span></td>
                                <td><div class="code-block">df['visit_day'] = pd.to_numeric(df['visitd__LBW0057A'], errors='coerce')</div><div class="transform-desc">Day component of visit date</div></td>
                                <td class="notes-cell">Part of ACTG date construction</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">visit_year</span></td>
                                <td><span class="source-file">JHB_ACTG_019_LBW0057A.csv</span></td>
                                <td><span class="source-cols">visity__LBW0057A</span></td>
                                <td><span class="unit-badge">year (YYYY)</span></td>
                                <td><div class="code-block">df['visit_year'] = pd.to_numeric(df['visity__LBW0057A'], errors='coerce')</div><div class="transform-desc">Year component of visit date</div></td>
                                <td class="notes-cell">Part of ACTG date construction</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">study_week</span></td>
                                <td><span class="source-file">JHB_ACTG_019_LBW0057A.csv</span></td>
                                <td><span class="source-cols">week__LBW0057A</span></td>
                                <td><span class="unit-badge">weeks from enrollment</span></td>
                                <td><div class="code-block">df['study_week'] = pd.to_numeric(df['week__LBW0057A'], errors='coerce')</div><div class="transform-desc">Protocol-defined study week</div></td>
                                <td class="notes-cell">Week 0 = enrollment/screening</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">visit_date</span></td>
                                <td><span class="source-file">DERIVED</span></td>
                                <td><span class="source-cols">visity__LBW0057A, visitm__LBW0057A, visitd__LBW0057A</span></td>
                                <td><span class="unit-badge">date</span></td>
                                <td><div class="formula-box"><strong>Formula:</strong> pd.to_datetime(year-month-day)</div><div class="code-block">df['visit_date'] = pd.to_datetime(
    df['visit_year'].astype(str) + '-' + 
    df['visit_month'].astype(str).str.zfill(2) + '-' + 
    df['visit_day'].astype(str).str.zfill(2), 
    errors='coerce'
)</div><div class="transform-desc">Construct full date from year/month/day components</div></td>
                                <td class="notes-cell">ACTG stores dates as separate components</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">HGB</span></td>
                                <td><span class="source-file">JHB_ACTG_019_LBW0057A.csv</span></td>
                                <td><span class="source-cols">cp110__LBW0057A</span></td>
                                <td><span class="unit-badge">g/dL</span></td>
                                <td><div class="code-block">df['HGB'] = pd.to_numeric(df['cp110__LBW0057A'], errors='coerce')
df.loc[df['HGB'] &lt; 0, 'HGB'] = np.nan  # ACTG missing codes</div><div class="transform-desc">Hemoglobin from ACTG hematology form</div></td>
                                <td class="notes-cell">cp110 = hemoglobin per ACTG Codebook; negative values are ACTG missing codes</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">HCT</span></td>
                                <td><span class="source-file">JHB_ACTG_019_LBW0057A.csv</span></td>
                                <td><span class="source-cols">cp114__LBW0057A</span></td>
                                <td><span class="unit-badge">%</span></td>
                                <td><div class="code-block">df['HCT'] = pd.to_numeric(df['cp114__LBW0057A'], errors='coerce')
df.loc[df['HCT'] &lt; 0, 'HCT'] = np.nan  # ACTG missing codes</div><div class="transform-desc">Hematocrit from ACTG hematology form</div></td>
                                <td class="notes-cell">cp114 = hematocrit per ACTG Codebook; negative values are ACTG missing codes</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">WBC</span></td>
                                <td><span class="source-file">JHB_ACTG_019_LBW0057A.csv</span></td>
                                <td><span class="source-cols">cp128__LBW0057A</span></td>
                                <td><span class="unit-badge">10^9/L</span></td>
                                <td><div class="code-block">df['WBC'] = pd.to_numeric(df['cp128__LBW0057A'], errors='coerce')
df.loc[df['WBC'] &lt; 0, 'WBC'] = np.nan  # ACTG missing codes</div><div class="transform-desc">White blood cell count from ACTG hematology form</div></td>
                                <td class="notes-cell">cp128 = WBC per ACTG Codebook; negative values are ACTG missing codes</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">study_id</span></td>
                                <td><span class="source-file">METADATA</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['study_id'] = 'JHB_ACTG_019'</div><div class="transform-desc">Study identifier constant</div></td>
                                <td class="notes-cell">Harmonization metadata</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">study_name</span></td>
                                <td><span class="source-file">METADATA</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['study_name'] = 'A5175'</div><div class="transform-desc">ACTG protocol number</div></td>
                                <td class="notes-cell">A5175 = ACTG 5175 global ART comparison trial</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">study_type</span></td>
                                <td><span class="source-file">METADATA</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['study_type'] = 'HIV_treatment_trial'</div><div class="transform-desc">Study design type</div></td>
                                <td class="notes-cell">Harmonization metadata</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">site</span></td>
                                <td><span class="source-file">METADATA</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['site'] = 'Johannesburg'</div><div class="transform-desc">Study site location</div></td>
                                <td class="notes-cell">ACTG site in Johannesburg, South Africa</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">country</span></td>
                                <td><span class="source-file">METADATA</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['country'] = 'South Africa'</div><div class="transform-desc">Country constant</div></td>
                                <td class="notes-cell">Harmonization metadata</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">latitude</span></td>
                                <td><span class="source-file">GEOCODED</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td><span class="unit-badge">degrees</span></td>
                                <td><div class="code-block">df['latitude'] = -26.2041  # Johannesburg ACTG site</div><div class="transform-desc">Fixed coordinates for ACTG Johannesburg site</div></td>
                                <td class="notes-cell">Clinical Trials Unit, Johannesburg</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">longitude</span></td>
                                <td><span class="source-file">GEOCODED</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td><span class="unit-badge">degrees</span></td>
                                <td><div class="code-block">df['longitude'] = 28.0473  # Johannesburg ACTG site</div><div class="transform-desc">Fixed coordinates for ACTG Johannesburg site</div></td>
                                <td class="notes-cell">All participants enrolled at single site</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">demographics_note</span></td>
                                <td><span class="source-file">METADATA</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['demographics_note'] = 'Age/race/sex not available in ACTG export files'</div><div class="transform-desc">Note about missing demographics</div></td>
                                <td class="notes-cell">ACTG data sharing agreement excludes detailed demographics</td>
                            </tr>

                        </tbody>
                    </table>
                </div>

            </div>
        </div>

        <div class="study-section" id="JHB_Aurum_009">
            <div class="study-header">
                <h2>JHB_Aurum_009</h2>
                <div class="study-name">Aurum 009 - HIV Linkage to Care Cohort</div>
            </div>
            <div class="study-content">

                <div class="info-section">
                    <h3>Study Information</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">Study Type</div>
                            <div class="info-value">Longitudinal Cohort Study</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Data Format</div>
                            <div class="info-value">Database Export (Multiple Domain Tables)</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Site</div>
                            <div class="info-value">Greater Johannesburg Area</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Population</div>
                            <div class="info-value">HIV-positive adults newly diagnosed</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Total Records</div>
                            <div class="info-value">12,575</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Unique Patients</div>
                            <div class="info-value">2,550</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Source Path</div>
                            <div class="info-value" style="font-size: 0.75rem; word-break: break-all;">/home/cparker/incoming/RP2/JHB_Aurum_009/csv</div>
                        </div>
                    </div>
                </div>

                <div class="info-section">
                    <h3>Harmonization Methodology</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">Version</div>
                            <div class="info-value">2.0_LONGITUDINAL</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Script</div>
                            <div class="info-value" style="font-family: monospace; font-size: 0.85rem;">JHB_Aurum_009_LONGITUDINAL_HARMONIZER.py</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Date</div>
                            <div class="info-value">2025-12-02</div>
                        </div>
                    </div>
                </div>

                <div class="info-section">
                    <h3>Critical Study Context Notes</h3>
                    <ul class="notes-list">
                        <li>All participants are HIV-positive adults newly diagnosed</li>
                        <li>Randomized to linkage facilitation interventions</li>
                        <li>Database export format with multiple domain tables (AD001, EL001, LT001, FV001, SS005)</li>
                        <li>CD4 merged from LT001 (primary) and SS005 (secondary)</li>
                        <li>Viral load from chart abstraction (FV001) - may be string values like 'LDL', '<50'</li>

                    </ul>
                </div>

                <div class="info-section">
                    <h3>Source Files</h3>
                    <table class="source-files-table">
                        <thead>
                            <tr>
                                <th>File Name</th>
                                <th>Description</th>
                                <th>Records</th>
                                <th>Key Columns</th>
                            </tr>
                        </thead>
                        <tbody>

                            <tr>
                                <td style="font-family: monospace; font-size: 0.85rem;">JHB_Aurum_009_EL001.csv</td>
                                <td>Enrollment/Screening demographics</td>
                                <td>~2,560</td>
                                <td style="font-family: monospace; font-size: 0.8rem;">studyid, screenid, denrol, scrndt, dbirth, sex, armrand</td>
                            </tr>

                            <tr>
                                <td style="font-family: monospace; font-size: 0.85rem;">JHB_Aurum_009_AD001.csv</td>
                                <td>Main visit records (longitudinal backbone)</td>
                                <td>12,575</td>
                                <td style="font-family: monospace; font-size: 0.8rem;">studyid, dtvisit, vcode, vtyp, vcon</td>
                            </tr>

                            <tr>
                                <td style="font-family: monospace; font-size: 0.85rem;">JHB_Aurum_009_LT001.csv</td>
                                <td>Laboratory tests (CD4)</td>
                                <td>~2,500</td>
                                <td style="font-family: monospace; font-size: 0.8rem;">studyid, dvisit, vcode, cd4res, bldcd4</td>
                            </tr>

                            <tr>
                                <td style="font-family: monospace; font-size: 0.85rem;">JHB_Aurum_009_FV001.csv</td>
                                <td>Follow-up abstraction (CD4, viral load from charts)</td>
                                <td>~2,500</td>
                                <td style="font-family: monospace; font-size: 0.8rem;">studyid, enrcd4res, vloadresult, lastvlres, dstartart</td>
                            </tr>

                            <tr>
                                <td style="font-family: monospace; font-size: 0.85rem;">JHB_Aurum_009_SS005.csv</td>
                                <td>Study status with additional CD4</td>
                                <td>~2,500</td>
                                <td style="font-family: monospace; font-size: 0.8rem;">studyid, dvisit, vcode, cd4result, cartstart</td>
                            </tr>

                        </tbody>
                    </table>
                </div>

                <div class="info-section">
                    <h3>Complete Variable Lineage & Transformation Details</h3>
                    <table class="lineage-table">
                        <thead>
                            <tr>
                                <th style="width: 12%;">Variable</th>
                                <th style="width: 15%;">Source File</th>
                                <th style="width: 15%;">Source Column(s)</th>
                                <th style="width: 8%;">Units</th>
                                <th style="width: 25%;">Transformation Code</th>
                                <th style="width: 25%;">Notes</th>
                            </tr>
                        </thead>
                        <tbody>

                            <tr>
                                <td><span class="var-name">patient_id</span></td>
                                <td><span class="source-file">EL001.csv</span></td>
                                <td><span class="source-cols">studyid</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['patient_id'] = df['studyid']</div><div class="transform-desc">Direct mapping of study ID</div></td>
                                <td class="notes-cell">Unique patient identifier across all domain tables</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">age_years</span></td>
                                <td><span class="source-file">EL001.csv</span></td>
                                <td><span class="source-cols">denrol, dbirth</span></td>
                                <td><span class="unit-badge">years</span></td>
                                <td><div class="formula-box"><strong>Formula:</strong> (enrollment_date - date_of_birth) / 365.25</div><div class="code-block">df['age_years'] = ((pd.to_datetime(df['denrol']) - pd.to_datetime(df['dbirth'])).dt.days / 365.25).round(0)</div><div class="transform-desc">Calculate age at enrollment from enrollment date minus date of birth</div></td>
                                <td class="notes-cell">Age calculated at enrollment, not at each visit</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">sex</span></td>
                                <td><span class="source-file">EL001.csv</span></td>
                                <td><span class="source-cols">sex</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['sex'] = df['sex'].map({1.0: 'Male', 2.0: 'Female'})</div><div class="transform-desc">Map numeric sex codes to text labels</div></td>
                                <td class="notes-cell">1=Male, 2=Female</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">treatment_arm</span></td>
                                <td><span class="source-file">EL001.csv</span></td>
                                <td><span class="source-cols">armrand</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['treatment_arm'] = df['armrand'].map({1.0: 'Linkage Facilitation', 2.0: 'Active Follow-up', 3.0: 'Standard of Care', 4.0: 'Active Follow-up + ART Facilitation'})</div><div class="transform-desc">Map randomization arm codes to descriptive names</div></td>
                                <td class="notes-cell">4-arm randomized trial</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">visit</span></td>
                                <td><span class="source-file">AD001.csv</span></td>
                                <td><span class="source-cols">vcode</span></td>
                                <td>-</td>
                                <td><div class="code-block">VISIT_CODE_MAP = {1.0: 'Screening', 2.0: 'Month 3', 3.0: 'Month 6', 4.0: 'Month 9', 5.0: 'Month 12', 6.0: 'Month 18', 12.0: 'Study Completion', 99.0: 'Off-Study'}
df['visit'] = df['vcode'].map(VISIT_CODE_MAP).fillna('Unknown')</div><div class="transform-desc">Map numeric visit codes to visit names</div></td>
                                <td class="notes-cell">VISIT_CODE_MAP: 1=Screening, 2=Month3, 3=Month6, 4=Month9, 5=Month12, 6=Month18, 12=Completion, 99=Off-Study</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">visit_date</span></td>
                                <td><span class="source-file">AD001.csv</span></td>
                                <td><span class="source-cols">dtvisit</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['visit_date'] = pd.to_datetime(df['dtvisit'], errors='coerce')</div><div class="transform-desc">Convert visit date to datetime</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">cd4_count</span></td>
                                <td><span class="source-file">LT001.csv + SS005.csv</span></td>
                                <td><span class="source-cols">cd4res (LT001), cd4result (SS005)</span></td>
                                <td><span class="unit-badge">cells/µL</span></td>
                                <td><div class="formula-box"><strong>Formula:</strong> cd4_count = cd4res WHERE NOT NULL ELSE cd4result</div><div class="code-block"># Merge CD4 from LT001 (primary)
df['cd4_count'] = pd.to_numeric(df['cd4res'], errors='coerce')
# Fill from SS005 where LT001 is missing
df['cd4_count'] = df['cd4_count'].fillna(df['cd4result'])</div><div class="transform-desc">CD4 from lab tests (LT001) as primary, filled from study status (SS005) where missing</div></td>
                                <td class="notes-cell">Two-source CD4: LT001 (lab) takes precedence over SS005 (chart abstraction)</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">viral_load</span></td>
                                <td><span class="source-file">FV001.csv</span></td>
                                <td><span class="source-cols">vloadresult</span></td>
                                <td><span class="unit-badge">copies/mL</span></td>
                                <td><div class="formula-box"><strong>Formula:</strong> parse_viral_load(value)</div><div class="code-block">def parse_viral_load(value):
    if pd.isna(value): return np.nan
    if isinstance(value, (int, float)): return float(value) if value &gt; 0 else np.nan
    cleaned = str(value).replace(',', '').strip()
    if cleaned.upper() in ['LDL', 'UNDETECTABLE', '&lt;40', '&lt;50']:
        return 39.0  # Below detection limit
    return float(cleaned)
df['viral_load'] = df['vloadresult'].apply(parse_viral_load)</div><div class="transform-desc">Parse viral load from string/numeric; 'LDL'/'UNDETECTABLE'/'<40'/'<50' → 39.0</div></td>
                                <td class="notes-cell">Chart abstraction data may have text values; 39.0 used for undetectable (below LOD)</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">viral_load_undetectable</span></td>
                                <td><span class="source-file">DERIVED</span></td>
                                <td><span class="source-cols">viral_load</span></td>
                                <td><span class="unit-badge">boolean (0/1)</span></td>
                                <td><div class="formula-box"><strong>Formula:</strong> viral_load <= 50</div><div class="code-block">df['viral_load_undetectable'] = (df['viral_load'] &lt;= 50).astype(float)
df['viral_load_undetectable'] = df['viral_load_undetectable'].where(df['viral_load'].notna())</div><div class="transform-desc">Flag for undetectable viral load (≤50 copies/mL)</div></td>
                                <td class="notes-cell">NaN where viral_load is missing</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">log10_viral_load</span></td>
                                <td><span class="source-file">DERIVED</span></td>
                                <td><span class="source-cols">viral_load</span></td>
                                <td><span class="unit-badge">log10(copies/mL)</span></td>
                                <td><div class="formula-box"><strong>Formula:</strong> log10(viral_load) where viral_load > 0</div><div class="code-block">df['log10_viral_load'] = np.log10(df['viral_load'].replace(0, np.nan))</div><div class="transform-desc">Log10 transformation; zero/negative → NaN</div></td>
                                <td class="notes-cell">Standard transformation for viral load analysis</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">on_art</span></td>
                                <td><span class="source-file">SS005.csv + FV001.csv</span></td>
                                <td><span class="source-cols">cartstart (SS005), has_art_started (FV001)</span></td>
                                <td><span class="unit-badge">boolean (0/1)</span></td>
                                <td><div class="code-block">df['on_art'] = df['cartstart'].fillna(df['has_art_started']).fillna(0)</div><div class="transform-desc">ART status from SS005, filled from FV001</div></td>
                                <td class="notes-cell">cartstart = current ART start indicator</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">hiv_status</span></td>
                                <td><span class="source-file">STUDY_DESIGN</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['hiv_status'] = 'Positive'</div><div class="transform-desc">All participants HIV-positive by study design</div></td>
                                <td class="notes-cell">Study inclusion criterion: newly diagnosed HIV-positive</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">date_of_birth</span></td>
                                <td><span class="source-file">JHB_Aurum_009_EL001.csv</span></td>
                                <td><span class="source-cols">dbirth</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['date_of_birth'] = pd.to_datetime(df['dbirth'], errors='coerce')</div><div class="transform-desc">Direct mapping of date of birth</div></td>
                                <td class="notes-cell">Used to calculate age at enrollment</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">site_name</span></td>
                                <td><span class="source-file">JHB_Aurum_009_EL001.csv</span></td>
                                <td><span class="source-cols">sitedesc</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['site_name'] = df['sitedesc']</div><div class="transform-desc">Direct mapping of site description</div></td>
                                <td class="notes-cell">Name of enrollment site/facility</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">facility_name</span></td>
                                <td><span class="source-file">JHB_Aurum_009_FV001.csv</span></td>
                                <td><span class="source-cols">abstfac</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['facility_name'] = df['abstfac']</div><div class="transform-desc">Facility name from chart abstraction</div></td>
                                <td class="notes-cell">Healthcare facility where patient receives care</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">town</span></td>
                                <td><span class="source-file">JHB_Aurum_009_SS005.csv</span></td>
                                <td><span class="source-cols">carttown, bldtktown</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['town'] = df['carttown'].fillna(df['bldtktown'])</div><div class="transform-desc">Town from ART facility or blood draw facility</div></td>
                                <td class="notes-cell">Geographic location of healthcare</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">province</span></td>
                                <td><span class="source-file">JHB_Aurum_009_SS005.csv</span></td>
                                <td><span class="source-cols">cartprov, bldtkprov</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['province'] = df['cartprov'].fillna(df['bldtkprov'])</div><div class="transform-desc">Province from ART facility or blood draw facility</div></td>
                                <td class="notes-cell">South African province</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">cd4_enrollment</span></td>
                                <td><span class="source-file">JHB_Aurum_009_FV001.csv</span></td>
                                <td><span class="source-cols">enrcd4res</span></td>
                                <td><span class="unit-badge">cells/µL</span></td>
                                <td><div class="code-block">df['cd4_enrollment'] = pd.to_numeric(df['enrcd4res'], errors='coerce')</div><div class="transform-desc">CD4 count at enrollment</div></td>
                                <td class="notes-cell">enrcd4res = enrollment CD4 result</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">cd4_latest</span></td>
                                <td><span class="source-file">JHB_Aurum_009_FV001.csv</span></td>
                                <td><span class="source-cols">ltcd4res</span></td>
                                <td><span class="unit-badge">cells/µL</span></td>
                                <td><div class="code-block">df['cd4_latest'] = pd.to_numeric(df['ltcd4res'], errors='coerce')</div><div class="transform-desc">Most recent CD4 count from chart</div></td>
                                <td class="notes-cell">ltcd4res = latest CD4 result</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">cd4_lowest</span></td>
                                <td><span class="source-file">JHB_Aurum_009_FV001.csv</span></td>
                                <td><span class="source-cols">lowcd4count</span></td>
                                <td><span class="unit-badge">cells/µL</span></td>
                                <td><div class="code-block">df['cd4_lowest'] = pd.to_numeric(df['lowcd4count'], errors='coerce')</div><div class="transform-desc">Lowest CD4 count recorded</div></td>
                                <td class="notes-cell">Nadir CD4 - important for disease staging</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">cd4_at_art_start</span></td>
                                <td><span class="source-file">JHB_Aurum_009_FV001.csv</span></td>
                                <td><span class="source-cols">artcd4result</span></td>
                                <td><span class="unit-badge">cells/µL</span></td>
                                <td><div class="code-block">df['cd4_at_art_start'] = pd.to_numeric(df['artcd4result'], errors='coerce')</div><div class="transform-desc">CD4 count when ART was started</div></td>
                                <td class="notes-cell">artcd4result = CD4 at ART initiation</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">viral_load_latest</span></td>
                                <td><span class="source-file">JHB_Aurum_009_FV001.csv</span></td>
                                <td><span class="source-cols">lastvlres</span></td>
                                <td><span class="unit-badge">copies/mL</span></td>
                                <td><div class="formula-box"><strong>Formula:</strong> parse_viral_load(value)</div><div class="code-block">df['viral_load_latest'] = df['lastvlres'].apply(parse_viral_load)</div><div class="transform-desc">Most recent viral load from chart</div></td>
                                <td class="notes-cell">lastvlres = last viral load result; same parsing as viral_load</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">date_care_entry</span></td>
                                <td><span class="source-file">JHB_Aurum_009_FV001.csv</span></td>
                                <td><span class="source-cols">dentercare</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['date_care_entry'] = pd.to_datetime(df['dentercare'], errors='coerce')</div><div class="transform-desc">Date patient entered HIV care</div></td>
                                <td class="notes-cell">dentercare = date entered care</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">date_art_start</span></td>
                                <td><span class="source-file">JHB_Aurum_009_FV001.csv</span></td>
                                <td><span class="source-cols">dstartart</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['date_art_start'] = pd.to_datetime(df['dstartart'], errors='coerce')</div><div class="transform-desc">Date ART was initiated</div></td>
                                <td class="notes-cell">dstartart = date started ART</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">education_level</span></td>
                                <td><span class="source-file">JHB_Aurum_009_DM002.csv</span></td>
                                <td><span class="source-cols">edu</span></td>
                                <td>-</td>
                                <td><div class="code-block">EDU_MAP = {1: 'No formal education', 2: 'Primary school', 3: 'Some secondary', 4: 'Completed secondary', 5: 'Some tertiary', 6: 'Completed tertiary', 7: 'Post-graduate'}
df['education_level'] = df['edu'].map(EDU_MAP)</div><div class="transform-desc">Map education codes to descriptive labels</div></td>
                                <td class="notes-cell">edu = education level code</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">employment_status</span></td>
                                <td><span class="source-file">JHB_Aurum_009_DM002.csv</span></td>
                                <td><span class="source-cols">emplst1</span></td>
                                <td>-</td>
                                <td><div class="code-block">EMPL_MAP = {1: 'Employed full-time', 2: 'Employed part-time', 3: 'Self-employed', 4: 'Unemployed looking', 5: 'Unemployed not looking', 6: 'Student', 7: 'Retired', 8: 'Disabled'}
df['employment_status'] = df['emplst1'].map(EMPL_MAP)</div><div class="transform-desc">Map employment status codes</div></td>
                                <td class="notes-cell">emplst1 = employment status primary</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">marital_status</span></td>
                                <td><span class="source-file">JHB_Aurum_009_DM002.csv</span></td>
                                <td><span class="source-cols">marit</span></td>
                                <td>-</td>
                                <td><div class="code-block">MARIT_MAP = {1: 'Single', 2: 'Married', 3: 'Separated', 4: 'Divorced', 5: 'Widowed', 6: 'Cohabiting'}
df['marital_status'] = df['marit'].map(MARIT_MAP)</div><div class="transform-desc">Map marital status codes</div></td>
                                <td class="notes-cell">marit = marital status</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">monthly_income</span></td>
                                <td><span class="source-file">JHB_Aurum_009_DM002.csv</span></td>
                                <td><span class="source-cols">incom</span></td>
                                <td>-</td>
                                <td><div class="code-block">INCOME_MAP = {1: 'R0', 2: 'R1-R500', 3: 'R501-R1000', 4: 'R1001-R2000', 5: 'R2001-R3000', 6: 'R3001-R5000', 7: 'R5001-R10000', 8: 'R10001-R20000', 9: 'R20001+', 10: 'Refused', 11: 'Don\'t know'}
df['monthly_income'] = df['incom'].map(INCOME_MAP)</div><div class="transform-desc">Map income bracket codes to ranges (South African Rand)</div></td>
                                <td class="notes-cell">incom = income category</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">housing_type</span></td>
                                <td><span class="source-file">JHB_Aurum_009_DM002.csv</span></td>
                                <td><span class="source-cols">dwell</span></td>
                                <td>-</td>
                                <td><div class="code-block">DWELL_MAP = {1: 'Formal house', 2: 'Flat/apartment', 3: 'Townhouse', 4: 'Room in backyard', 5: 'Informal shack', 6: 'Hostel', 7: 'Other'}
df['housing_type'] = df['dwell'].map(DWELL_MAP)</div><div class="transform-desc">Map dwelling type codes</div></td>
                                <td class="notes-cell">dwell = dwelling type</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">medical_insurance</span></td>
                                <td><span class="source-file">JHB_Aurum_009_DM002.csv</span></td>
                                <td><span class="source-cols">medaid</span></td>
                                <td><span class="unit-badge">boolean (0/1)</span></td>
                                <td><div class="code-block">df['medical_insurance'] = df['medaid'].map({0: 0, 1: 1})</div><div class="transform-desc">Medical aid/insurance status</div></td>
                                <td class="notes-cell">medaid = medical aid (0=No, 1=Yes)</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">latitude</span></td>
                                <td><span class="source-file">GEOCODED</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td><span class="unit-badge">degrees</span></td>
                                <td><div class="code-block">df['latitude'] = -26.2041  # Default Johannesburg coordinates</div><div class="transform-desc">Geocoded from facility/town; default to Johannesburg center</div></td>
                                <td class="notes-cell">Geocoding based on facility location or default coordinates</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">longitude</span></td>
                                <td><span class="source-file">GEOCODED</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td><span class="unit-badge">degrees</span></td>
                                <td><div class="code-block">df['longitude'] = 28.0473  # Default Johannesburg coordinates</div><div class="transform-desc">Geocoded from facility/town; default to Johannesburg center</div></td>
                                <td class="notes-cell">Geocoding based on facility location or default coordinates</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">study_id</span></td>
                                <td><span class="source-file">METADATA</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['study_id'] = 'JHB_Aurum_009'</div><div class="transform-desc">Study identifier constant</div></td>
                                <td class="notes-cell">Harmonization metadata</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">study_name</span></td>
                                <td><span class="source-file">METADATA</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['study_name'] = 'Aurum 009 - HIV Linkage to Care Cohort'</div><div class="transform-desc">Full study name constant</div></td>
                                <td class="notes-cell">Harmonization metadata</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">study_type</span></td>
                                <td><span class="source-file">METADATA</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['study_type'] = 'Longitudinal Cohort Study'</div><div class="transform-desc">Study design type</div></td>
                                <td class="notes-cell">Harmonization metadata</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">country</span></td>
                                <td><span class="source-file">METADATA</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['country'] = 'South Africa'</div><div class="transform-desc">Country constant</div></td>
                                <td class="notes-cell">All Aurum 009 sites in South Africa</td>
                            </tr>

                        </tbody>
                    </table>
                </div>

            </div>
        </div>

        <div class="study-section" id="JHB_VIDA_007">
            <div class="study-header">
                <h2>JHB_VIDA_007</h2>
                <div class="study-name">VIDA 007 - ChAdOx1 COVID-19 Vaccine Trial</div>
            </div>
            <div class="study-content">

                <div class="info-section">
                    <h3>Study Information</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">Study Type</div>
                            <div class="info-value">Vaccine Trial (Randomized)</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Data Format</div>
                            <div class="info-value">Visit-Specific CSV Files</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Site</div>
                            <div class="info-value">VIDA Vaccines and Infectious Diseases Analytics</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Population</div>
                            <div class="info-value">Adults eligible for COVID-19 vaccination</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Total Records</div>
                            <div class="info-value">15,581</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Unique Patients</div>
                            <div class="info-value">4,254</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Source Path</div>
                            <div class="info-value" style="font-size: 0.75rem; word-break: break-all;">/home/cparker/incoming/RP2/JHB_VIDA_007/csv</div>
                        </div>
                    </div>
                </div>

                <div class="info-section">
                    <h3>Harmonization Methodology</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">Version</div>
                            <div class="info-value">2.0_LONGITUDINAL</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Script</div>
                            <div class="info-value" style="font-family: monospace; font-size: 0.85rem;">JHB_VIDA_007_LONGITUDINAL_HARMONIZER.py</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Date</div>
                            <div class="info-value">2025-12-02</div>
                        </div>
                    </div>
                </div>

                <div class="info-section">
                    <h3>Critical Study Context Notes</h3>
                    <ul class="notes-list">
                        <li>ChAdOx1 (Oxford/AstraZeneca) COVID-19 vaccine trial</li>
                        <li>10 visit timepoints: Screening, Day 0, 3, 7, 14, 28, 42, 56, 182, 364</li>
                        <li>Each visit stored in separate CSV with visit-specific column naming</li>
                        <li>Rich vital signs data at each visit (BP, pulse, temp, resp, SpO2)</li>
                        <li>HIV status mostly negative/unknown for this COVID vaccine population</li>

                    </ul>
                </div>

                <div class="info-section">
                    <h3>Source Files</h3>
                    <table class="source-files-table">
                        <thead>
                            <tr>
                                <th>File Name</th>
                                <th>Description</th>
                                <th>Records</th>
                                <th>Key Columns</th>
                            </tr>
                        </thead>
                        <tbody>

                            <tr>
                                <td style="font-family: monospace; font-size: 0.85rem;">ChAdOx_data_demographic_and_contact_information_v2_3.csv</td>
                                <td>Demographics</td>
                                <td>2,130</td>
                                <td style="font-family: monospace; font-size: 0.8rem;">record_id, sc_age_v2_3, sc_gender_v2_3, sc_race_v2_3</td>
                            </tr>

                            <tr>
                                <td style="font-family: monospace; font-size: 0.85rem;">ChAdOx_data_vital_signs_screening_visit_v2_3.csv</td>
                                <td>Screening vital signs</td>
                                <td>~2,100</td>
                                <td style="font-family: monospace; font-size: 0.8rem;">record_id, vs_scr_dat_v2_3, sc_bp_sys_v2_3, sc_bp_dia_v2_3, sc_weight_v2_3, sc_height_v2_3</td>
                            </tr>

                            <tr>
                                <td style="font-family: monospace; font-size: 0.85rem;">ChAdOx_data_day_0_vaccination.csv</td>
                                <td>Day 0 (vaccination) vitals</td>
                                <td>~2,100</td>
                                <td style="font-family: monospace; font-size: 0.8rem;">record_id, vacc_dat, pv60_sys, pv60_dia, pv60_temp</td>
                            </tr>

                            <tr>
                                <td style="font-family: monospace; font-size: 0.85rem;">ChAdOx_data_day_*_post_vaccination*.csv</td>
                                <td>Follow-up visits (Day 3, 7, 14, 28, 42, 56, 182, 364)</td>
                                <td>varies by visit</td>
                                <td style="font-family: monospace; font-size: 0.8rem;">record_id, d{N}_dat, d{N}_sys, d{N}_dia, d{N}_temp</td>
                            </tr>

                        </tbody>
                    </table>
                </div>

                <div class="info-section">
                    <h3>Complete Variable Lineage & Transformation Details</h3>
                    <table class="lineage-table">
                        <thead>
                            <tr>
                                <th style="width: 12%;">Variable</th>
                                <th style="width: 15%;">Source File</th>
                                <th style="width: 15%;">Source Column(s)</th>
                                <th style="width: 8%;">Units</th>
                                <th style="width: 25%;">Transformation Code</th>
                                <th style="width: 25%;">Notes</th>
                            </tr>
                        </thead>
                        <tbody>

                            <tr>
                                <td><span class="var-name">patient_id</span></td>
                                <td><span class="source-file">Demographics CSV</span></td>
                                <td><span class="source-cols">record_id</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['patient_id'] = df['record_id']</div><div class="transform-desc">Direct mapping</div></td>
                                <td class="notes-cell">REDCap record ID</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">age_years</span></td>
                                <td><span class="source-file">Demographics CSV</span></td>
                                <td><span class="source-cols">sc_age_v2_3</span></td>
                                <td><span class="unit-badge">years</span></td>
                                <td><div class="code-block">df['age_years'] = pd.to_numeric(df['sc_age_v2_3'], errors='coerce')</div><div class="transform-desc">Direct mapping from screening age</div></td>
                                <td class="notes-cell">Age at screening</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">sex</span></td>
                                <td><span class="source-file">Demographics CSV</span></td>
                                <td><span class="source-cols">sc_gender_v2_3</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['sex'] = df['sc_gender_v2_3'].map({1.0: 'Male', 2.0: 'Female'})</div><div class="transform-desc">Map gender codes to labels</div></td>
                                <td class="notes-cell">1=Male, 2=Female</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">race</span></td>
                                <td><span class="source-file">Demographics CSV</span></td>
                                <td><span class="source-cols">sc_race_v2_3</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['race'] = df['sc_race_v2_3'].map({1.0: 'African Heritage', 2.0: 'Caucasian', 3.0: 'Asian', 4.0: 'Coloured', 5.0: 'Other'})</div><div class="transform-desc">Map race codes to South African categories</div></td>
                                <td class="notes-cell">SA standard race categories</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">visit</span></td>
                                <td><span class="source-file">DERIVED</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td>-</td>
                                <td><div class="code-block"># Set during visit extraction
df['visit'] = visit_name  # e.g., 'Screening', 'Day 0', 'Day 3', etc.</div><div class="transform-desc">Assigned based on source file</div></td>
                                <td class="notes-cell">Visit name from VISIT_CONFIG: Screening, Day 0, 3, 7, 14, 28, 42, 56, 182, 364</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">visit_num</span></td>
                                <td><span class="source-file">DERIVED</span></td>
                                <td><span class="source-cols">visit</span></td>
                                <td>-</td>
                                <td><div class="code-block">visit_num_map = {'Screening': 0, 'Day 0': 1, 'Day 3': 2, 'Day 7': 3, 'Day 14': 4, 'Day 28': 5, 'Day 42': 6, 'Day 56': 7, 'Day 182': 8, 'Day 364': 9}
df['visit_num'] = df['visit'].map(visit_num_map)</div><div class="transform-desc">Numeric visit order for sorting</div></td>
                                <td class="notes-cell">0-9 for 10 visits</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">systolic_bp</span></td>
                                <td><span class="source-file">Visit-specific CSV</span></td>
                                <td><span class="source-cols">sc_bp_sys_v2_3 (Screening), pv60_sys (Day 0), d{N}_sys (Day N)</span></td>
                                <td><span class="unit-badge">mmHg</span></td>
                                <td><div class="code-block"># Column name varies by visit
df['systolic_bp'] = pd.to_numeric(df[config['systolic']], errors='coerce')</div><div class="transform-desc">Extract systolic BP using visit-specific column name from VISIT_CONFIG</div></td>
                                <td class="notes-cell">Column names: sc_bp_sys_v2_3, pv60_sys, d3_sys, d7_sys, d14_sys, d28_sys, d42_sys_v3_2, etc.</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">diastolic_bp</span></td>
                                <td><span class="source-file">Visit-specific CSV</span></td>
                                <td><span class="source-cols">sc_bp_dia_v2_3 (Screening), pv60_dia (Day 0), d{N}_dia (Day N)</span></td>
                                <td><span class="unit-badge">mmHg</span></td>
                                <td><div class="code-block">df['diastolic_bp'] = pd.to_numeric(df[config['diastolic']], errors='coerce')</div><div class="transform-desc">Extract diastolic BP using visit-specific column name</div></td>
                                <td class="notes-cell">Same naming pattern as systolic</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">heart_rate</span></td>
                                <td><span class="source-file">Visit-specific CSV</span></td>
                                <td><span class="source-cols">sc_pulse_v2_3, pv60_pulse, d{N}_pulse</span></td>
                                <td><span class="unit-badge">bpm</span></td>
                                <td><div class="code-block">df['heart_rate'] = pd.to_numeric(df[config['pulse']], errors='coerce')</div><div class="transform-desc">Extract pulse rate using visit-specific column</div></td>
                                <td class="notes-cell">Originally 'pulse', renamed to 'heart_rate' in standardization</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">temperature_c</span></td>
                                <td><span class="source-file">Visit-specific CSV</span></td>
                                <td><span class="source-cols">sc_temp_v2_3, pv60_temp, d{N}_temp</span></td>
                                <td><span class="unit-badge">°C</span></td>
                                <td><div class="code-block">df['temperature_c'] = pd.to_numeric(df[config['temp']], errors='coerce')</div><div class="transform-desc">Extract temperature using visit-specific column</div></td>
                                <td class="notes-cell">Originally 'temp', renamed to 'temperature_c'</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">respiratory_rate</span></td>
                                <td><span class="source-file">Visit-specific CSV</span></td>
                                <td><span class="source-cols">sc_resp_v2_3, pv60_resp, d{N}_resp</span></td>
                                <td><span class="unit-badge">breaths/min</span></td>
                                <td><div class="code-block">df['respiratory_rate'] = pd.to_numeric(df[config['resp']], errors='coerce')</div><div class="transform-desc">Extract respiratory rate using visit-specific column</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">oxygen_saturation</span></td>
                                <td><span class="source-file">Visit-specific CSV</span></td>
                                <td><span class="source-cols">sc_oxy_v2_3, pv60_oxy, d{N}_oxy</span></td>
                                <td><span class="unit-badge">%</span></td>
                                <td><div class="code-block">df['oxygen_saturation'] = pd.to_numeric(df[config['oxygen']], errors='coerce')</div><div class="transform-desc">Extract SpO2 using visit-specific column</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">weight_kg</span></td>
                                <td><span class="source-file">Screening CSV only</span></td>
                                <td><span class="source-cols">sc_weight_v2_3</span></td>
                                <td><span class="unit-badge">kg</span></td>
                                <td><div class="code-block">df['weight_kg'] = pd.to_numeric(df['sc_weight_v2_3'], errors='coerce')</div><div class="transform-desc">Extract weight from screening visit only</div></td>
                                <td class="notes-cell">Only measured at screening</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">height_cm</span></td>
                                <td><span class="source-file">Screening CSV only</span></td>
                                <td><span class="source-cols">sc_height_v2_3</span></td>
                                <td><span class="unit-badge">cm</span></td>
                                <td><div class="code-block">df['height_cm'] = pd.to_numeric(df['sc_height_v2_3'], errors='coerce')</div><div class="transform-desc">Extract height from screening visit only</div></td>
                                <td class="notes-cell">Only measured at screening</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">bmi</span></td>
                                <td><span class="source-file">ChAdOx_data_vital_signs_screening_visit_v2_3.csv</span></td>
                                <td><span class="source-cols">sc_bmi_v2_3</span></td>
                                <td><span class="unit-badge">kg/m²</span></td>
                                <td><div class="code-block">df['bmi'] = pd.to_numeric(df['sc_bmi_v2_3'], errors='coerce')</div><div class="transform-desc">Direct from source (pre-calculated at screening)</div></td>
                                <td class="notes-cell">Pre-calculated in source; only available at screening</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">visit_date</span></td>
                                <td><span class="source-file">Visit-specific CSV</span></td>
                                <td><span class="source-cols">vs_scr_dat_v2_3 (Screening), vacc_dat (Day 0), d{N}_dat (Day N)</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['visit_date'] = pd.to_datetime(df[config['date']], errors='coerce')</div><div class="transform-desc">Extract visit date using visit-specific column name</div></td>
                                <td class="notes-cell">Column names: vs_scr_dat_v2_3, vacc_dat, d3_dat, d7_dat, d14_dat, d28_dat, etc.</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">vaccination_date</span></td>
                                <td><span class="source-file">ChAdOx_data_day_0_vaccination.csv</span></td>
                                <td><span class="source-cols">vacc_dat</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['vaccination_date'] = pd.to_datetime(df['vacc_dat'], errors='coerce')</div><div class="transform-desc">Date of COVID-19 vaccination (Day 0)</div></td>
                                <td class="notes-cell">Primary vaccination date</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">urine_protein</span></td>
                                <td><span class="source-file">ChAdOx_data_vital_signs_screening_visit_v2_3.csv</span></td>
                                <td><span class="source-cols">ur_protein_v2_3</span></td>
                                <td><span class="unit-badge">categorical</span></td>
                                <td><div class="code-block">df['urine_protein'] = df['ur_protein_v2_3']</div><div class="transform-desc">Urine protein dipstick result</div></td>
                                <td class="notes-cell">Screening urinalysis</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">urine_blood</span></td>
                                <td><span class="source-file">ChAdOx_data_vital_signs_screening_visit_v2_3.csv</span></td>
                                <td><span class="source-cols">ur_blood_v2_3</span></td>
                                <td><span class="unit-badge">categorical</span></td>
                                <td><div class="code-block">df['urine_blood'] = df['ur_blood_v2_3']</div><div class="transform-desc">Urine blood dipstick result</div></td>
                                <td class="notes-cell">Screening urinalysis</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">urine_glucose</span></td>
                                <td><span class="source-file">ChAdOx_data_vital_signs_screening_visit_v2_3.csv</span></td>
                                <td><span class="source-cols">ur_glucose_v2_3</span></td>
                                <td><span class="unit-badge">categorical</span></td>
                                <td><div class="code-block">df['urine_glucose'] = df['ur_glucose_v2_3']</div><div class="transform-desc">Urine glucose dipstick result</div></td>
                                <td class="notes-cell">Screening urinalysis</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">pregnancy_test</span></td>
                                <td><span class="source-file">ChAdOx_data_vital_signs_screening_visit_v2_3.csv</span></td>
                                <td><span class="source-cols">sc_preg_test_v2_3, ur_pregnancy_result_v2_3</span></td>
                                <td><span class="unit-badge">categorical</span></td>
                                <td><div class="code-block">df['pregnancy_test'] = df['ur_pregnancy_result_v2_3']</div><div class="transform-desc">Urine pregnancy test result</div></td>
                                <td class="notes-cell">Required for women of childbearing potential</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">childbearing_potential</span></td>
                                <td><span class="source-file">ChAdOx_data_demographic_and_contact_information_v2_3.csv</span></td>
                                <td><span class="source-cols">sc_childbear_v2_3</span></td>
                                <td><span class="unit-badge">boolean</span></td>
                                <td><div class="code-block">df['childbearing_potential'] = df['sc_childbear_v2_3']</div><div class="transform-desc">Woman of childbearing potential flag</div></td>
                                <td class="notes-cell">Screening criterion for contraception requirements</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">latitude</span></td>
                                <td><span class="source-file">GEOCODED</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td><span class="unit-badge">degrees</span></td>
                                <td><div class="code-block">df['latitude'] = -26.1929  # VIDA research site, Soweto</div><div class="transform-desc">Fixed coordinates for VIDA research site</div></td>
                                <td class="notes-cell">VIDA Vaccines and Infectious Diseases Analytics, Soweto</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">longitude</span></td>
                                <td><span class="source-file">GEOCODED</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td><span class="unit-badge">degrees</span></td>
                                <td><div class="code-block">df['longitude'] = 27.9082  # VIDA research site, Soweto</div><div class="transform-desc">Fixed coordinates for VIDA research site</div></td>
                                <td class="notes-cell">All participants enrolled at single site</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">study_id</span></td>
                                <td><span class="source-file">METADATA</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['study_id'] = 'JHB_VIDA_007'</div><div class="transform-desc">Study identifier constant</div></td>
                                <td class="notes-cell">Harmonization metadata</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">study_name</span></td>
                                <td><span class="source-file">METADATA</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['study_name'] = 'VIDA 007 - ChAdOx1 COVID-19 Vaccine Trial'</div><div class="transform-desc">Full study name constant</div></td>
                                <td class="notes-cell">Harmonization metadata</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">study_type</span></td>
                                <td><span class="source-file">METADATA</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['study_type'] = 'Vaccine Trial (Randomized)'</div><div class="transform-desc">Study design type</div></td>
                                <td class="notes-cell">Harmonization metadata</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">country</span></td>
                                <td><span class="source-file">METADATA</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['country'] = 'South Africa'</div><div class="transform-desc">Country constant</div></td>
                                <td class="notes-cell">VIDA site in Soweto, South Africa</td>
                            </tr>

                        </tbody>
                    </table>
                </div>

            </div>
        </div>

        <div class="study-section" id="JHB_Ezin_002">
            <div class="study-header">
                <h2>JHB_Ezin_002</h2>
                <div class="study-name">Ezintsha 002 - HIV Treatment Trial</div>
            </div>
            <div class="study-content">

                <div class="info-section">
                    <h3>Study Information</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">Study Type</div>
                            <div class="info-value">HIV Treatment Trial (Randomized)</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Data Format</div>
                            <div class="info-value">Domain-Specific CSVs</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Site</div>
                            <div class="info-value">Ezintsha</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Population</div>
                            <div class="info-value">HIV-positive adults initiating treatment</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Total Records</div>
                            <div class="info-value">11,059</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Unique Patients</div>
                            <div class="info-value">1,053</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Source Path</div>
                            <div class="info-value" style="font-size: 0.75rem; word-break: break-all;">/home/cparker/incoming/RP2/JHB_Ezin_002/csv</div>
                        </div>
                    </div>
                </div>

                <div class="info-section">
                    <h3>Harmonization Methodology</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">Version</div>
                            <div class="info-value">2.0_LONGITUDINAL</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Script</div>
                            <div class="info-value" style="font-family: monospace; font-size: 0.85rem;">JHB_Ezin_002_LONGITUDINAL_HARMONIZER.py</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Date</div>
                            <div class="info-value">2025-12-02</div>
                        </div>
                    </div>
                </div>

                <div class="info-section">
                    <h3>Critical Study Context Notes</h3>
                    <ul class="notes-list">
                        <li>HIV treatment trial comparing DTG+TAF+FTC vs comparator</li>
                        <li>All participants HIV-positive and on ART</li>
                        <li>13 visits: Screening, Enrolment, W04, W12, W24, W36, W48, W60, W72, W84, EOS</li>
                        <li>Viral load stored as text ('Not detected') requiring parsing</li>
                        <li>Rich hematology panel including full CBC differential</li>

                    </ul>
                </div>

                <div class="info-section">
                    <h3>Source Files</h3>
                    <table class="source-files-table">
                        <thead>
                            <tr>
                                <th>File Name</th>
                                <th>Description</th>
                                <th>Records</th>
                                <th>Key Columns</th>
                            </tr>
                        </thead>
                        <tbody>

                            <tr>
                                <td style="font-family: monospace; font-size: 0.85rem;">JHB_Ezin_002_200327_adv Weight&Vitals.csv</td>
                                <td>Vital signs (longitudinal backbone)</td>
                                <td>~11,000</td>
                                <td style="font-family: monospace; font-size: 0.8rem;">ranid, visit, visit_date, height, weight, systolic, diastolic, heartrate, bodytemperature</td>
                            </tr>

                            <tr>
                                <td style="font-family: monospace; font-size: 0.85rem;">JHB_Ezin_002_200326_adv hiv rna.csv</td>
                                <td>Viral load measurements</td>
                                <td>~10,000</td>
                                <td style="font-family: monospace; font-size: 0.8rem;">ranid, visit, colldate, result</td>
                            </tr>

                            <tr>
                                <td style="font-family: monospace; font-size: 0.85rem;">JHB_Ezin_002_200408_adv haematology.csv</td>
                                <td>Hematology panel including CD4</td>
                                <td>~10,000</td>
                                <td style="font-family: monospace; font-size: 0.8rem;">ranid, visit, age, sex, result__CD4 CELL COUNT, result__HAEMOGLOBIN, result__*</td>
                            </tr>

                        </tbody>
                    </table>
                </div>

                <div class="info-section">
                    <h3>Complete Variable Lineage & Transformation Details</h3>
                    <table class="lineage-table">
                        <thead>
                            <tr>
                                <th style="width: 12%;">Variable</th>
                                <th style="width: 15%;">Source File</th>
                                <th style="width: 15%;">Source Column(s)</th>
                                <th style="width: 8%;">Units</th>
                                <th style="width: 25%;">Transformation Code</th>
                                <th style="width: 25%;">Notes</th>
                            </tr>
                        </thead>
                        <tbody>

                            <tr>
                                <td><span class="var-name">patient_id</span></td>
                                <td><span class="source-file">Vitals CSV</span></td>
                                <td><span class="source-cols">ranid</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['patient_id'] = df['ranid']</div><div class="transform-desc">Direct mapping of randomization ID</div></td>
                                <td class="notes-cell">ranid = randomization ID</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">visit</span></td>
                                <td><span class="source-file">Vitals CSV</span></td>
                                <td><span class="source-cols">visit</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['visit'] = df['visit'].replace({'screening': 'Screening'})</div><div class="transform-desc">Standardize visit names (capitalize screening)</div></td>
                                <td class="notes-cell">Visits: Screening, Enrolment, Visit 1 W04, Visit 2 W12, etc.</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">visit_num</span></td>
                                <td><span class="source-file">DERIVED</span></td>
                                <td><span class="source-cols">visit</span></td>
                                <td>-</td>
                                <td><div class="code-block">VISIT_NUM_MAP = {'Screening': 0, 'Enrolment': 1, 'Visit 1 W04': 2, 'Visit 2 W12': 3, 'Visit 3 W24': 4, 'Visit 4 W36': 5, 'Visit 5 W48': 6, 'Visit 6 W60': 7, 'Visit 7 W72': 8, 'Visit 8 W84': 9, 'Visit 9 EOS': 10}
df['visit_num'] = df['visit'].map(VISIT_NUM_MAP).fillna(99)</div><div class="transform-desc">Map visit names to numeric order</div></td>
                                <td class="notes-cell">99 for Unscheduled/Early Termination</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">visit_date</span></td>
                                <td><span class="source-file">Vitals CSV</span></td>
                                <td><span class="source-cols">visit_date</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['visit_date'] = pd.to_datetime(df['visit_date'], errors='coerce')</div><div class="transform-desc">Convert to datetime</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">age_years</span></td>
                                <td><span class="source-file">Hematology CSV</span></td>
                                <td><span class="source-cols">age</span></td>
                                <td><span class="unit-badge">years</span></td>
                                <td><div class="code-block">df['age_years'] = pd.to_numeric(df['age'], errors='coerce')</div><div class="transform-desc">Direct mapping from hematology file</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">sex</span></td>
                                <td><span class="source-file">Hematology CSV</span></td>
                                <td><span class="source-cols">sex</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['sex'] = df['sex'].map({'M': 'Male', 'F': 'Female'})</div><div class="transform-desc">Map M/F to Male/Female</div></td>
                                <td class="notes-cell">M=Male, F=Female</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">treatment_arm</span></td>
                                <td><span class="source-file">Vitals CSV</span></td>
                                <td><span class="source-cols">group</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['treatment_arm'] = df['group']</div><div class="transform-desc">Direct mapping of treatment group</div></td>
                                <td class="notes-cell">DTG+TAF+FTC vs comparator</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">height_cm</span></td>
                                <td><span class="source-file">Vitals CSV</span></td>
                                <td><span class="source-cols">height</span></td>
                                <td><span class="unit-badge">cm</span></td>
                                <td><div class="code-block">df['height_cm'] = pd.to_numeric(df['height'], errors='coerce')</div><div class="transform-desc">Direct mapping</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">weight_kg</span></td>
                                <td><span class="source-file">Vitals CSV</span></td>
                                <td><span class="source-cols">weight</span></td>
                                <td><span class="unit-badge">kg</span></td>
                                <td><div class="code-block">df['weight_kg'] = pd.to_numeric(df['weight'], errors='coerce')</div><div class="transform-desc">Direct mapping</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">bmi</span></td>
                                <td><span class="source-file">DERIVED</span></td>
                                <td><span class="source-cols">height, weight</span></td>
                                <td><span class="unit-badge">kg/m²</span></td>
                                <td><div class="formula-box"><strong>Formula:</strong> weight_kg / (height_cm / 100)²</div><div class="code-block">df['bmi'] = df['weight_kg'] / ((df['height_cm'] / 100) ** 2)</div><div class="transform-desc">Calculate BMI from height and weight</div></td>
                                <td class="notes-cell">Standard BMI formula</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">systolic_bp</span></td>
                                <td><span class="source-file">Vitals CSV</span></td>
                                <td><span class="source-cols">systolic</span></td>
                                <td><span class="unit-badge">mmHg</span></td>
                                <td><div class="code-block">df['systolic_bp'] = pd.to_numeric(df['systolic'], errors='coerce')</div><div class="transform-desc">Direct mapping</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">diastolic_bp</span></td>
                                <td><span class="source-file">Vitals CSV</span></td>
                                <td><span class="source-cols">diastolic</span></td>
                                <td><span class="unit-badge">mmHg</span></td>
                                <td><div class="code-block">df['diastolic_bp'] = pd.to_numeric(df['diastolic'], errors='coerce')</div><div class="transform-desc">Direct mapping</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">heart_rate</span></td>
                                <td><span class="source-file">Vitals CSV</span></td>
                                <td><span class="source-cols">heartrate</span></td>
                                <td><span class="unit-badge">bpm</span></td>
                                <td><div class="code-block">df['heart_rate'] = pd.to_numeric(df['heartrate'], errors='coerce')</div><div class="transform-desc">Direct mapping</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">temperature_c</span></td>
                                <td><span class="source-file">Vitals CSV</span></td>
                                <td><span class="source-cols">bodytemperature</span></td>
                                <td><span class="unit-badge">°C</span></td>
                                <td><div class="code-block">df['temperature_c'] = pd.to_numeric(df['bodytemperature'], errors='coerce')</div><div class="transform-desc">Direct mapping</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">viral_load</span></td>
                                <td><span class="source-file">Viral load CSV</span></td>
                                <td><span class="source-cols">result</span></td>
                                <td><span class="unit-badge">copies/mL</span></td>
                                <td><div class="formula-box"><strong>Formula:</strong> parse_vl(value)</div><div class="code-block">def parse_vl(value):
    if pd.isna(value): return np.nan
    if value == 'Not detected': return 39.0  # Below detection limit
    try: return float(value)
    except: return np.nan
df['viral_load'] = df['result'].apply(parse_vl)</div><div class="transform-desc">Parse viral load; 'Not detected' → 39.0 (below LOD)</div></td>
                                <td class="notes-cell">'Not detected' indicates undetectable viral load, coded as 39 (below 40 copies/mL)</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">viral_load_undetectable</span></td>
                                <td><span class="source-file">DERIVED</span></td>
                                <td><span class="source-cols">result</span></td>
                                <td><span class="unit-badge">boolean (0/1)</span></td>
                                <td><div class="formula-box"><strong>Formula:</strong> result == 'Not detected'</div><div class="code-block">df['viral_load_undetectable'] = (df['result'] == 'Not detected').astype(float)</div><div class="transform-desc">Flag directly from text result</div></td>
                                <td class="notes-cell">1 if 'Not detected', 0 otherwise</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">log10_viral_load</span></td>
                                <td><span class="source-file">DERIVED</span></td>
                                <td><span class="source-cols">viral_load</span></td>
                                <td><span class="unit-badge">log10(copies/mL)</span></td>
                                <td><div class="formula-box"><strong>Formula:</strong> log10(viral_load)</div><div class="code-block">df['log10_viral_load'] = np.log10(df['viral_load'].replace(0, np.nan))</div><div class="transform-desc">Log10 transformation</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">cd4_count</span></td>
                                <td><span class="source-file">Hematology CSV</span></td>
                                <td><span class="source-cols">result__CD4 CELL COUNT</span></td>
                                <td><span class="unit-badge">cells/µL</span></td>
                                <td><div class="code-block">df['cd4_count'] = pd.to_numeric(df['result__CD4 CELL COUNT'], errors='coerce')</div><div class="transform-desc">Extract from wide-format hematology results</div></td>
                                <td class="notes-cell">Column name includes prefix 'result__'</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">cd4_percent</span></td>
                                <td><span class="source-file">Hematology CSV</span></td>
                                <td><span class="source-cols">result__CD4 CELL %</span></td>
                                <td><span class="unit-badge">%</span></td>
                                <td><div class="code-block">df['cd4_percent'] = pd.to_numeric(df['result__CD4 CELL %'], errors='coerce')</div><div class="transform-desc">Extract from wide-format hematology results</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">hemoglobin</span></td>
                                <td><span class="source-file">Hematology CSV</span></td>
                                <td><span class="source-cols">result__HAEMOGLOBIN</span></td>
                                <td><span class="unit-badge">g/dL</span></td>
                                <td><div class="code-block">df['hemoglobin'] = pd.to_numeric(df['result__HAEMOGLOBIN'], errors='coerce')</div><div class="transform-desc">Extract from wide-format hematology results</div></td>
                                <td class="notes-cell">British spelling 'HAEMOGLOBIN' in source</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">hematocrit</span></td>
                                <td><span class="source-file">Hematology CSV</span></td>
                                <td><span class="source-cols">result__Hct</span></td>
                                <td><span class="unit-badge">%</span></td>
                                <td><div class="code-block">df['hematocrit'] = pd.to_numeric(df['result__Hct'], errors='coerce')</div><div class="transform-desc">Extract from wide-format hematology results</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">wbc</span></td>
                                <td><span class="source-file">Hematology CSV</span></td>
                                <td><span class="source-cols">result__WBC ONLY (NO DIFF.COUNT)</span></td>
                                <td><span class="unit-badge">10^9/L</span></td>
                                <td><div class="code-block">df['wbc'] = pd.to_numeric(df['result__WBC ONLY (NO DIFF.COUNT)'], errors='coerce')</div><div class="transform-desc">Extract from wide-format hematology results</div></td>
                                <td class="notes-cell">WBC without differential</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">platelets</span></td>
                                <td><span class="source-file">Hematology CSV</span></td>
                                <td><span class="source-cols">result__PLATELET COUNT (AUTO)</span></td>
                                <td><span class="unit-badge">10^9/L</span></td>
                                <td><div class="code-block">df['platelets'] = pd.to_numeric(df['result__PLATELET COUNT (AUTO)'], errors='coerce')</div><div class="transform-desc">Extract automated platelet count</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">neutrophils</span></td>
                                <td><span class="source-file">Hematology CSV</span></td>
                                <td><span class="source-cols">result__NEUTROPHILS PRT</span></td>
                                <td><span class="unit-badge">%</span></td>
                                <td><div class="code-block">df['neutrophils'] = pd.to_numeric(df['result__NEUTROPHILS PRT'], errors='coerce')</div><div class="transform-desc">Extract neutrophil percentage</div></td>
                                <td class="notes-cell">PRT = percent</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">lymphocytes</span></td>
                                <td><span class="source-file">Hematology CSV</span></td>
                                <td><span class="source-cols">result__LYMPHOCYTES PRT</span></td>
                                <td><span class="unit-badge">%</span></td>
                                <td><div class="code-block">df['lymphocytes'] = pd.to_numeric(df['result__LYMPHOCYTES PRT'], errors='coerce')</div><div class="transform-desc">Extract lymphocyte percentage</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">mcv</span></td>
                                <td><span class="source-file">JHB_Ezin_002_200408_adv haematology.csv</span></td>
                                <td><span class="source-cols">result__MCV (MEAN CELL VOLUME)</span></td>
                                <td><span class="unit-badge">fL</span></td>
                                <td><div class="code-block">df['mcv'] = pd.to_numeric(df['result__MCV (MEAN CELL VOLUME)'], errors='coerce')</div><div class="transform-desc">Extract mean cell volume</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">mch</span></td>
                                <td><span class="source-file">JHB_Ezin_002_200408_adv haematology.csv</span></td>
                                <td><span class="source-cols">result__MCH</span></td>
                                <td><span class="unit-badge">pg</span></td>
                                <td><div class="code-block">df['mch'] = pd.to_numeric(df['result__MCH'], errors='coerce')</div><div class="transform-desc">Mean corpuscular hemoglobin</div></td>
                                <td class="notes-cell">MCH = mean corpuscular hemoglobin</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">mchc</span></td>
                                <td><span class="source-file">JHB_Ezin_002_200408_adv haematology.csv</span></td>
                                <td><span class="source-cols">result__MCHC</span></td>
                                <td><span class="unit-badge">g/dL</span></td>
                                <td><div class="code-block">df['mchc'] = pd.to_numeric(df['result__MCHC'], errors='coerce')</div><div class="transform-desc">Mean corpuscular hemoglobin concentration</div></td>
                                <td class="notes-cell">MCHC = mean corpuscular hemoglobin concentration</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">rbc</span></td>
                                <td><span class="source-file">JHB_Ezin_002_200408_adv haematology.csv</span></td>
                                <td><span class="source-cols">result__RBC</span></td>
                                <td><span class="unit-badge">10^12/L</span></td>
                                <td><div class="code-block">df['rbc'] = pd.to_numeric(df['result__RBC'], errors='coerce')</div><div class="transform-desc">Red blood cell count</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">rdw</span></td>
                                <td><span class="source-file">JHB_Ezin_002_200408_adv haematology.csv</span></td>
                                <td><span class="source-cols">result__RDW</span></td>
                                <td><span class="unit-badge">%</span></td>
                                <td><div class="code-block">df['rdw'] = pd.to_numeric(df['result__RDW'], errors='coerce')</div><div class="transform-desc">Red cell distribution width</div></td>
                                <td class="notes-cell">RDW = red cell distribution width</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">monocytes</span></td>
                                <td><span class="source-file">JHB_Ezin_002_200408_adv haematology.csv</span></td>
                                <td><span class="source-cols">result__MONOCYTES PRT</span></td>
                                <td><span class="unit-badge">%</span></td>
                                <td><div class="code-block">df['monocytes'] = pd.to_numeric(df['result__MONOCYTES PRT'], errors='coerce')</div><div class="transform-desc">Monocyte percentage</div></td>
                                <td class="notes-cell">PRT = percent</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">eosinophils</span></td>
                                <td><span class="source-file">JHB_Ezin_002_200408_adv haematology.csv</span></td>
                                <td><span class="source-cols">result__EOSINOPHILS PRT</span></td>
                                <td><span class="unit-badge">%</span></td>
                                <td><div class="code-block">df['eosinophils'] = pd.to_numeric(df['result__EOSINOPHILS PRT'], errors='coerce')</div><div class="transform-desc">Eosinophil percentage</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">basophils</span></td>
                                <td><span class="source-file">JHB_Ezin_002_200408_adv haematology.csv</span></td>
                                <td><span class="source-cols">result__BASOPHILS PRT</span></td>
                                <td><span class="unit-badge">%</span></td>
                                <td><div class="code-block">df['basophils'] = pd.to_numeric(df['result__BASOPHILS PRT'], errors='coerce')</div><div class="transform-desc">Basophil percentage</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">hiv_status</span></td>
                                <td><span class="source-file">STUDY_DESIGN</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['hiv_status'] = 'Positive'</div><div class="transform-desc">All participants HIV-positive by study design</div></td>
                                <td class="notes-cell">HIV treatment trial - all participants HIV-positive</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">on_art</span></td>
                                <td><span class="source-file">STUDY_DESIGN</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td><span class="unit-badge">boolean (0/1)</span></td>
                                <td><div class="code-block">df['on_art'] = 1</div><div class="transform-desc">All participants on ART by study design</div></td>
                                <td class="notes-cell">Treatment trial - all on DTG+TAF+FTC or comparator</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">latitude</span></td>
                                <td><span class="source-file">GEOCODED</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td><span class="unit-badge">degrees</span></td>
                                <td><div class="code-block">df['latitude'] = -26.2041  # Ezintsha, Johannesburg</div><div class="transform-desc">Fixed coordinates for Ezintsha research site</div></td>
                                <td class="notes-cell">Ezintsha research facility coordinates</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">longitude</span></td>
                                <td><span class="source-file">GEOCODED</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td><span class="unit-badge">degrees</span></td>
                                <td><div class="code-block">df['longitude'] = 28.0473  # Ezintsha, Johannesburg</div><div class="transform-desc">Fixed coordinates for Ezintsha research site</div></td>
                                <td class="notes-cell">All participants enrolled at single site</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">study_id</span></td>
                                <td><span class="source-file">METADATA</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['study_id'] = 'JHB_Ezin_002'</div><div class="transform-desc">Study identifier constant</div></td>
                                <td class="notes-cell">Harmonization metadata</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">study_name</span></td>
                                <td><span class="source-file">METADATA</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['study_name'] = 'Ezintsha 002 - HIV Treatment Trial'</div><div class="transform-desc">Full study name constant</div></td>
                                <td class="notes-cell">Harmonization metadata</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">study_type</span></td>
                                <td><span class="source-file">METADATA</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['study_type'] = 'HIV Treatment Trial (Randomized)'</div><div class="transform-desc">Study design type</div></td>
                                <td class="notes-cell">Harmonization metadata</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">country</span></td>
                                <td><span class="source-file">METADATA</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['country'] = 'South Africa'</div><div class="transform-desc">Country constant</div></td>
                                <td class="notes-cell">Ezintsha site in Johannesburg, South Africa</td>
                            </tr>

                        </tbody>
                    </table>
                </div>

            </div>
        </div>

        <div class="study-section" id="JHB_DPHRU_053">
            <div class="study-header">
                <h2>JHB_DPHRU_053</h2>
                <div class="study-name">MASC - Menopausal and Ageing Study Cohort</div>
            </div>
            <div class="study-content">

                <div class="info-section">
                    <h3>Study Information</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">Study Type</div>
                            <div class="info-value">Cross-Sectional</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Data Format</div>
                            <div class="info-value">Single CSV with 249 columns</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Site</div>
                            <div class="info-value">DPHRU</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Population</div>
                            <div class="info-value">Middle-aged women (41-71 years)</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Total Records</div>
                            <div class="info-value">1,013</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Unique Patients</div>
                            <div class="info-value">1,013</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Source Path</div>
                            <div class="info-value" style="font-size: 0.75rem; word-break: break-all;">/home/cparker/incoming/RP2/JHB_DPHRU_053/csv</div>
                        </div>
                    </div>
                </div>

                <div class="info-section">
                    <h3>Harmonization Methodology</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">Version</div>
                            <div class="info-value">2.0_ENHANCED</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Script</div>
                            <div class="info-value" style="font-family: monospace; font-size: 0.85rem;">JHB_DPHRU_053_ENHANCED_HARMONIZER.py</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Date</div>
                            <div class="info-value">2025-12-02</div>
                        </div>
                    </div>
                </div>

                <div class="info-section">
                    <h3>Critical Study Context Notes</h3>
                    <ul class="notes-list">
                        <li>Cross-sectional study - NO longitudinal data to extract</li>
                        <li>Rich metabolic and body composition data (DXA scans)</li>
                        <li>MASC focuses on menopausal women - predominantly female cohort</li>
                        <li>Includes fasting insulin, HbA1c, hs-CRP (inflammatory marker)</li>
                        <li>DXA body composition: fat mass, lean mass, android fat, ASMI</li>
                        <li>Functional measures: grip strength, Epworth sleepiness score</li>

                    </ul>
                </div>

                <div class="info-section">
                    <h3>Source Files</h3>
                    <table class="source-files-table">
                        <thead>
                            <tr>
                                <th>File Name</th>
                                <th>Description</th>
                                <th>Records</th>
                                <th>Key Columns</th>
                            </tr>
                        </thead>
                        <tbody>

                            <tr>
                                <td style="font-family: monospace; font-size: 0.85rem;">JHB_DPHRU_053_MASC_DATA_2023-12-06 TO SHARE.csv</td>
                                <td>Complete MASC dataset</td>
                                <td>1,013</td>
                                <td style="font-family: monospace; font-size: 0.8rem;">gsk_id, gsk_date, age, gender, test_result_hiv, on_arvs, systolic_bp_average, glucose_0, lab_hba1c, total_cholesterol, hs_c_reactive_protein, total_fm, grip_strength_max</td>
                            </tr>

                        </tbody>
                    </table>
                </div>

                <div class="info-section">
                    <h3>Complete Variable Lineage & Transformation Details</h3>
                    <table class="lineage-table">
                        <thead>
                            <tr>
                                <th style="width: 12%;">Variable</th>
                                <th style="width: 15%;">Source File</th>
                                <th style="width: 15%;">Source Column(s)</th>
                                <th style="width: 8%;">Units</th>
                                <th style="width: 25%;">Transformation Code</th>
                                <th style="width: 25%;">Notes</th>
                            </tr>
                        </thead>
                        <tbody>

                            <tr>
                                <td><span class="var-name">patient_id</span></td>
                                <td><span class="source-file">MASC_DATA CSV</span></td>
                                <td><span class="source-cols">gsk_id</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['patient_id'] = df['gsk_id']</div><div class="transform-desc">Direct mapping of GSK study ID</div></td>
                                <td class="notes-cell">gsk_id = study participant identifier</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">visit_date</span></td>
                                <td><span class="source-file">MASC_DATA CSV</span></td>
                                <td><span class="source-cols">gsk_date</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['visit_date'] = pd.to_datetime(df['gsk_date'], errors='coerce')</div><div class="transform-desc">Convert to datetime</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">age_years</span></td>
                                <td><span class="source-file">MASC_DATA CSV</span></td>
                                <td><span class="source-cols">age</span></td>
                                <td><span class="unit-badge">years</span></td>
                                <td><div class="code-block">df['age_years'] = pd.to_numeric(df['age'], errors='coerce')</div><div class="transform-desc">Direct mapping</div></td>
                                <td class="notes-cell">Range 41-71 years (menopausal women)</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">sex</span></td>
                                <td><span class="source-file">MASC_DATA CSV</span></td>
                                <td><span class="source-cols">gender</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['sex'] = df['gender'].map({0.0: 'Female', 1.0: 'Male'})</div><div class="transform-desc">Map gender codes (0=Female, 1=Male)</div></td>
                                <td class="notes-cell">Note: 0=Female (opposite of common convention); mostly female cohort</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">hiv_status</span></td>
                                <td><span class="source-file">MASC_DATA CSV</span></td>
                                <td><span class="source-cols">test_result_hiv</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['hiv_status'] = df['test_result_hiv'].map({0.0: 'Negative', 1.0: 'Positive', 2.0: 'Unknown'})</div><div class="transform-desc">Map HIV test result codes</div></td>
                                <td class="notes-cell">0=Negative, 1=Positive, 2=Unknown</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">hiv_positive</span></td>
                                <td><span class="source-file">MASC_DATA CSV</span></td>
                                <td><span class="source-cols">test_result_hiv</span></td>
                                <td><span class="unit-badge">boolean (0/1)</span></td>
                                <td><div class="formula-box"><strong>Formula:</strong> test_result_hiv == 1</div><div class="code-block">df['hiv_positive'] = (df['test_result_hiv'] == 1.0).astype(float)</div><div class="transform-desc">Binary HIV+ flag</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">on_art</span></td>
                                <td><span class="source-file">MASC_DATA CSV</span></td>
                                <td><span class="source-cols">on_arvs</span></td>
                                <td><span class="unit-badge">boolean (0/1)</span></td>
                                <td><div class="code-block">df['on_art'] = df['on_arvs'].map({1.0: 1, 0.0: 0, 2.0: np.nan})</div><div class="transform-desc">Map ARV status (1=Yes, 0=No, 2=Unknown→NaN)</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">systolic_bp</span></td>
                                <td><span class="source-file">MASC_DATA CSV</span></td>
                                <td><span class="source-cols">systolic_bp_average</span></td>
                                <td><span class="unit-badge">mmHg</span></td>
                                <td><div class="code-block">df['systolic_bp'] = pd.to_numeric(df['systolic_bp_average'], errors='coerce')</div><div class="transform-desc">Average of BP readings</div></td>
                                <td class="notes-cell">Average of multiple measurements</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">diastolic_bp</span></td>
                                <td><span class="source-file">MASC_DATA CSV</span></td>
                                <td><span class="source-cols">diastolic_bp_average</span></td>
                                <td><span class="unit-badge">mmHg</span></td>
                                <td><div class="code-block">df['diastolic_bp'] = pd.to_numeric(df['diastolic_bp_average'], errors='coerce')</div><div class="transform-desc">Average of BP readings</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">height_cm</span></td>
                                <td><span class="source-file">MASC_DATA CSV</span></td>
                                <td><span class="source-cols">height</span></td>
                                <td><span class="unit-badge">cm</span></td>
                                <td><div class="code-block">df['height_cm'] = pd.to_numeric(df['height'], errors='coerce')</div><div class="transform-desc">Direct mapping</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">weight_kg</span></td>
                                <td><span class="source-file">MASC_DATA CSV</span></td>
                                <td><span class="source-cols">weight</span></td>
                                <td><span class="unit-badge">kg</span></td>
                                <td><div class="code-block">df['weight_kg'] = pd.to_numeric(df['weight'], errors='coerce')</div><div class="transform-desc">Direct mapping</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">bmi</span></td>
                                <td><span class="source-file">MASC_DATA CSV</span></td>
                                <td><span class="source-cols">bmi</span></td>
                                <td><span class="unit-badge">kg/m²</span></td>
                                <td><div class="code-block">df['bmi'] = pd.to_numeric(df['bmi'], errors='coerce')</div><div class="transform-desc">Pre-calculated in source</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">waist_circumference</span></td>
                                <td><span class="source-file">MASC_DATA CSV</span></td>
                                <td><span class="source-cols">waist_circumference_average</span></td>
                                <td><span class="unit-badge">cm</span></td>
                                <td><div class="code-block">df['waist_circumference'] = pd.to_numeric(df['waist_circumference_average'], errors='coerce')</div><div class="transform-desc">Average of waist measurements</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">hip_circumference</span></td>
                                <td><span class="source-file">MASC_DATA CSV</span></td>
                                <td><span class="source-cols">hip_circumference_average</span></td>
                                <td><span class="unit-badge">cm</span></td>
                                <td><div class="code-block">df['hip_circumference'] = pd.to_numeric(df['hip_circumference_average'], errors='coerce')</div><div class="transform-desc">Average of hip measurements</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">waist_hip_ratio</span></td>
                                <td><span class="source-file">DERIVED</span></td>
                                <td><span class="source-cols">waist_circumference_average, hip_circumference_average</span></td>
                                <td><span class="unit-badge">ratio</span></td>
                                <td><div class="formula-box"><strong>Formula:</strong> waist / hip</div><div class="code-block">df['waist_hip_ratio'] = df['waist_circumference'] / df['hip_circumference']</div><div class="transform-desc">Calculate waist-to-hip ratio</div></td>
                                <td class="notes-cell">Cardiovascular risk indicator</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">hemoglobin</span></td>
                                <td><span class="source-file">MASC_DATA CSV</span></td>
                                <td><span class="source-cols">hb_value</span></td>
                                <td><span class="unit-badge">g/dL</span></td>
                                <td><div class="code-block">df['hemoglobin'] = pd.to_numeric(df['hb_value'], errors='coerce')</div><div class="transform-desc">Direct mapping</div></td>
                                <td class="notes-cell">hb_value = hemoglobin</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">fasting_glucose</span></td>
                                <td><span class="source-file">MASC_DATA CSV</span></td>
                                <td><span class="source-cols">glucose_0</span></td>
                                <td><span class="unit-badge">mmol/L</span></td>
                                <td><div class="code-block">df['fasting_glucose'] = pd.to_numeric(df['glucose_0'], errors='coerce')</div><div class="transform-desc">Fasting (time 0) glucose</div></td>
                                <td class="notes-cell">glucose_0 = fasting glucose (OGTT time 0)</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">fasting_insulin</span></td>
                                <td><span class="source-file">MASC_DATA CSV</span></td>
                                <td><span class="source-cols">insulin_0</span></td>
                                <td><span class="unit-badge">µIU/mL</span></td>
                                <td><div class="code-block">df['fasting_insulin'] = pd.to_numeric(df['insulin_0'], errors='coerce')</div><div class="transform-desc">Fasting (time 0) insulin</div></td>
                                <td class="notes-cell">insulin_0 = fasting insulin (OGTT time 0)</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">hba1c</span></td>
                                <td><span class="source-file">MASC_DATA CSV</span></td>
                                <td><span class="source-cols">lab_hba1c</span></td>
                                <td><span class="unit-badge">%</span></td>
                                <td><div class="code-block">df['hba1c'] = pd.to_numeric(df['lab_hba1c'], errors='coerce')</div><div class="transform-desc">HbA1c from lab results</div></td>
                                <td class="notes-cell">Glycated hemoglobin - 3-month glucose average</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">who_glycemic_status</span></td>
                                <td><span class="source-file">MASC_DATA CSV</span></td>
                                <td><span class="source-cols">who_glycemic_criteria</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['who_glycemic_status'] = df['who_glycemic_criteria']</div><div class="transform-desc">WHO glycemic classification</div></td>
                                <td class="notes-cell">NGT=Normal, IFG=Impaired Fasting, IGT=Impaired Tolerance, T2D=Type 2 Diabetes</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">total_cholesterol</span></td>
                                <td><span class="source-file">MASC_DATA CSV</span></td>
                                <td><span class="source-cols">total_cholesterol</span></td>
                                <td><span class="unit-badge">mmol/L</span></td>
                                <td><div class="code-block">df['total_cholesterol'] = pd.to_numeric(df['total_cholesterol'], errors='coerce')</div><div class="transform-desc">Direct mapping</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">hdl_cholesterol</span></td>
                                <td><span class="source-file">MASC_DATA CSV</span></td>
                                <td><span class="source-cols">high_density_lipoprotein</span></td>
                                <td><span class="unit-badge">mmol/L</span></td>
                                <td><div class="code-block">df['hdl_cholesterol'] = pd.to_numeric(df['high_density_lipoprotein'], errors='coerce')</div><div class="transform-desc">Direct mapping</div></td>
                                <td class="notes-cell">Column name: high_density_lipoprotein</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">ldl_cholesterol</span></td>
                                <td><span class="source-file">MASC_DATA CSV</span></td>
                                <td><span class="source-cols">lab_calculated_ldl</span></td>
                                <td><span class="unit-badge">mmol/L</span></td>
                                <td><div class="code-block">df['ldl_cholesterol'] = pd.to_numeric(df['lab_calculated_ldl'], errors='coerce')</div><div class="transform-desc">Lab-calculated LDL</div></td>
                                <td class="notes-cell">Calculated (not direct measure)</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">triglycerides</span></td>
                                <td><span class="source-file">MASC_DATA CSV</span></td>
                                <td><span class="source-cols">triglycerides</span></td>
                                <td><span class="unit-badge">mmol/L</span></td>
                                <td><div class="code-block">df['triglycerides'] = pd.to_numeric(df['triglycerides'], errors='coerce')</div><div class="transform-desc">Direct mapping</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">albumin</span></td>
                                <td><span class="source-file">MASC_DATA CSV</span></td>
                                <td><span class="source-cols">serum_albumin</span></td>
                                <td><span class="unit-badge">g/L</span></td>
                                <td><div class="code-block">df['albumin'] = pd.to_numeric(df['serum_albumin'], errors='coerce')</div><div class="transform-desc">Direct mapping</div></td>
                                <td class="notes-cell">serum_albumin</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">hs_crp</span></td>
                                <td><span class="source-file">MASC_DATA CSV</span></td>
                                <td><span class="source-cols">hs_c_reactive_protein</span></td>
                                <td><span class="unit-badge">mg/L</span></td>
                                <td><div class="code-block">df['hs_crp'] = pd.to_numeric(df['hs_c_reactive_protein'], errors='coerce')</div><div class="transform-desc">High-sensitivity CRP</div></td>
                                <td class="notes-cell">Inflammatory marker - important for heat-health analysis</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">total_fat_mass</span></td>
                                <td><span class="source-file">MASC_DATA CSV</span></td>
                                <td><span class="source-cols">total_fm</span></td>
                                <td><span class="unit-badge">kg</span></td>
                                <td><div class="code-block">df['total_fat_mass'] = pd.to_numeric(df['total_fm'], errors='coerce')</div><div class="transform-desc">Total fat mass from DXA</div></td>
                                <td class="notes-cell">DXA body composition</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">total_lean_mass</span></td>
                                <td><span class="source-file">MASC_DATA CSV</span></td>
                                <td><span class="source-cols">total_lean</span></td>
                                <td><span class="unit-badge">kg</span></td>
                                <td><div class="code-block">df['total_lean_mass'] = pd.to_numeric(df['total_lean'], errors='coerce')</div><div class="transform-desc">Total lean mass from DXA</div></td>
                                <td class="notes-cell">DXA body composition</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">body_fat_percent</span></td>
                                <td><span class="source-file">MASC_DATA CSV</span></td>
                                <td><span class="source-cols">total_percentage_fm</span></td>
                                <td><span class="unit-badge">%</span></td>
                                <td><div class="code-block">df['body_fat_percent'] = pd.to_numeric(df['total_percentage_fm'], errors='coerce')</div><div class="transform-desc">Body fat percentage from DXA</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">android_fat_percent</span></td>
                                <td><span class="source-file">MASC_DATA CSV</span></td>
                                <td><span class="source-cols">android_pfat</span></td>
                                <td><span class="unit-badge">%</span></td>
                                <td><div class="code-block">df['android_fat_percent'] = pd.to_numeric(df['android_pfat'], errors='coerce')</div><div class="transform-desc">Android (abdominal) fat percentage</div></td>
                                <td class="notes-cell">Visceral fat indicator</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">fat_mass_index</span></td>
                                <td><span class="source-file">MASC_DATA CSV</span></td>
                                <td><span class="source-cols">fat_mass_index</span></td>
                                <td><span class="unit-badge">kg/m²</span></td>
                                <td><div class="code-block">df['fat_mass_index'] = pd.to_numeric(df['fat_mass_index'], errors='coerce')</div><div class="transform-desc">Fat mass index</div></td>
                                <td class="notes-cell">fat_mass / height²</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">asmi</span></td>
                                <td><span class="source-file">MASC_DATA CSV</span></td>
                                <td><span class="source-cols">asmi</span></td>
                                <td><span class="unit-badge">kg/m²</span></td>
                                <td><div class="code-block">df['asmi'] = pd.to_numeric(df['asmi'], errors='coerce')</div><div class="transform-desc">Appendicular Skeletal Muscle Index</div></td>
                                <td class="notes-cell">Sarcopenia marker</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">grip_strength</span></td>
                                <td><span class="source-file">MASC_DATA CSV</span></td>
                                <td><span class="source-cols">grip_strength_max</span></td>
                                <td><span class="unit-badge">kg</span></td>
                                <td><div class="code-block">df['grip_strength'] = pd.to_numeric(df['grip_strength_max'], errors='coerce')</div><div class="transform-desc">Maximum grip strength</div></td>
                                <td class="notes-cell">Functional measure - frailty indicator</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">epworth_sleepiness_score</span></td>
                                <td><span class="source-file">MASC_DATA CSV</span></td>
                                <td><span class="source-cols">total_ess_score</span></td>
                                <td><span class="unit-badge">score (0-24)</span></td>
                                <td><div class="code-block">df['epworth_sleepiness_score'] = pd.to_numeric(df['total_ess_score'], errors='coerce')</div><div class="transform-desc">Epworth Sleepiness Scale total</div></td>
                                <td class="notes-cell">>10 indicates excessive daytime sleepiness</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">ses_score</span></td>
                                <td><span class="source-file">MASC_DATA CSV</span></td>
                                <td><span class="source-cols">total_ses_score</span></td>
                                <td><span class="unit-badge">score</span></td>
                                <td><div class="code-block">df['ses_score'] = pd.to_numeric(df['total_ses_score'], errors='coerce')</div><div class="transform-desc">Socioeconomic status score</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">asset_index</span></td>
                                <td><span class="source-file">JHB_DPHRU_053_MASC_DATA_2023-12-06 TO SHARE.csv</span></td>
                                <td><span class="source-cols">asset_index</span></td>
                                <td><span class="unit-badge">index</span></td>
                                <td><div class="code-block">df['asset_index'] = pd.to_numeric(df['asset_index'], errors='coerce')</div><div class="transform-desc">Asset-based wealth index</div></td>
                                <td class="notes-cell">Calculated from household assets</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">education_level</span></td>
                                <td><span class="source-file">JHB_DPHRU_053_MASC_DATA_2023-12-06 TO SHARE.csv</span></td>
                                <td><span class="source-cols">highest_education_level</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['education_level'] = df['highest_education_level']</div><div class="transform-desc">Highest education level attained</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">employment_status</span></td>
                                <td><span class="source-file">JHB_DPHRU_053_MASC_DATA_2023-12-06 TO SHARE.csv</span></td>
                                <td><span class="source-cols">currently_employed</span></td>
                                <td><span class="unit-badge">boolean</span></td>
                                <td><div class="code-block">df['employment_status'] = df['currently_employed']</div><div class="transform-desc">Current employment status</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">marital_status</span></td>
                                <td><span class="source-file">JHB_DPHRU_053_MASC_DATA_2023-12-06 TO SHARE.csv</span></td>
                                <td><span class="source-cols">marital_status</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['marital_status'] = df['marital_status']</div><div class="transform-desc">Direct mapping</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">monthly_income</span></td>
                                <td><span class="source-file">JHB_DPHRU_053_MASC_DATA_2023-12-06 TO SHARE.csv</span></td>
                                <td><span class="source-cols">monthly_household_income</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['monthly_income'] = df['monthly_household_income']</div><div class="transform-desc">Monthly household income category</div></td>
                                <td class="notes-cell">Categorical variable</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">housing_type</span></td>
                                <td><span class="source-file">JHB_DPHRU_053_MASC_DATA_2023-12-06 TO SHARE.csv</span></td>
                                <td><span class="source-cols">home_description</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['housing_type'] = df['home_description']</div><div class="transform-desc">Type of housing/dwelling</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">years_in_gauteng</span></td>
                                <td><span class="source-file">JHB_DPHRU_053_MASC_DATA_2023-12-06 TO SHARE.csv</span></td>
                                <td><span class="source-cols">years_living_in_gauteng</span></td>
                                <td><span class="unit-badge">years</span></td>
                                <td><div class="code-block">df['years_in_gauteng'] = pd.to_numeric(df['years_living_in_gauteng'], errors='coerce')</div><div class="transform-desc">Years living in Gauteng province</div></td>
                                <td class="notes-cell">Duration of residence in study area</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">household_size</span></td>
                                <td><span class="source-file">JHB_DPHRU_053_MASC_DATA_2023-12-06 TO SHARE.csv</span></td>
                                <td><span class="source-cols">people_living_in_house</span></td>
                                <td><span class="unit-badge">persons</span></td>
                                <td><div class="code-block">df['household_size'] = pd.to_numeric(df['people_living_in_house'], errors='coerce')</div><div class="transform-desc">Number of people in household</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">latitude</span></td>
                                <td><span class="source-file">GEOCODED</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td><span class="unit-badge">degrees</span></td>
                                <td><div class="code-block">df['latitude'] = -26.2041  # DPHRU, Johannesburg</div><div class="transform-desc">Fixed coordinates for DPHRU research site</div></td>
                                <td class="notes-cell">DPHRU - Development Pathways for Health Research Unit</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">longitude</span></td>
                                <td><span class="source-file">GEOCODED</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td><span class="unit-badge">degrees</span></td>
                                <td><div class="code-block">df['longitude'] = 28.0473  # DPHRU, Johannesburg</div><div class="transform-desc">Fixed coordinates for DPHRU research site</div></td>
                                <td class="notes-cell">All participants enrolled at single site</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">study_id</span></td>
                                <td><span class="source-file">METADATA</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['study_id'] = 'JHB_DPHRU_053'</div><div class="transform-desc">Study identifier constant</div></td>
                                <td class="notes-cell">Harmonization metadata</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">study_name</span></td>
                                <td><span class="source-file">METADATA</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['study_name'] = 'MASC - Menopausal and Ageing Study Cohort'</div><div class="transform-desc">Full study name constant</div></td>
                                <td class="notes-cell">Harmonization metadata</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">study_type</span></td>
                                <td><span class="source-file">METADATA</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['study_type'] = 'Cross-Sectional'</div><div class="transform-desc">Study design type</div></td>
                                <td class="notes-cell">Harmonization metadata</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">country</span></td>
                                <td><span class="source-file">METADATA</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['country'] = 'South Africa'</div><div class="transform-desc">Country constant</div></td>
                                <td class="notes-cell">DPHRU site in Johannesburg/Soweto</td>
                            </tr>

                        </tbody>
                    </table>
                </div>

            </div>
        </div>

        <div class="study-section" id="JHB_DPHRU_013">
            <div class="study-header">
                <h2>JHB_DPHRU_013</h2>
                <div class="study-name">WBS - Women's Body Study</div>
            </div>
            <div class="study-content">

                <div class="info-section">
                    <h3>Study Information</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">Study Type</div>
                            <div class="info-value">Longitudinal Cohort</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Data Format</div>
                            <div class="info-value">Excel Workbook (4 sheets)</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Site</div>
                            <div class="info-value">DPHRU</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Population</div>
                            <div class="info-value">Women (HIV-positive and HIV-negative)</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Total Records</div>
                            <div class="info-value">784</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Unique Patients</div>
                            <div class="info-value">247</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Source Path</div>
                            <div class="info-value" style="font-size: 0.75rem; word-break: break-all;">/home/cparker/incoming/RP2/JHB_DPHRU_013/raw</div>
                        </div>
                    </div>
                </div>

                <div class="info-section">
                    <h3>Harmonization Methodology</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">Version</div>
                            <div class="info-value">2.0_ENHANCED</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Script</div>
                            <div class="info-value" style="font-family: monospace; font-size: 0.85rem;">JHB_DPHRU_013_ENHANCED_HARMONIZER.py</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Date</div>
                            <div class="info-value">2025-12-02</div>
                        </div>
                    </div>
                </div>

                <div class="info-section">
                    <h3>Critical Study Context Notes</h3>
                    <ul class="notes-list">
                        <li>Longitudinal study of women's body composition and metabolic health</li>
                        <li>All participants are female</li>
                        <li>4 timepoints: Baseline, 6 months, 12 months, 24 months</li>
                        <li>Excel workbook with separate sheet per visit</li>
                        <li>Rich metabolic and body composition data including DXA, vitamin D</li>
                        <li>Includes HIV-positive and HIV-negative women</li>

                    </ul>
                </div>

                <div class="info-section">
                    <h3>Source Files</h3>
                    <table class="source-files-table">
                        <thead>
                            <tr>
                                <th>File Name</th>
                                <th>Description</th>
                                <th>Records</th>
                                <th>Key Columns</th>
                            </tr>
                        </thead>
                        <tbody>

                            <tr>
                                <td style="font-family: monospace; font-size: 0.85rem;">WBS HEAT Dataset 2024-12-19 V3.xlsx</td>
                                <td>Complete WBS dataset (Excel)</td>
                                <td>784 total (4 sheets)</td>
                                <td style="font-family: monospace; font-size: 0.8rem;">wbs_id, date, age, sbp_mean, dbp_mean, pulse_mean, glucose, insulin, cholesterole, trigs, vit_d_25, subtot_fat, flex_grip_mean</td>
                            </tr>

                        </tbody>
                    </table>
                </div>

                <div class="info-section">
                    <h3>Complete Variable Lineage & Transformation Details</h3>
                    <table class="lineage-table">
                        <thead>
                            <tr>
                                <th style="width: 12%;">Variable</th>
                                <th style="width: 15%;">Source File</th>
                                <th style="width: 15%;">Source Column(s)</th>
                                <th style="width: 8%;">Units</th>
                                <th style="width: 25%;">Transformation Code</th>
                                <th style="width: 25%;">Notes</th>
                            </tr>
                        </thead>
                        <tbody>

                            <tr>
                                <td><span class="var-name">patient_id</span></td>
                                <td><span class="source-file">Excel (all sheets)</span></td>
                                <td><span class="source-cols">wbs_id</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['patient_id'] = df['wbs_id']</div><div class="transform-desc">Direct mapping of WBS study ID</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">visit</span></td>
                                <td><span class="source-file">DERIVED</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td>-</td>
                                <td><div class="code-block"># Set based on which Excel sheet
df['visit'] = visit_name  # 'Baseline', '6 months', '12 months', '24 months'</div><div class="transform-desc">Assigned based on Excel sheet name</div></td>
                                <td class="notes-cell">4 visits: Baseline, 6 months, 12 months, 24 months</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">visit_num</span></td>
                                <td><span class="source-file">DERIVED</span></td>
                                <td><span class="source-cols">visit</span></td>
                                <td>-</td>
                                <td><div class="code-block">visit_num_map = {'Baseline': 1, '6 months': 2, '12 months': 3, '24 months': 4}
df['visit_num'] = df['visit'].map(visit_num_map)</div><div class="transform-desc">Numeric visit order</div></td>
                                <td class="notes-cell">1=Baseline, 2=6m, 3=12m, 4=24m</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">visit_date</span></td>
                                <td><span class="source-file">Excel (all sheets)</span></td>
                                <td><span class="source-cols">date</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['visit_date'] = pd.to_datetime(df['date'], errors='coerce')</div><div class="transform-desc">Convert to datetime</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">age_years</span></td>
                                <td><span class="source-file">Excel (all sheets)</span></td>
                                <td><span class="source-cols">age</span></td>
                                <td><span class="unit-badge">years</span></td>
                                <td><div class="code-block">df['age_years'] = pd.to_numeric(df['age'], errors='coerce')</div><div class="transform-desc">Direct mapping</div></td>
                                <td class="notes-cell">Age at each visit</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">sex</span></td>
                                <td><span class="source-file">STUDY_DESIGN</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['sex'] = 'Female'</div><div class="transform-desc">All participants female by study design</div></td>
                                <td class="notes-cell">Women's Body Study - 100% female</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">systolic_bp</span></td>
                                <td><span class="source-file">Excel (all sheets)</span></td>
                                <td><span class="source-cols">sbp_mean</span></td>
                                <td><span class="unit-badge">mmHg</span></td>
                                <td><div class="code-block">df['systolic_bp'] = pd.to_numeric(df['sbp_mean'], errors='coerce')</div><div class="transform-desc">Mean systolic BP</div></td>
                                <td class="notes-cell">Average of multiple readings</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">diastolic_bp</span></td>
                                <td><span class="source-file">Excel (all sheets)</span></td>
                                <td><span class="source-cols">dbp_mean</span></td>
                                <td><span class="unit-badge">mmHg</span></td>
                                <td><div class="code-block">df['diastolic_bp'] = pd.to_numeric(df['dbp_mean'], errors='coerce')</div><div class="transform-desc">Mean diastolic BP</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">heart_rate</span></td>
                                <td><span class="source-file">Excel (all sheets)</span></td>
                                <td><span class="source-cols">pulse_mean</span></td>
                                <td><span class="unit-badge">bpm</span></td>
                                <td><div class="code-block">df['heart_rate'] = pd.to_numeric(df['pulse_mean'], errors='coerce')</div><div class="transform-desc">Mean pulse rate</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">height_cm</span></td>
                                <td><span class="source-file">Excel (all sheets)</span></td>
                                <td><span class="source-cols">height</span></td>
                                <td><span class="unit-badge">cm</span></td>
                                <td><div class="code-block">df['height_cm'] = pd.to_numeric(df['height'], errors='coerce')</div><div class="transform-desc">Direct mapping</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">weight_kg</span></td>
                                <td><span class="source-file">Excel (all sheets)</span></td>
                                <td><span class="source-cols">weight</span></td>
                                <td><span class="unit-badge">kg</span></td>
                                <td><div class="code-block">df['weight_kg'] = pd.to_numeric(df['weight'], errors='coerce')</div><div class="transform-desc">Direct mapping</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">bmi</span></td>
                                <td><span class="source-file">Excel (all sheets)</span></td>
                                <td><span class="source-cols">bmi</span></td>
                                <td><span class="unit-badge">kg/m²</span></td>
                                <td><div class="code-block">df['bmi'] = pd.to_numeric(df['bmi'], errors='coerce')</div><div class="transform-desc">Pre-calculated in source</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">waist_circumference</span></td>
                                <td><span class="source-file">Excel (all sheets)</span></td>
                                <td><span class="source-cols">waist_circum</span></td>
                                <td><span class="unit-badge">cm</span></td>
                                <td><div class="code-block">df['waist_circumference'] = pd.to_numeric(df['waist_circum'], errors='coerce')</div><div class="transform-desc">Direct mapping</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">hip_circumference</span></td>
                                <td><span class="source-file">Excel (all sheets)</span></td>
                                <td><span class="source-cols">hip_circum</span></td>
                                <td><span class="unit-badge">cm</span></td>
                                <td><div class="code-block">df['hip_circumference'] = pd.to_numeric(df['hip_circum'], errors='coerce')</div><div class="transform-desc">Direct mapping</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">waist_hip_ratio</span></td>
                                <td><span class="source-file">Excel (all sheets)</span></td>
                                <td><span class="source-cols">waist_hip_ratio</span></td>
                                <td><span class="unit-badge">ratio</span></td>
                                <td><div class="code-block">df['waist_hip_ratio'] = pd.to_numeric(df['waist_hip_ratio'], errors='coerce')</div><div class="transform-desc">Pre-calculated in source</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">fasting_glucose</span></td>
                                <td><span class="source-file">Excel (all sheets)</span></td>
                                <td><span class="source-cols">glucose</span></td>
                                <td><span class="unit-badge">mmol/L</span></td>
                                <td><div class="code-block">df['fasting_glucose'] = pd.to_numeric(df['glucose'], errors='coerce')</div><div class="transform-desc">Direct mapping</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">fasting_insulin</span></td>
                                <td><span class="source-file">Excel (all sheets)</span></td>
                                <td><span class="source-cols">insulin</span></td>
                                <td><span class="unit-badge">µIU/mL</span></td>
                                <td><div class="code-block">df['fasting_insulin'] = pd.to_numeric(df['insulin'], errors='coerce')</div><div class="transform-desc">Direct mapping</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">total_cholesterol</span></td>
                                <td><span class="source-file">Excel (all sheets)</span></td>
                                <td><span class="source-cols">cholesterole</span></td>
                                <td><span class="unit-badge">mmol/L</span></td>
                                <td><div class="code-block">df['total_cholesterol'] = pd.to_numeric(df['cholesterole'], errors='coerce')</div><div class="transform-desc">Direct mapping</div></td>
                                <td class="notes-cell">Note spelling: 'cholesterole' in source</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">hdl_cholesterol</span></td>
                                <td><span class="source-file">Excel (all sheets)</span></td>
                                <td><span class="source-cols">hdl</span></td>
                                <td><span class="unit-badge">mmol/L</span></td>
                                <td><div class="code-block">df['hdl_cholesterol'] = pd.to_numeric(df['hdl'], errors='coerce')</div><div class="transform-desc">Direct mapping</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">ldl_cholesterol</span></td>
                                <td><span class="source-file">Excel (all sheets)</span></td>
                                <td><span class="source-cols">ldl</span></td>
                                <td><span class="unit-badge">mmol/L</span></td>
                                <td><div class="code-block">df['ldl_cholesterol'] = pd.to_numeric(df['ldl'], errors='coerce')</div><div class="transform-desc">Direct mapping</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">triglycerides</span></td>
                                <td><span class="source-file">Excel (all sheets)</span></td>
                                <td><span class="source-cols">trigs</span></td>
                                <td><span class="unit-badge">mmol/L</span></td>
                                <td><div class="code-block">df['triglycerides'] = pd.to_numeric(df['trigs'], errors='coerce')</div><div class="transform-desc">Direct mapping</div></td>
                                <td class="notes-cell">trigs = triglycerides</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">vitamin_d</span></td>
                                <td><span class="source-file">Excel (all sheets)</span></td>
                                <td><span class="source-cols">vit_d_25</span></td>
                                <td><span class="unit-badge">nmol/L</span></td>
                                <td><div class="code-block">df['vitamin_d'] = pd.to_numeric(df['vit_d_25'], errors='coerce')</div><div class="transform-desc">25-hydroxyvitamin D</div></td>
                                <td class="notes-cell">vit_d_25 = 25(OH)D</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">total_fat_mass</span></td>
                                <td><span class="source-file">Excel (all sheets)</span></td>
                                <td><span class="source-cols">subtot_fat</span></td>
                                <td><span class="unit-badge">kg</span></td>
                                <td><div class="code-block">df['total_fat_mass'] = pd.to_numeric(df['subtot_fat'], errors='coerce')</div><div class="transform-desc">Subtotal fat mass from DXA</div></td>
                                <td class="notes-cell">DXA body composition</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">total_lean_mass</span></td>
                                <td><span class="source-file">Excel (all sheets)</span></td>
                                <td><span class="source-cols">subtot_lean</span></td>
                                <td><span class="unit-badge">kg</span></td>
                                <td><div class="code-block">df['total_lean_mass'] = pd.to_numeric(df['subtot_lean'], errors='coerce')</div><div class="transform-desc">Subtotal lean mass from DXA</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">body_fat_percent</span></td>
                                <td><span class="source-file">Excel (all sheets)</span></td>
                                <td><span class="source-cols">subtot_pfat</span></td>
                                <td><span class="unit-badge">%</span></td>
                                <td><div class="code-block">df['body_fat_percent'] = pd.to_numeric(df['subtot_pfat'], errors='coerce')</div><div class="transform-desc">Subtotal fat percentage from DXA</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">grip_strength</span></td>
                                <td><span class="source-file">Excel (all sheets)</span></td>
                                <td><span class="source-cols">flex_grip_mean</span></td>
                                <td><span class="unit-badge">kg</span></td>
                                <td><div class="code-block">df['grip_strength'] = pd.to_numeric(df['flex_grip_mean'], errors='coerce')</div><div class="transform-desc">Mean grip strength (dynamometer)</div></td>
                                <td class="notes-cell">Functional/frailty measure</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">ses_score</span></td>
                                <td><span class="source-file">WBS HEAT Dataset 2024-12-19 V3.xlsx</span></td>
                                <td><span class="source-cols">ses</span></td>
                                <td><span class="unit-badge">score</span></td>
                                <td><div class="code-block">df['ses_score'] = pd.to_numeric(df['ses'], errors='coerce')</div><div class="transform-desc">Socioeconomic status score</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">latitude</span></td>
                                <td><span class="source-file">GEOCODED</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td><span class="unit-badge">degrees</span></td>
                                <td><div class="code-block">df['latitude'] = -26.2041  # DPHRU, Johannesburg</div><div class="transform-desc">Fixed coordinates for DPHRU research site</div></td>
                                <td class="notes-cell">DPHRU - Development Pathways for Health Research Unit</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">longitude</span></td>
                                <td><span class="source-file">GEOCODED</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td><span class="unit-badge">degrees</span></td>
                                <td><div class="code-block">df['longitude'] = 28.0473  # DPHRU, Johannesburg</div><div class="transform-desc">Fixed coordinates for DPHRU research site</div></td>
                                <td class="notes-cell">All participants enrolled at single site</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">study_id</span></td>
                                <td><span class="source-file">METADATA</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['study_id'] = 'JHB_DPHRU_013'</div><div class="transform-desc">Study identifier constant</div></td>
                                <td class="notes-cell">Harmonization metadata</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">study_name</span></td>
                                <td><span class="source-file">METADATA</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['study_name'] = 'WBS - Women\'s Body Study'</div><div class="transform-desc">Full study name constant</div></td>
                                <td class="notes-cell">Harmonization metadata</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">study_type</span></td>
                                <td><span class="source-file">METADATA</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['study_type'] = 'Longitudinal Cohort'</div><div class="transform-desc">Study design type</div></td>
                                <td class="notes-cell">Harmonization metadata</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">country</span></td>
                                <td><span class="source-file">METADATA</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['country'] = 'South Africa'</div><div class="transform-desc">Country constant</div></td>
                                <td class="notes-cell">DPHRU site in Johannesburg/Soweto</td>
                            </tr>

                        </tbody>
                    </table>
                </div>

            </div>
        </div>

        <div class="study-section" id="JHB_EZIN_025">
            <div class="study-header">
                <h2>JHB_EZIN_025</h2>
                <div class="study-name">Ezintsha 025 - COVID Treatment Trial</div>
            </div>
            <div class="study-content">

                <div class="info-section">
                    <h3>Study Information</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">Study Type</div>
                            <div class="info-value">COVID Treatment Trial</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Data Format</div>
                            <div class="info-value">Visit-Specific CSVs</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Site</div>
                            <div class="info-value">Ezintsha</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Population</div>
                            <div class="info-value">COVID-19 patients</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Total Records</div>
                            <div class="info-value">489</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Unique Patients</div>
                            <div class="info-value">489</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Source Path</div>
                            <div class="info-value" style="font-size: 0.75rem; word-break: break-all;">/home/cparker/incoming/RP2/JHB_EZIN_025/raw</div>
                        </div>
                    </div>
                </div>

                <div class="info-section">
                    <h3>Harmonization Methodology</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">Version</div>
                            <div class="info-value">2.0_ENHANCED</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Script</div>
                            <div class="info-value" style="font-family: monospace; font-size: 0.85rem;">JHB_EZIN_025_ENHANCED_HARMONIZER.py</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Date</div>
                            <div class="info-value">2025-12-02</div>
                        </div>
                    </div>
                </div>

                <div class="info-section">
                    <h3>Critical Study Context Notes</h3>
                    <ul class="notes-list">
                        <li>COVID-19 treatment trial</li>
                        <li>2 visit timepoints: Screening (Day 0) and Follow-up (Day 10)</li>
                        <li>Vital signs data: temperature, SpO2, respiratory rate critical for COVID</li>
                        <li>Separate CSV files for screening and follow-up visits</li>

                    </ul>
                </div>

                <div class="info-section">
                    <h3>Source Files</h3>
                    <table class="source-files-table">
                        <thead>
                            <tr>
                                <th>File Name</th>
                                <th>Description</th>
                                <th>Records</th>
                                <th>Key Columns</th>
                            </tr>
                        </thead>
                        <tbody>

                            <tr>
                                <td style="font-family: monospace; font-size: 0.85rem;">Vital Signs_Physical Exam-Screening.csv</td>
                                <td>Screening vital signs</td>
                                <td>~300</td>
                                <td style="font-family: monospace; font-size: 0.8rem;">Participant ID, Vital Signs Date, Weight, Height, Oral temperature, Pulse rate, Respiratory rate, Oxygen saturation level</td>
                            </tr>

                            <tr>
                                <td style="font-family: monospace; font-size: 0.85rem;">Vital Signs_Physical Exam-Follow-up.csv</td>
                                <td>Follow-up (Day 10) vital signs</td>
                                <td>~200</td>
                                <td style="font-family: monospace; font-size: 0.8rem;">Participant ID, Vital Signs Date, Weight, Temperature, Pulse rate, Respiratory rate, Oxygen saturation level</td>
                            </tr>

                        </tbody>
                    </table>
                </div>

                <div class="info-section">
                    <h3>Complete Variable Lineage & Transformation Details</h3>
                    <table class="lineage-table">
                        <thead>
                            <tr>
                                <th style="width: 12%;">Variable</th>
                                <th style="width: 15%;">Source File</th>
                                <th style="width: 15%;">Source Column(s)</th>
                                <th style="width: 8%;">Units</th>
                                <th style="width: 25%;">Transformation Code</th>
                                <th style="width: 25%;">Notes</th>
                            </tr>
                        </thead>
                        <tbody>

                            <tr>
                                <td><span class="var-name">patient_id</span></td>
                                <td><span class="source-file">Both CSVs</span></td>
                                <td><span class="source-cols">Participant ID</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['patient_id'] = df['Participant ID']</div><div class="transform-desc">Direct mapping</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">visit</span></td>
                                <td><span class="source-file">DERIVED</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['visit'] = visit_name  # 'Screening' or 'Follow-up Day 10'</div><div class="transform-desc">Assigned based on source file</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">visit_num</span></td>
                                <td><span class="source-file">DERIVED</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td>-</td>
                                <td><div class="code-block"># Screening = 0, Follow-up Day 10 = 10
df['visit_num'] = 0 if visit_name == 'Screening' else 10</div><div class="transform-desc">Numeric visit (0=Screening, 10=Follow-up)</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">visit_date</span></td>
                                <td><span class="source-file">Both CSVs</span></td>
                                <td><span class="source-cols">Vital Signs Date</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['visit_date'] = pd.to_datetime(df['Vital Signs Date'], errors='coerce')</div><div class="transform-desc">Convert to datetime</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">weight_kg</span></td>
                                <td><span class="source-file">Both CSVs</span></td>
                                <td><span class="source-cols">Weight</span></td>
                                <td><span class="unit-badge">kg</span></td>
                                <td><div class="code-block">df['weight_kg'] = pd.to_numeric(df['Weight'], errors='coerce')</div><div class="transform-desc">Direct mapping</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">height_cm</span></td>
                                <td><span class="source-file">Screening CSV</span></td>
                                <td><span class="source-cols">Height</span></td>
                                <td><span class="unit-badge">cm</span></td>
                                <td><div class="code-block">df['height_cm'] = pd.to_numeric(df['Height'], errors='coerce')</div><div class="transform-desc">Direct mapping (screening only)</div></td>
                                <td class="notes-cell">Height only measured at screening</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">bmi</span></td>
                                <td><span class="source-file">DERIVED</span></td>
                                <td><span class="source-cols">Weight, Height</span></td>
                                <td><span class="unit-badge">kg/m²</span></td>
                                <td><div class="formula-box"><strong>Formula:</strong> weight_kg / (height_cm / 100)²</div><div class="code-block">df['bmi'] = df['weight_kg'] / ((df['height_cm'] / 100) ** 2)</div><div class="transform-desc">Calculate BMI from weight and height</div></td>
                                <td class="notes-cell">Standard BMI formula</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">temperature_c</span></td>
                                <td><span class="source-file">Both CSVs</span></td>
                                <td><span class="source-cols">Oral temperature (Screening), Temperature (Follow-up)</span></td>
                                <td><span class="unit-badge">°C</span></td>
                                <td><div class="code-block"># Column name varies
if 'Oral temperature' in df.columns:
    df['temperature_c'] = pd.to_numeric(df['Oral temperature'], errors='coerce')
elif 'Temperature' in df.columns:
    df['temperature_c'] = pd.to_numeric(df['Temperature'], errors='coerce')</div><div class="transform-desc">Extract temperature (column name varies by visit)</div></td>
                                <td class="notes-cell">Critical for COVID monitoring</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">heart_rate</span></td>
                                <td><span class="source-file">Both CSVs</span></td>
                                <td><span class="source-cols">Pulse rate</span></td>
                                <td><span class="unit-badge">bpm</span></td>
                                <td><div class="code-block">df['heart_rate'] = pd.to_numeric(df['Pulse rate'], errors='coerce')</div><div class="transform-desc">Direct mapping</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">respiratory_rate</span></td>
                                <td><span class="source-file">Both CSVs</span></td>
                                <td><span class="source-cols">Respiratory rate</span></td>
                                <td><span class="unit-badge">breaths/min</span></td>
                                <td><div class="code-block">df['respiratory_rate'] = pd.to_numeric(df['Respiratory rate'], errors='coerce')</div><div class="transform-desc">Direct mapping</div></td>
                                <td class="notes-cell">Critical for COVID monitoring</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">oxygen_saturation</span></td>
                                <td><span class="source-file">Both CSVs</span></td>
                                <td><span class="source-cols">Oxygen saturation level</span></td>
                                <td><span class="unit-badge">%</span></td>
                                <td><div class="code-block">df['oxygen_saturation'] = pd.to_numeric(df['Oxygen saturation level'], errors='coerce')</div><div class="transform-desc">SpO2 measurement</div></td>
                                <td class="notes-cell">Critical for COVID monitoring; <94% indicates hypoxia</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">latitude</span></td>
                                <td><span class="source-file">GEOCODED</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td><span class="unit-badge">degrees</span></td>
                                <td><div class="code-block">df['latitude'] = -26.1897  # Ezintsha site, Johannesburg</div><div class="transform-desc">Fixed coordinates for Ezintsha research site</div></td>
                                <td class="notes-cell">Ezintsha Clinical Research site, Hillbrow</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">longitude</span></td>
                                <td><span class="source-file">GEOCODED</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td><span class="unit-badge">degrees</span></td>
                                <td><div class="code-block">df['longitude'] = 28.0436  # Ezintsha site, Johannesburg</div><div class="transform-desc">Fixed coordinates for Ezintsha research site</div></td>
                                <td class="notes-cell">All participants enrolled at single site</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">study_id</span></td>
                                <td><span class="source-file">METADATA</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['study_id'] = 'JHB_EZIN_025'</div><div class="transform-desc">Study identifier constant</div></td>
                                <td class="notes-cell">Harmonization metadata</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">study_name</span></td>
                                <td><span class="source-file">METADATA</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['study_name'] = 'Ezintsha 025 - COVID Treatment Trial'</div><div class="transform-desc">Full study name constant</div></td>
                                <td class="notes-cell">Harmonization metadata</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">study_type</span></td>
                                <td><span class="source-file">METADATA</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['study_type'] = 'COVID Treatment Trial'</div><div class="transform-desc">Study design type</div></td>
                                <td class="notes-cell">Harmonization metadata</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">country</span></td>
                                <td><span class="source-file">METADATA</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['country'] = 'South Africa'</div><div class="transform-desc">Country constant</div></td>
                                <td class="notes-cell">Ezintsha site in Johannesburg</td>
                            </tr>

                        </tbody>
                    </table>
                </div>

            </div>
        </div>

        <div class="study-section" id="JHB_SCHARP_004">
            <div class="study-header">
                <h2>JHB_SCHARP_004</h2>
                <div class="study-name">MTN-075/HPTN 081 - Phase 1 Microbicide Trial</div>
            </div>
            <div class="study-content">

                <div class="info-section">
                    <h3>Study Information</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">Study Type</div>
                            <div class="info-value">Phase 1 Clinical Trial</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Data Format</div>
                            <div class="info-value">SCHARP Standard (_fmt.csv files)</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Site</div>
                            <div class="info-value">SCHARP</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Population</div>
                            <div class="info-value">Women (HIV prevention trial)</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Total Records</div>
                            <div class="info-value">403</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Unique Patients</div>
                            <div class="info-value">401</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Source Path</div>
                            <div class="info-value" style="font-size: 0.75rem; word-break: break-all;">/home/cparker/incoming/RP2/JHB_SCHARP_004/csv</div>
                        </div>
                    </div>
                </div>

                <div class="info-section">
                    <h3>Harmonization Methodology</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">Version</div>
                            <div class="info-value">2.0_ENHANCED</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Script</div>
                            <div class="info-value" style="font-family: monospace; font-size: 0.85rem;">JHB_SCHARP_004_ENHANCED_HARMONIZER.py</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Date</div>
                            <div class="info-value">2025-12-02</div>
                        </div>
                    </div>
                </div>

                <div class="info-section">
                    <h3>Critical Study Context Notes</h3>
                    <ul class="notes-list">
                        <li>MTN-075/HPTN 081: Microbicide Trials Network Study</li>
                        <li>Phase 1 clinical trial for HIV prevention</li>
                        <li>SCHARP format with coded column names (LLR* prefix)</li>
                        <li>Full hematology panel and liver enzymes available</li>
                        <li>Multiple visits: 201 (primary), 301, 311</li>

                    </ul>
                </div>

                <div class="info-section">
                    <h3>Source Files</h3>
                    <table class="source-files-table">
                        <thead>
                            <tr>
                                <th>File Name</th>
                                <th>Description</th>
                                <th>Records</th>
                                <th>Key Columns</th>
                            </tr>
                        </thead>
                        <tbody>

                            <tr>
                                <td style="font-family: monospace; font-size: 0.85rem;">DEM_fmt.csv</td>
                                <td>Demographics</td>
                                <td>~400</td>
                                <td style="font-family: monospace; font-size: 0.8rem;">publicid, age, DEMsex</td>
                            </tr>

                            <tr>
                                <td style="font-family: monospace; font-size: 0.85rem;">LLR_fmt.csv</td>
                                <td>Lab Local Results - hematology, liver enzymes, creatinine</td>
                                <td>~1,200</td>
                                <td style="font-family: monospace; font-size: 0.8rem;">publicid, visit, LLRyear, LLRday, LLRhgb, LLRhct, LLRast, LLRalt, LLRcre</td>
                            </tr>

                            <tr>
                                <td style="font-family: monospace; font-size: 0.85rem;">HTR_fmt.csv</td>
                                <td>HIV Testing Results</td>
                                <td>varies</td>
                                <td style="font-family: monospace; font-size: 0.8rem;">publicid, visit</td>
                            </tr>

                        </tbody>
                    </table>
                </div>

                <div class="info-section">
                    <h3>Complete Variable Lineage & Transformation Details</h3>
                    <table class="lineage-table">
                        <thead>
                            <tr>
                                <th style="width: 12%;">Variable</th>
                                <th style="width: 15%;">Source File</th>
                                <th style="width: 15%;">Source Column(s)</th>
                                <th style="width: 8%;">Units</th>
                                <th style="width: 25%;">Transformation Code</th>
                                <th style="width: 25%;">Notes</th>
                            </tr>
                        </thead>
                        <tbody>

                            <tr>
                                <td><span class="var-name">patient_id</span></td>
                                <td><span class="source-file">LLR_fmt.csv</span></td>
                                <td><span class="source-cols">publicid</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['patient_id'] = df['publicid']</div><div class="transform-desc">Direct mapping of public ID</div></td>
                                <td class="notes-cell">SCHARP standard identifier</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">age_years</span></td>
                                <td><span class="source-file">DEM_fmt.csv</span></td>
                                <td><span class="source-cols">age</span></td>
                                <td><span class="unit-badge">years</span></td>
                                <td><div class="code-block">df['age_years'] = pd.to_numeric(df['age'], errors='coerce')</div><div class="transform-desc">Direct mapping</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">sex</span></td>
                                <td><span class="source-file">DEM_fmt.csv</span></td>
                                <td><span class="source-cols">DEMsex</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['sex'] = df['DEMsex'].map({1: 'Female', 2: 'Male'})</div><div class="transform-desc">Map SCHARP sex codes</div></td>
                                <td class="notes-cell">1=Female, 2=Male (SCHARP convention)</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">visit</span></td>
                                <td><span class="source-file">LLR_fmt.csv</span></td>
                                <td><span class="source-cols">visit</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['visit'] = df['visit'].astype(str)</div><div class="transform-desc">Convert visit code to string</div></td>
                                <td class="notes-cell">Visits: 201, 301, 311</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">visit_num</span></td>
                                <td><span class="source-file">DERIVED</span></td>
                                <td><span class="source-cols">visit</span></td>
                                <td>-</td>
                                <td><div class="code-block">visit_map = {'201': 1, '301': 2, '311': 3}
df['visit_num'] = df['visit'].map(visit_map).fillna(99)</div><div class="transform-desc">Map visit codes to numeric order</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">visit_year</span></td>
                                <td><span class="source-file">LLR_fmt.csv</span></td>
                                <td><span class="source-cols">LLRyear</span></td>
                                <td><span class="unit-badge">year</span></td>
                                <td><div class="code-block">df['visit_year'] = pd.to_numeric(df['LLRyear'], errors='coerce')</div><div class="transform-desc">Year of visit</div></td>
                                <td class="notes-cell">Part of date construction</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">visit_day</span></td>
                                <td><span class="source-file">LLR_fmt.csv</span></td>
                                <td><span class="source-cols">LLRday</span></td>
                                <td><span class="unit-badge">day of year</span></td>
                                <td><div class="code-block">df['visit_day'] = pd.to_numeric(df['LLRday'], errors='coerce')</div><div class="transform-desc">Day of year</div></td>
                                <td class="notes-cell">Part of date construction</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">hemoglobin</span></td>
                                <td><span class="source-file">LLR_fmt.csv</span></td>
                                <td><span class="source-cols">LLRhgb</span></td>
                                <td><span class="unit-badge">g/dL</span></td>
                                <td><div class="code-block">df['hemoglobin'] = pd.to_numeric(df['LLRhgb'], errors='coerce')</div><div class="transform-desc">Direct mapping</div></td>
                                <td class="notes-cell">LLR = Lab Local Results; hgb = hemoglobin</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">hematocrit</span></td>
                                <td><span class="source-file">LLR_fmt.csv</span></td>
                                <td><span class="source-cols">LLRhct</span></td>
                                <td><span class="unit-badge">%</span></td>
                                <td><div class="code-block">df['hematocrit'] = pd.to_numeric(df['LLRhct'], errors='coerce')</div><div class="transform-desc">Direct mapping</div></td>
                                <td class="notes-cell">hct = hematocrit</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">mcv</span></td>
                                <td><span class="source-file">LLR_fmt.csv</span></td>
                                <td><span class="source-cols">LLRmcv</span></td>
                                <td><span class="unit-badge">fL</span></td>
                                <td><div class="code-block">df['mcv'] = pd.to_numeric(df['LLRmcv'], errors='coerce')</div><div class="transform-desc">Mean cell volume</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">platelets</span></td>
                                <td><span class="source-file">LLR_fmt.csv</span></td>
                                <td><span class="source-cols">LLRpla</span></td>
                                <td><span class="unit-badge">10^9/L</span></td>
                                <td><div class="code-block">df['platelets'] = pd.to_numeric(df['LLRpla'], errors='coerce')</div><div class="transform-desc">Platelet count</div></td>
                                <td class="notes-cell">pla = platelets</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">wbc</span></td>
                                <td><span class="source-file">LLR_fmt.csv</span></td>
                                <td><span class="source-cols">LLRwbc</span></td>
                                <td><span class="unit-badge">10^9/L</span></td>
                                <td><div class="code-block">df['wbc'] = pd.to_numeric(df['LLRwbc'], errors='coerce')</div><div class="transform-desc">White blood cell count</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">ast</span></td>
                                <td><span class="source-file">LLR_fmt.csv</span></td>
                                <td><span class="source-cols">LLRast</span></td>
                                <td><span class="unit-badge">U/L</span></td>
                                <td><div class="code-block">df['ast'] = pd.to_numeric(df['LLRast'], errors='coerce')</div><div class="transform-desc">AST (liver enzyme)</div></td>
                                <td class="notes-cell">Aspartate aminotransferase</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">alt</span></td>
                                <td><span class="source-file">LLR_fmt.csv</span></td>
                                <td><span class="source-cols">LLRalt</span></td>
                                <td><span class="unit-badge">U/L</span></td>
                                <td><div class="code-block">df['alt'] = pd.to_numeric(df['LLRalt'], errors='coerce')</div><div class="transform-desc">ALT (liver enzyme)</div></td>
                                <td class="notes-cell">Alanine aminotransferase</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">total_bilirubin</span></td>
                                <td><span class="source-file">LLR_fmt.csv</span></td>
                                <td><span class="source-cols">LLRtbi</span></td>
                                <td><span class="unit-badge">mg/dL</span></td>
                                <td><div class="code-block">df['total_bilirubin'] = pd.to_numeric(df['LLRtbi'], errors='coerce')</div><div class="transform-desc">Total bilirubin</div></td>
                                <td class="notes-cell">tbi = total bilirubin</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">creatinine</span></td>
                                <td><span class="source-file">LLR_fmt.csv</span></td>
                                <td><span class="source-cols">LLRcre</span></td>
                                <td><span class="unit-badge">mg/dL</span></td>
                                <td><div class="code-block">df['creatinine'] = pd.to_numeric(df['LLRcre'], errors='coerce')</div><div class="transform-desc">Creatinine (kidney function)</div></td>
                                <td class="notes-cell">cre = creatinine</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">phosphorus</span></td>
                                <td><span class="source-file">LLR_fmt.csv</span></td>
                                <td><span class="source-cols">LLRpho</span></td>
                                <td><span class="unit-badge">mg/dL</span></td>
                                <td><div class="code-block">df['phosphorus'] = pd.to_numeric(df['LLRpho'], errors='coerce')</div><div class="transform-desc">Phosphorus</div></td>
                                <td class="notes-cell">pho = phosphorus</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">latitude</span></td>
                                <td><span class="source-file">GEOCODED</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td><span class="unit-badge">degrees</span></td>
                                <td><div class="code-block">df['latitude'] = -26.1752  # SCHARP/Wits RHI site, Johannesburg</div><div class="transform-desc">Fixed coordinates for SCHARP research site</div></td>
                                <td class="notes-cell">SCHARP - Statistical Center for HIV/AIDS Research and Prevention</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">longitude</span></td>
                                <td><span class="source-file">GEOCODED</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td><span class="unit-badge">degrees</span></td>
                                <td><div class="code-block">df['longitude'] = 28.0353  # SCHARP/Wits RHI site, Johannesburg</div><div class="transform-desc">Fixed coordinates for SCHARP research site</div></td>
                                <td class="notes-cell">All participants enrolled at single site</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">study_id</span></td>
                                <td><span class="source-file">METADATA</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['study_id'] = 'JHB_SCHARP_004'</div><div class="transform-desc">Study identifier constant</div></td>
                                <td class="notes-cell">Harmonization metadata</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">study_name</span></td>
                                <td><span class="source-file">METADATA</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['study_name'] = 'MTN-075/HPTN 081 - Phase 1 Microbicide Trial'</div><div class="transform-desc">Full study name constant</div></td>
                                <td class="notes-cell">Harmonization metadata</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">study_type</span></td>
                                <td><span class="source-file">METADATA</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['study_type'] = 'Phase 1 Clinical Trial'</div><div class="transform-desc">Study design type</div></td>
                                <td class="notes-cell">Harmonization metadata</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">country</span></td>
                                <td><span class="source-file">METADATA</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['country'] = 'South Africa'</div><div class="transform-desc">Country constant</div></td>
                                <td class="notes-cell">SCHARP/Wits RHI site in Johannesburg</td>
                            </tr>

                        </tbody>
                    </table>
                </div>

            </div>
        </div>

        <div class="study-section" id="JHB_SCHARP_006">
            <div class="study-header">
                <h2>JHB_SCHARP_006</h2>
                <div class="study-name">HPTN082 - PrEP Adherence Study</div>
            </div>
            <div class="study-content">

                <div class="info-section">
                    <h3>Study Information</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">Study Type</div>
                            <div class="info-value">PrEP Adherence (Longitudinal)</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Data Format</div>
                            <div class="info-value">SCHARP Standard (_fmt.csv files)</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Site</div>
                            <div class="info-value">SCHARP/Wits RHI</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Population</div>
                            <div class="info-value">Young African women (HIV-negative, on PrEP)</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Total Records</div>
                            <div class="info-value">1,359</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Unique Patients</div>
                            <div class="info-value">451</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Source Path</div>
                            <div class="info-value" style="font-size: 0.75rem; word-break: break-all;">/home/cparker/incoming/RP2/JHB_SCHARP_006/csv</div>
                        </div>
                    </div>
                </div>

                <div class="info-section">
                    <h3>Harmonization Methodology</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">Version</div>
                            <div class="info-value">2.0_ENHANCED</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Script</div>
                            <div class="info-value" style="font-family: monospace; font-size: 0.85rem;">JHB_SCHARP_006_ENHANCED_HARMONIZER.py</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Date</div>
                            <div class="info-value">2025-12-02</div>
                        </div>
                    </div>
                </div>

                <div class="info-section">
                    <h3>Critical Study Context Notes</h3>
                    <ul class="notes-list">
                        <li>HPTN082: HIV Prevention Trials Network Study 082</li>
                        <li>PrEP adherence study in young African women</li>
                        <li>All participants are HIV-NEGATIVE at enrollment (PrEP inclusion criterion)</li>
                        <li>Longitudinal follow-up with multiple lab visits</li>
                        <li>Includes STI testing (gonorrhea, chlamydia, trichomoniasis, syphilis)</li>

                    </ul>
                </div>

                <div class="info-section">
                    <h3>Source Files</h3>
                    <table class="source-files-table">
                        <thead>
                            <tr>
                                <th>File Name</th>
                                <th>Description</th>
                                <th>Records</th>
                                <th>Key Columns</th>
                            </tr>
                        </thead>
                        <tbody>

                            <tr>
                                <td style="font-family: monospace; font-size: 0.85rem;">DEM_fmt.csv</td>
                                <td>Demographics</td>
                                <td>~450</td>
                                <td style="font-family: monospace; font-size: 0.8rem;">publicid, age, DEMsex, DEMedu</td>
                            </tr>

                            <tr>
                                <td style="font-family: monospace; font-size: 0.85rem;">LLR_fmt.csv</td>
                                <td>Lab Local Results - height, weight, creatinine, STIs</td>
                                <td>~1,350</td>
                                <td style="font-family: monospace; font-size: 0.8rem;">publicid, visit, LLRhtcm, LLRwtkg, LLRcre, LLRcrcl</td>
                            </tr>

                            <tr>
                                <td style="font-family: monospace; font-size: 0.85rem;">HTR_fmt.csv</td>
                                <td>HIV Testing Results</td>
                                <td>varies</td>
                                <td style="font-family: monospace; font-size: 0.8rem;">publicid, visit</td>
                            </tr>

                            <tr>
                                <td style="font-family: monospace; font-size: 0.85rem;">ENR_fmt.csv</td>
                                <td>Enrollment data</td>
                                <td>~450</td>
                                <td style="font-family: monospace; font-size: 0.8rem;">publicid</td>
                            </tr>

                        </tbody>
                    </table>
                </div>

                <div class="info-section">
                    <h3>Complete Variable Lineage & Transformation Details</h3>
                    <table class="lineage-table">
                        <thead>
                            <tr>
                                <th style="width: 12%;">Variable</th>
                                <th style="width: 15%;">Source File</th>
                                <th style="width: 15%;">Source Column(s)</th>
                                <th style="width: 8%;">Units</th>
                                <th style="width: 25%;">Transformation Code</th>
                                <th style="width: 25%;">Notes</th>
                            </tr>
                        </thead>
                        <tbody>

                            <tr>
                                <td><span class="var-name">patient_id</span></td>
                                <td><span class="source-file">LLR_fmt.csv</span></td>
                                <td><span class="source-cols">publicid</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['patient_id'] = df['publicid']</div><div class="transform-desc">Direct mapping</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">age_years</span></td>
                                <td><span class="source-file">DEM_fmt.csv</span></td>
                                <td><span class="source-cols">age</span></td>
                                <td><span class="unit-badge">years</span></td>
                                <td><div class="code-block">df['age_years'] = pd.to_numeric(df['age'], errors='coerce')</div><div class="transform-desc">Direct mapping</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">sex</span></td>
                                <td><span class="source-file">DEM_fmt.csv</span></td>
                                <td><span class="source-cols">DEMsex</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['sex'] = df['DEMsex'].map({1: 'Female', 2: 'Male'})</div><div class="transform-desc">Map SCHARP sex codes</div></td>
                                <td class="notes-cell">1=Female, 2=Male; study is mostly female</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">education_level</span></td>
                                <td><span class="source-file">DEM_fmt.csv</span></td>
                                <td><span class="source-cols">DEMedu</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['education_level'] = df['DEMedu']</div><div class="transform-desc">Education level code</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">visit</span></td>
                                <td><span class="source-file">LLR_fmt.csv</span></td>
                                <td><span class="source-cols">visit</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['visit'] = df['visit'].astype(str)</div><div class="transform-desc">Convert to string</div></td>
                                <td class="notes-cell">Visit codes: 0, 401, 1401, 1501, 1601, 1701, 1711, 1801, 1811, 5201</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">visit_num</span></td>
                                <td><span class="source-file">DERIVED</span></td>
                                <td><span class="source-cols">visit</span></td>
                                <td>-</td>
                                <td><div class="code-block">visit_map = {'0': 0, '401': 1, '1401': 2, '1501': 3, '1601': 4, '1701': 5, '1711': 6, '1801': 7, '1811': 8, '5201': 9}
df['visit_num'] = df['visit'].map(visit_map).fillna(99)</div><div class="transform-desc">Map visit codes to sequential numbers</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">visit_year</span></td>
                                <td><span class="source-file">LLR_fmt.csv</span></td>
                                <td><span class="source-cols">LLRyear</span></td>
                                <td><span class="unit-badge">year</span></td>
                                <td><div class="code-block">df['visit_year'] = pd.to_numeric(df['LLRyear'], errors='coerce')</div><div class="transform-desc">Year of visit</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">visit_day</span></td>
                                <td><span class="source-file">LLR_fmt.csv</span></td>
                                <td><span class="source-cols">LLRday</span></td>
                                <td><span class="unit-badge">day of year</span></td>
                                <td><div class="code-block">df['visit_day'] = pd.to_numeric(df['LLRday'], errors='coerce')</div><div class="transform-desc">Day of year</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">height_cm</span></td>
                                <td><span class="source-file">LLR_fmt.csv</span></td>
                                <td><span class="source-cols">LLRhtcm</span></td>
                                <td><span class="unit-badge">cm</span></td>
                                <td><div class="code-block">df['height_cm'] = pd.to_numeric(df['LLRhtcm'], errors='coerce')</div><div class="transform-desc">Height in centimeters</div></td>
                                <td class="notes-cell">htcm = height in cm</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">weight_kg</span></td>
                                <td><span class="source-file">LLR_fmt.csv</span></td>
                                <td><span class="source-cols">LLRwtkg</span></td>
                                <td><span class="unit-badge">kg</span></td>
                                <td><div class="code-block">df['weight_kg'] = pd.to_numeric(df['LLRwtkg'], errors='coerce')</div><div class="transform-desc">Weight in kilograms</div></td>
                                <td class="notes-cell">wtkg = weight in kg</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">bmi</span></td>
                                <td><span class="source-file">DERIVED</span></td>
                                <td><span class="source-cols">LLRhtcm, LLRwtkg</span></td>
                                <td><span class="unit-badge">kg/m²</span></td>
                                <td><div class="formula-box"><strong>Formula:</strong> weight_kg / (height_cm / 100)²</div><div class="code-block">df['bmi'] = df['weight_kg'] / ((df['height_cm'] / 100) ** 2)</div><div class="transform-desc">Calculate BMI from height and weight</div></td>
                                <td class="notes-cell">Standard BMI formula</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">creatinine</span></td>
                                <td><span class="source-file">LLR_fmt.csv</span></td>
                                <td><span class="source-cols">LLRcre</span></td>
                                <td><span class="unit-badge">mg/dL</span></td>
                                <td><div class="code-block">df['creatinine'] = pd.to_numeric(df['LLRcre'], errors='coerce')</div><div class="transform-desc">Creatinine (kidney function)</div></td>
                                <td class="notes-cell">Important for PrEP monitoring (TDF nephrotoxicity)</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">creatinine_clearance</span></td>
                                <td><span class="source-file">LLR_fmt.csv</span></td>
                                <td><span class="source-cols">LLRcrcl</span></td>
                                <td><span class="unit-badge">mL/min</span></td>
                                <td><div class="code-block">df['creatinine_clearance'] = pd.to_numeric(df['LLRcrcl'], errors='coerce')</div><div class="transform-desc">Creatinine clearance (estimated GFR)</div></td>
                                <td class="notes-cell">crcl = creatinine clearance</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">hiv_status</span></td>
                                <td><span class="source-file">STUDY_DESIGN</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['hiv_status'] = 'Negative'</div><div class="transform-desc">All participants HIV-negative by study design (PrEP study)</div></td>
                                <td class="notes-cell">PrEP inclusion criterion: HIV-negative</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">hiv_positive</span></td>
                                <td><span class="source-file">STUDY_DESIGN</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td><span class="unit-badge">boolean (0/1)</span></td>
                                <td><div class="code-block">df['hiv_positive'] = 0</div><div class="transform-desc">All HIV-negative</div></td>
                                <td class="notes-cell">-</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">on_prep</span></td>
                                <td><span class="source-file">STUDY_DESIGN</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td><span class="unit-badge">boolean (0/1)</span></td>
                                <td><div class="code-block">df['on_prep'] = 1</div><div class="transform-desc">All participants on PrEP by study design</div></td>
                                <td class="notes-cell">PrEP adherence study - all on PrEP</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">latitude</span></td>
                                <td><span class="source-file">GEOCODED</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td><span class="unit-badge">degrees</span></td>
                                <td><div class="code-block">df['latitude'] = -26.1752  # SCHARP/Wits RHI site, Johannesburg</div><div class="transform-desc">Fixed coordinates for SCHARP research site</div></td>
                                <td class="notes-cell">SCHARP - Statistical Center for HIV/AIDS Research and Prevention</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">longitude</span></td>
                                <td><span class="source-file">GEOCODED</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td><span class="unit-badge">degrees</span></td>
                                <td><div class="code-block">df['longitude'] = 28.0353  # SCHARP/Wits RHI site, Johannesburg</div><div class="transform-desc">Fixed coordinates for SCHARP research site</div></td>
                                <td class="notes-cell">All participants enrolled at single site</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">study_id</span></td>
                                <td><span class="source-file">METADATA</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['study_id'] = 'JHB_SCHARP_006'</div><div class="transform-desc">Study identifier constant</div></td>
                                <td class="notes-cell">Harmonization metadata</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">study_name</span></td>
                                <td><span class="source-file">METADATA</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['study_name'] = 'HPTN082 - PrEP Adherence Study'</div><div class="transform-desc">Full study name constant</div></td>
                                <td class="notes-cell">Harmonization metadata</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">study_type</span></td>
                                <td><span class="source-file">METADATA</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['study_type'] = 'PrEP Adherence (Longitudinal)'</div><div class="transform-desc">Study design type</div></td>
                                <td class="notes-cell">Harmonization metadata</td>
                            </tr>

                            <tr>
                                <td><span class="var-name">country</span></td>
                                <td><span class="source-file">METADATA</span></td>
                                <td><span class="source-cols">N/A</span></td>
                                <td>-</td>
                                <td><div class="code-block">df['country'] = 'South Africa'</div><div class="transform-desc">Country constant</div></td>
                                <td class="notes-cell">SCHARP/Wits RHI site in Johannesburg</td>
                            </tr>

                        </tbody>
                    </table>
                </div>

            </div>
        </div>

        <a href="#top" class="back-top">↑ Back to Top</a>

        <footer>
            <p><strong>RP2 Audit-Ready Data Lineage Documentation</strong></p>
            <p>HEAT Center Research Infrastructure | ALCOA+ Compliant</p>
            <p style="margin-top: 10px; font-size: 0.85rem;">
                This report provides complete traceability for every variable including source files,
                source columns, transformation formulas, and actual code used for processing.
            </p>
        </footer>
    </div>
</body>
</html>
